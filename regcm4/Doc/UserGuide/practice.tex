\section{Practice Run}
The purpose of this section is to help new users become familiar withÂ setting up and running RegCM by going through a practice run.  A step-by-step tutorial is presented for performing one-month simulation over a European domain for July 1994.  To demonstrate how to use restart option, first a 5~day simulation at the end of June is run, then the model is restarted and run for an additional 31~days in July.

In this practice run, the 10~minute resolution GLCC and GTOPO datasets are used to create the terrain file, and ECMWF global reanalysis datasets are used for the initial and boundary conditions. These data are stored in the {\bf /home/RAID2-D10/RCM3DATA/}.  You will create links from your directory to these directories using the {\bf RegCM/PreProc/DATA/}{\it datalinker.x} script. 


\subsection{Getting the model code and data}

\indent
{\bf STEP 1.}  Create a working directory for yourself on scratch or scratch1. \\

\indent 
$\rightarrow$ cd {\bf /scratch} or cd {\bf /scratch1} \\
\indent
$\rightarrow$ mkdir {\it yourname} \\
\indent
$\rightarrow$ cd {\it yourname} \\

\noindent
{\bf STEP 2.}  Download {\it regcm.tar.gz} to your account from the RegCM3 website at \\
{\bf http://www.ictp.trieste.it/$\sim$pubregcm/RegCM3/}. \\

\noindent
{\bf STEP 3.}  Uncompress and untar {\it regcm.tar.gz} \\

\indent
$\rightarrow$ tar -zxvf {\it regcm.tar} \\

\noindent
Untarring {\it regcm.tar.gz} will create a main directory called {\bf RegCM} and 
several subdirectories containing all the files needed for pre-processing, running the model, 
and post-processing.  Preprocessing programs are in the The {\bf RegCM/PreProc/Terrain} and
{\bf RegCM/PreProc/ICBC} sub-directories, the model source code is in the {\bf RegCM/Main} 
sub-directory, and the postprocessing program is in the  {\bf RegCM/PostProc}.


\subsection{Pre-processing}
\noindent
Several pre-processing steps are necessary before running a simulation. These steps involve setting up the model domain and creating the necessary initial and  boundary conditions files.

\subsubsection{Setting up the domain}
\begin{table}[h]
\begin{center}
\caption{List of variables to be modified in {\it domain.param} file.}  \label{domain_file}
\vspace{0.25cm}
\begin{tabular}{|l|c|l|} \hline \hline
{\small {\bf Parameter}} &  {\small {\bf Value}} & {\small {\bf Description}} \\ \hline \hline
{\footnotesize {\bf iy}}   & {\footnotesize {34} }  & {\footnotesize number of grid points in y direction (i)} \\ \hline
{\footnotesize {\bf jx}}   & {\footnotesize {51} }   & {\footnotesize number of grid points in x direction (j)} \\ \hline
{\footnotesize {\bf kz}}   & {\footnotesize {18}}    & {\footnotesize number of vertical levels (k)} \\ \hline
{\footnotesize {\bf ds}}   & {\footnotesize {60.0}}    & {\footnotesize grid point separation in km} \\ \hline
{\footnotesize {\bf ptop}} & {\footnotesize {5.0}}    & {\footnotesize pressure of model top in cb} \\ \hline
{\footnotesize {\bf clat}} & {\footnotesize {45.39}}    & {\footnotesize central latitude of model domain in degrees} \\  \hline
{\footnotesize {\bf clon}} & {\footnotesize {13.48}}    & {\footnotesize central longitude of model domain in degrees} \\  \hline
{\footnotesize {\bf ntypec}} & {\footnotesize {10}}  & {\footnotesize resolution of the global terrain and land-use data } \\ \hline
{\footnotesize {\bf iproj}}    & {\footnotesize {'LAMCON'}} & {\footnotesize map projection} \\ \hline
{\footnotesize {\bf igrads}}   & {\footnotesize {1}} & {\footnotesize true=output GrADS control file} \\ \hline
{\footnotesize {\bf ibyte}} & {\footnotesize {1 or 4}}  & {\footnotesize for direct access open statements} \\  
 & & {\footnotesize  1 for IFC8, SGI, DEC;  4 for PGI, IFC7, SUN, IBM} \\ \hline
{\footnotesize {\bf IDATE1}}   & {\footnotesize {1994062500}} & {\footnotesize beginning date of simulation} \\ \hline
{\footnotesize {\bf IDATE2}}   & {\footnotesize {1994080100}} & {\footnotesize ending date of simulation} \\ \hline
{\footnotesize {\bf SSTTYP}}   & {\footnotesize {'OISST'}} & {\footnotesize SST dataset }\\ \hline
{\footnotesize {\bf DATTYP}}   & {\footnotesize {'ECMWF'}} & {\footnotesize global analysis dataset} \\ \hline
{\footnotesize {\bf NPROC}}   & {\footnotesize {0 for serial run;  1,2,..... for parallel run}} & {\footnotesize Number of processors used for parallel computing} \\ \hline
\end{tabular}
\end{center}
\end{table}


\noindent
The first step is to define the domain and interpolate elevation and land-use data to the
grid.  This is done in the {\bf RegCM/PreProc/Terrain} sub-directory.  For this practice run we 
use a European domain of 2040~km $\times$ 3060~km size centered over Trieste, 
Italy ($45.39^{\circ}~{\rm N}$, $ 13.48^{\circ}~{\rm E}$) and a horizontal grid-point
spacing of 60~km.  The domain parameters are defined in the {\it domain.param} file and  
the values used for practice run are listed in Table~\ref{domain_file}. \\

\noindent
{\bf STEP 1.}  Link the necessary data files stored on {\bf /home/RAID-D1/} \\
 to the {\bf RegCM/PreProc/DATA} sub-directory. \\ 

\noindent
go into the DATA subdirectory, \\

\indent 
$\rightarrow$ cd RegCM/PreProc/DATA \\ 

\noindent
edit the datalinker script using a text editor such as xemacs, \\

\indent
$\rightarrow$ xemacs {\it datalinker.x} \\ 

\noindent
execute the datalinker script, \\

\indent
$\rightarrow$ ./datalinker.x \\

\noindent
{\bf STEP 2.}  Go into the Terrain sub-directory and edit the {\it domain.param} file which contains
information regarding domain and grid parameters.  \\ 

\noindent
go into the TERRAIN subdirectory, \\

\indent 
$\rightarrow$ cd RegCM/PreProc/Terrain \\ 

\noindent
edit the domain.param file, \\

\indent 
$\rightarrow$ xemacs {\it domain.param} \\


\noindent
{\bf STEP 3.}  Run the {\it terrain.x} script.  This compiles code and 
creates an executable file called {\it terrain} that is used to generate the {\it DOMAIN} 
file, and creates two symbolic links, {\it CAT.CDF} and {\it ELEV.CDF}, 
to the landuse and elevation datasets, respectively.  \\

\noindent
copy the appropriate Makefile according to what kind of machine you're working on, \\

\indent 
$\rightarrow$   {cp Makefile\_PGI5 Makefile} \\

\noindent
execute the terrain script, \\

\indent 
$\rightarrow$   {\it ./terrain.x} \\


\noindent
This will generate two files in the {\bf RegCM/Input} sub-directory, {\it DOMAIN} and 
{\it DOMAIN.CTL} (See Table~\ref{ter_var} for a list of variables). To view the file in GrADS, \\

\noindent
go into the Input subdirectory, \\

\indent
$\rightarrow$   cd {\bf ../../RegCM/Input} \\ 

\noindent
open GrADS, \\

\indent
$\rightarrow$   '{\bf grads}'  (opens GrADS) \\ 

\indent
grads $\rightarrow$   open {\it DOMAIN.CTL} (opens file in GrADS) \\
\indent
grads $\rightarrow$   q file  (list variables in {\it DOMAIN} ) \\
\indent
grads $\rightarrow$   d ht  (displays elevation contours over domain) \\


\subsubsection{ICBC}
\noindent
The second step is to interpolate the sea surface temperature and global analysis data that will be used for the initial and boundary conditions to the model grid.  This step is performed in the {\bf RegCM3/PreProc/ICBC} sub-directory.  \\

\noindent
{\bf STEP 1.}  Go into the ICBC sub-directory and execute the icbc script. It is not necessary to modify any files in this directory.  Simply run the {\it icbc.x} script and it will create and run the executables to generate the files for initial and boundary conditions.   \\

\noindent
copy the appropriate Makefile according to what kind of machine your working on, \\

\indent 
$\rightarrow$ cd {\bf ../../RegCM/PreProc/ICBC} \\
\indent 
$\rightarrow$   {cp Makefile\_PGI5 Makefile} \\ 
\indent 
$\rightarrow$   {\it ./icbc.x} \\

\noindent
This will generate two files in the {\bf RegCM/Input} 
sub-directory, {\it ICBC1994062500} and {\it ICBC1994062500.CTL}. 
These files are used to 
for the initial and boundary conditions during the simulation.


\subsection{Running the Model}
\begin{table}[h]
\begin{center}
\caption{List of variables to be modified in {\it regcm.in} file.}  \label{regcm.in_file2}
\vspace{0.25cm}
\begin{tabular}{|l|c|l|} \hline \hline
{\small {\bf Parameter}} &  {\small {\bf Value}} & {\small {\bf Description}} \\ \hline \hline
{\footnotesize {\bf ifrest}} & {\footnotesize .false.} & {\footnotesize true or false for restart simulation} \\ \hline
{\footnotesize {\bf idate0}} &  {\footnotesize 1994062500} & {\footnotesize start date of first simulation} \\ \hline
{\footnotesize {\bf idate1}} &  {\footnotesize 1994062500} & {\footnotesize start date of this simulation} \\ \hline
{\footnotesize {\bf idate2}} &  {\footnotesize 1994070100} & {\footnotesize end date of this simulation} \\ \hline
{\footnotesize {\bf radfrq}} &  {\footnotesize 30} & {\footnotesize time step for radiation model} \\ \hline
{\footnotesize {\bf abemh}} &  {\footnotesize 18} & {\footnotesize time step for LW absorption/emissivity} \\ \hline
{\footnotesize {\bf abatm}} &  {\footnotesize 540} & {\footnotesize time step for LSM} \\ \hline
{\footnotesize {\bf dt}}  &  {\footnotesize 180} & {\footnotesize time step for atmosphere model} \\ \hline
\end{tabular}
\end{center}
\end{table}

\indent
It is convenient to create a new directory for your simulation where the executable file and
model output files will be written.  \\

\noindent
{\bf STEP 1.} Create a sub-directory called {\bf RegCM/PracticeRun} and copy the 
{\it regcm.in} and {\it regcm.x} in the {\bf RegCM/Commons} subdirectory to it. \\

\noindent
make a second level subdirectory called PracticeRun, \\

\indent 
$\rightarrow$ mkdir {\bf PracticeRun} \\ 

\noindent
go into the new subdirectory PracticeRun, \\

\indent 
$\rightarrow$ cd  {\bf PracticeRun}  \\ 

\noindent
copy the two files, regcm.in and regcm.x, from the Commons subdirectory, \\

\indent 
$\rightarrow$ cp  {\bf ../Commons/}{\it regcm.in} .  \\ 
\indent
$\rightarrow$ cp  {\bf ../Commons/}{\it regcm.x}  .  \\ 


\indent
{\bf STEP 2.} Before running the simulation you only need to modify the 
the {\it regcm.in} file.  This file contains parameters regarding the 
use of restart files and physics options.  Edit the file according to the parameters 
defined in Table~\ref{regcm.in_file} and Table~\ref{regcm.in_file2}.  First, a 5-day 
simulation from 25 June 1994 00 UTC through 1 July 1994 00 UTC will be performed.  \\

\noindent
edit the regcm.in file, \\

\indent 
$\rightarrow$   xemacs {\it regcm.in} \\ 

\noindent
copy the appropriate Makefile  in the Main subdirectory according to what kind of machine you are working on, \\

\indent 
$\rightarrow$   {cp ../Main/Makefile\_PGI ../Main/Makefile} \\

\noindent
{\bf STEP 3.} Run the {\it regcm.x} script.  This will compile the source code and start 
the simulation. \\

\indent 
$\rightarrow$   {\it ./regcm.x } \\


\noindent
After the simulation is completed you will have the following monthly files of model output in the 
{\bf RegCM/PracticeRun/output} sub-directory, \\
\\

{\it ATM.1994062500} - output from the atmospheric model \\
\indent
{\it RAD.1994062500} - output from the radiation model  \\
\indent
{\it SRF.1994062500} - output from the land surface model \\
\indent
{\it SAV.1994070100} - restart file \\

\subsubsection{Restarting the model}
To restart the model you only need to modify a few parameters in the 
{\it regcm.in} file and link the appropriate SAV file.  

\noindent
{\bf STEP 0.} Before start the restart run, you need check whether the ICBC data (under  {\bf RegCM/Input} directory)for
retart run are well prepared or not, if no, you need go back {\bf RegCM/PreProc/ICBC} directory, and edit {\it icbc.param}, then run icbc.x to create the ICBC files for retart run.

\noindent
{\bf STEP 1.} Edit the the following restart parameters in the {\it regcm.in} file.  \\

\indent 
$\bullet$   ifrest = .true.  (indicates this is a restart simulations) \\
\indent 
$\bullet$   idate0 = 1994062500  (start date of first simulation) \\
\indent 
$\bullet$   idate1 = 1994070100  (start date for restart simulation) \\
\indent 
$\bullet$   idate2 = 1994080100  (end date for restart simulation) \\

\noindent
{\bf STEP 2.} Create a symbolic link to the SAV file from the previous output to fort.14. In this case, we link output/SAV.1994070100 to fort.14 \\
\indent
ln -s output/SAV.1994070100 fort.14  \\ 

\noindent
Or you can also put the link command above into your regcm.x script if you like.

\noindent
{\bf STEP 3.} Run the {\it regcm.x} script to restart the simulation. \\

\indent 
$\rightarrow$   {\it ./regcm.x } \\

\noindent
After the simulation is complete you will have the following monthly files of model output in the 
{\bf RegCM/PracticeRun/output} sub-directory, \\
\\

{\it ATM.1994070100} - output from the atmospheric model \\
\indent
{\it RAD.1994070100} - output from the radiation model  \\
\indent
{\it SRF.1994070100} - output from the land surface model \\
\indent
{\it SAV.1994080100} - restart file \\


\subsection{Post-processing}
Now you will use the RegCM postprocessor to convert your model output files 
to files containing daily averages of the variables in NetCDF format.  Since this
is your first time using the postprocessor, first you will need to go into 
the {\bf RegCM/PostProc} sub-directory and copy the appropriate Makefile. \\

\indent 
$\rightarrow$   cd {\bf RegCM/PostProc} \\
\indent 
$\rightarrow$   cp Makefile\_PGI5  Makefile \\

\noindent
Also you will need to copy the {\bf RegCM/PostProc}/{\it postproc.x} script into 
your working directory.

\indent
$\rightarrow$   cp {\it postproc.x}  ../PracticeRun/. \\

\noindent
{\bf STEP 1} Now edit the {\it postproc.in} file which has already been created in your
working directory.  In this file you can specify what type of averaging you 
want to do (ie daily, monthly) and the file format.  For this practice run 
you will create files with a monthly average in NetCDF format. \\

\noindent
go into your working directory and edit the {\it postproc.in} file \\

\indent 
$\rightarrow$   cd ../PracticeRun \\
\indent 
$\rightarrow$   xemacs {\it postproc.in} \\

\noindent
next run the {\it postproc.x} script,

\indent 
$\rightarrow$   {\it ./postproc.x} \\

\noindent
After you execute the script, you will be asked which of the output files
you want to convert ({\bf ATM, SRF, or RAD}).  You can only select 
one at a time so you will need to run the {\it postproc.x} script three times
to generate daily averaged NetCDF files for all of your model output.

\subsubsection{Interpolating observational data to your RegCM grid}
Now you will generate files of observational data interpolated to your
RegCM grid to compare to the model output.  The CRU preprocessor 
interpolates the gridded .5 $\times$ .5 degree global CRU observational 
datasets of precipitation, temperature, diurnal temperature range, 
cloud cover, and water vapor to your grid.  The CRU preprocessor is 
in the {\bf RegCM/Obs/CRU} sub-directory so you will need to go into that
directory, \\

\indent 
$\rightarrow$   cd ../Obs/CRU \\

\noindent
you only need to change two parameters in the {\it cru.param}, \\

\indent 
$\bullet$   idatecru1 = 199407  (start date) \\
\indent 
$\bullet$   idatecru2 = 199407  (end date) \\

\noindent
and maybe the names of the output files if you like. \\

\noindent
Next run the {\it cruPGI5.x} script which will compile and execute the 
CRU2RCM.f program. \\

\indent 
$\rightarrow$   ./cruPGI5.x \\

\noindent
This will create the following five NetCDF files, \\

{\it CRUPRE.CDF} - monthly precipitation CRU file  \\
\indent
{\it CRUTMP.CDF} - monthly temperature CRU file  \\
\indent
{\it CRUDTR.CDF} - monthly diurnal temperature range CRU file\\
\indent
{\it CRUVAP.CDF} - monthly water vapor CRU file \\
\indent
{\it CRUCLD.CDF} - monthly cloud cover CRU file \\
