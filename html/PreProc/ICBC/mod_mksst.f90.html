<HTML>

<HEAD>
<TITLE>mod_mksst.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>mod_mksst.f90</H1>
<HR>
<H2 ALIGN=CENTER>mod_mksst.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=mod_mksst><H3>mod_mksst</H3></a></p>20:       module mod_mksst
21: 
22:       contains
23: !
24: !-----------------------------------------------------------------------
25: !
<p><a name=mksst><H3>mksst</H3></a></p> Click <a href="./callingtree/mksst_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where mksst is used.
<hr>
26:       subroutine mksst(tsccm,sst1,sst2,topogm,xlandu,jx,iy,nyrp,nmop,wt)
27:       implicit none
28: !
29: ! Dummy arguments
30: !
31:       integer :: iy , jx , nmop , nyrp
32:       real(4) :: wt
33:       real(4) , dimension(jx,iy) :: sst1 , sst2 , topogm , tsccm ,      &
34:                                  &  xlandu
35:       intent (in) iy , jx , nmop , nyrp , topogm , xlandu
36:       intent (out) tsccm
37:       intent (inout) sst1 , sst2 , wt
38: !
39: ! Local variables
40: !
41:       integer :: i , j , lat , lon , nday , nmo , nyear
42: !
43: !     ******           INITIALIZE SST1, SST2 (NEEDED FOR 82 JAN CASE)
44: !
45:       do lon = 1 , jx
46:         do lat = 1 , iy
47:           sst1(lon,lat) = 0.
48:           sst2(lon,lat) = 0.
49:         end do
50:       end do
51:  
52:       if ( nyrp==0 ) then
53:         wt = 1.
54:         go to 200
55:       end if
56:  
57: !     ******           READ IN RCM MONTHLY SST DATASET
58:  100  continue
59:       read (60,end=300) nday , nmo , nyear , ((sst1(i,j),j=1,iy),i=1,jx)
60:       if ( nyear<100 ) nyear = nyear + 1900
61:       if ( (nyear/=nyrp) .or. (nmo/=nmop) ) go to 100
62: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
63:  
64: !     ******           READ IN RCM MONTHLY SST DATASET
65:  200  continue
66:       read (60,end=300) nday , nmo , nyear , ((sst2(i,j),j=1,iy),i=1,jx)
67:       if ( nyear<100 ) nyear = nyear + 1900
68: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
69:       rewind (60)
70:  
71:       do i = 1 , jx
72:         do j = 1 , iy
73:           if ( (topogm(i,j)<=1.) .and.                                  &
74:              & (xlandu(i,j)>13.9 .and. xlandu(i,j)<15.1) .and.          &
75:              & (sst1(i,j)>-900.0 .and. sst2(i,j)>-900.0) ) tsccm(i,j)   &
76:              & = (1.-wt)*sst1(i,j) + wt*sst2(i,j)
77:         end do
78:       end do
79:  
80:       rewind (60)
81:  
82:       return
83:  300  continue
84:       print * , 'SST file is not the right one'
85:       stop 12
86:       end subroutine mksst
87: !
88: !-----------------------------------------------------------------------
89: !
<p><a name=mkssta><H3>mkssta</H3></a></p> Click <a href="./callingtree/mkssta_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where mkssta is used.
<hr>
90:       subroutine mkssta(tsccm,sst1,sst2,ice1,ice2,topogm,xlandu,jx,iy,  &
91:                       & nyrp,nmop,wt)
92:       implicit none
93: !
94: ! Dummy arguments
95: !
96:       integer :: iy , jx , nmop , nyrp
97:       real(4) :: wt
98:       real(4) , dimension(jx,iy) :: ice1 , ice2 , sst1 , sst2 , topogm ,&
99:                                & tsccm , xlandu
100:       intent (in) iy , jx , nmop , nyrp , topogm , xlandu
101:       intent (out) tsccm
102:       intent (inout) ice1 , ice2 , sst1 , sst2 , wt
103: !
104: ! Local variables
105: !
106:       integer :: i , j , lat , lon , nday , nmo , nyear
107:  
108: !     ******           INITIALIZE SST1, SST2 (NEEDED FOR 82 JAN CASE)
109:       do lon = 1 , jx
110:         do lat = 1 , iy
111:           sst1(lon,lat) = 0.
112:           sst2(lon,lat) = 0.
113:           ice1(lon,lat) = 0.
114:           ice2(lon,lat) = 0.
115:         end do
116:       end do
117:  
118:       if ( nyrp==0 ) then
119:         wt = 1.
120:         go to 200
121:       end if
122:  
123: !     ******           READ IN RCM MONTHLY SST DATASET
124:  100  continue
125:       read (60,end=300) nday , nmo , nyear , ((sst1(i,j),j=1,iy),i=1,jx)&
126:                       & , ((ice1(i,j),j=1,iy),i=1,jx)
127:       if ( nyear<100 ) nyear = nyear + 1900
128:       if ( (nyear/=nyrp) .or. (nmo/=nmop) ) go to 100
129: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
130:  
131: !     ******           READ IN RCM MONTHLY SST DATASET
132:  200  continue
133:       read (60,end=300) nday , nmo , nyear , ((sst2(i,j),j=1,iy),i=1,jx)&
134:                       & , ((ice2(i,j),j=1,iy),i=1,jx)
135:       if ( nyear<100 ) nyear = nyear + 1900
136: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
137:       rewind (60)
138:  
139:       do i = 1 , jx
140:         do j = 1 , iy
141:           if ( (topogm(i,j)<=1.) .and.                                  &
142:              & (xlandu(i,j)>13.9 .and. xlandu(i,j)<15.1) .and.          &
143:              & (sst1(i,j)>-900.0 .and. sst2(i,j)>-900.0) ) then
144:             tsccm(i,j) = (1.-wt)*sst1(i,j) + wt*sst2(i,j)
145:             if ( ice1(i,j)>-900.0 .and. ice2(i,j)>-900.0 ) then
146:               if ( (1.-wt)*ice1(i,j)+wt*ice2(i,j)>35. ) tsccm(i,j)      &
147:                  & = 273.15 - 2.15
148:             end if
149:           end if
150:         end do
151:       end do
152:  
153:       rewind (60)
154:  
155:       return
156:  300  continue
157:       print * , 'SST&SeaIce file is not the right one'
158:       stop 12
159:       end subroutine mkssta
160: !
161: !-----------------------------------------------------------------------
162: !
<p><a name=mksst2><H3>mksst2</H3></a></p> Click <a href="./callingtree/mksst2_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where mksst2 is used.
<hr>
163:       subroutine mksst2(tsccm,sst1,sst2,topogm,xlandu,jx,iy,kdate)
164:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
165:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
166:       implicit none
167: !
168: ! Dummy arguments
169: !
170:       integer :: iy , jx , kdate
171:       real(4) , dimension(jx,iy) :: sst1 , sst2 , topogm , tsccm ,      &
172:                                  &  xlandu
173:       intent (in) iy , jx , kdate , topogm , xlandu
174:       intent (out) tsccm
175:       intent (inout) sst1 , sst2
176: !
177: ! Local variables
178: !
179:       integer :: i , j , k , kdate1 , kdate2 , ks , ks1 , ks2 , lat ,   &
180:                & lon , nday , nmo , nyear
181:       real(4) :: wt
182: !
183:       ks = 427 + 1097
184:       do k = 427 + 1097 , 1 , -1
185:         if ( wkday(k)<=kdate ) then
186:           ks = k
187:           exit
188:         end if
189:       end do
190:       kdate1 = wkday(ks)
191: !
192:       do k = 1 , 427 + 1097
193:         if ( wkday(k)>kdate ) then
194:           ks = k
195:           exit
196:         end if
197:       end do
198:       kdate2 = wkday(ks)
199:       call <a href="./mod_date.f90.html#finddate_icbc" TARGET=CENT_PANEL>finddate_icbc</a>(ks1,kdate1*100)
200:       call <a href="./mod_date.f90.html#finddate_icbc" TARGET=CENT_PANEL>finddate_icbc</a>(ks,kdate*100)
201:       call <a href="./mod_date.f90.html#finddate_icbc" TARGET=CENT_PANEL>finddate_icbc</a>(ks2,kdate2*100)
202:       wt = float(ks-ks1)/float(ks2-ks1)
203:  
204: !     ******           INITIALIZE SST1, SST2 (NEEDED FOR 82 JAN CASE)
205:       do lon = 1 , jx
206:         do lat = 1 , iy
207:           sst1(lon,lat) = 0.
208:           sst2(lon,lat) = 0.
209:         end do
210:       end do
211:  
212: !     ******           READ IN RCM MONTHLY SST DATASET
213:  100  continue
214:       read (60,end=200) nday , nmo , nyear , ((sst1(i,j),j=1,iy),i=1,jx)
215:       if ( nyear*10000+nmo*100+nday/=kdate1 ) go to 100
216: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
217:  
218: !     ******           READ IN RCM MONTHLY SST DATASET
219:       read (60,end=200) nday , nmo , nyear , ((sst2(i,j),j=1,iy),i=1,jx)
220: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
221:  
222:       do i = 1 , jx
223:         do j = 1 , iy
224:           if ( (topogm(i,j)<=1.) .and.                                  &
225:              & (xlandu(i,j)>13.9 .and. xlandu(i,j)<15.1) .and.          &
226:              & (sst1(i,j)>-900.0 .and. sst2(i,j)>-900.0) ) tsccm(i,j)   &
227:              & = (1.-wt)*sst1(i,j) + wt*sst2(i,j)
228:         end do
229:       end do
230:  
231:       rewind (60)
232:  
233:       return
234:  200  continue
235:       print * , 'SST file is not the right one'
236:       stop 12
237:       end subroutine mksst2
238: !
239: !-----------------------------------------------------------------------
240: !
<p><a name=mksst2a><H3>mksst2a</H3></a></p> Click <a href="./callingtree/mksst2a_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where mksst2a is used.
<hr>
241:       subroutine mksst2a(tsccm,sst1,sst2,ice1,ice2,topogm,xlandu,jx,iy, &
242:                        & kdate)
243:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
244:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
245:       implicit none
246: !
247: ! Dummy arguments
248: !
249:       integer :: iy , jx , kdate
250:       real(4) , dimension(jx,iy) :: ice1 , ice2 , sst1 , sst2 , topogm ,&
251:                                & tsccm , xlandu
252:       intent (in) iy , jx , kdate , topogm , xlandu
253:       intent (out) tsccm
254:       intent (inout) ice1 , ice2 , sst1 , sst2
255: !
256: ! Local variables
257: !
258:       integer :: i , j , k , kdate1 , kdate2 , ks , ks1 , ks2 , lat ,   &
259:                & lon , nday , nmo , nyear
260:       real(4) :: wt
261: !
262:       ks = 427 + 1097
263:       do k = 427 + 1097 , 1 , -1
264:         if ( wkday(k)<=kdate ) then
265:           ks = k
266:           exit
267:         end if
268:       end do
269:       kdate1 = wkday(ks)
270: !
271:       do k = 1 , 427 + 1097
272:         if ( wkday(k)>kdate ) then
273:           ks = k
274:           exit
275:         end if
276:       end do
277:       kdate2 = wkday(ks)
278:       call <a href="./mod_date.f90.html#finddate_icbc" TARGET=CENT_PANEL>finddate_icbc</a>(ks1,kdate1*100)
279:       call <a href="./mod_date.f90.html#finddate_icbc" TARGET=CENT_PANEL>finddate_icbc</a>(ks,kdate*100)
280:       call <a href="./mod_date.f90.html#finddate_icbc" TARGET=CENT_PANEL>finddate_icbc</a>(ks2,kdate2*100)
281:       wt = float(ks-ks1)/float(ks2-ks1)
282:  
283: !     ******           INITIALIZE SST1, SST2 (NEEDED FOR 82 JAN CASE)
284:       do lon = 1 , jx
285:         do lat = 1 , iy
286:           sst1(lon,lat) = 0.
287:           sst2(lon,lat) = 0.
288:         end do
289:       end do
290:  
291: !     ******           READ IN RCM MONTHLY SST DATASET
292:  100  continue
293:       read (60,end=200) nday , nmo , nyear , ((sst1(i,j),j=1,iy),i=1,jx)&
294:                       & , ((ice1(i,j),j=1,iy),i=1,jx)
295:       if ( nyear*10000+nmo*100+nday/=kdate1 ) go to 100
296: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
297:  
298: !     ******           READ IN RCM MONTHLY SST DATASET
299:       read (60,end=200) nday , nmo , nyear , ((sst2(i,j),j=1,iy),i=1,jx)&
300:                       & , ((ice2(i,j),j=1,iy),i=1,jx)
301: !     PRINT *, 'READING RCM SST DATA:', NMO, NYEAR
302:  
303:       do i = 1 , jx
304:         do j = 1 , iy
305:           if ( (topogm(i,j)<=1.) .and.                                  &
306:              & (xlandu(i,j)>13.9 .and. xlandu(i,j)<15.1) .and.          &
307:              & (sst1(i,j)>-900.0 .and. sst2(i,j)>-900.0) ) then
308:             tsccm(i,j) = (1.-wt)*sst1(i,j) + wt*sst2(i,j)
309:             if ( (1.-wt)*ice1(i,j)+wt*ice2(i,j)>35. ) tsccm(i,j)        &
310:                & = 273.15 - 2.15
311:           end if
312:         end do
313:       end do
314:  
315:       rewind (60)
316:  
317:       return
318:  200  continue
319:       print * , 'SST&SeaIce file is not the right one'
320:       stop 12
321:       end subroutine mksst2a
322: !
323: !-----------------------------------------------------------------------
324: !
<p><a name=mksst3><H3>mksst3</H3></a></p> Click <a href="./callingtree/mksst3_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where mksst3 is used.
<hr>
325:       subroutine mksst3(tsccm,sst1,topogm,xlandu,jx,iy,kdate)
326:       implicit none
327: !
328: ! Dummy arguments
329: !
330:       integer :: iy , jx , kdate
331:       real(4) , dimension(jx,iy) :: sst1 , topogm , tsccm , xlandu
332:       intent (in) iy , jx , kdate , topogm , xlandu
333:       intent (out) tsccm
334:       intent (inout) sst1
335: !
336: ! Local variables
337: !
338:       integer :: i , j , mday , mhour , mmo , myear , nday , nhour ,    &
339:                & nmo , nyear
340: !
341:       nyear = kdate/1000000
342:       nmo = (kdate-nyear*1000000)/10000
343:       nday = (kdate-nyear*1000000-nmo*10000)/100
344:       nhour = kdate - nyear*1000000 - nmo*10000 - nday*100
345: !
346: !     ******           INITIALIZE SST1, SST2 (NEEDED FOR 82 JAN CASE)
347:  
348: !     ******           READ IN RCM 6 HOUR SST DATASET
349:  100  continue
350:       read (60,end=200) mhour , mday , mmo , myear ,                    &
351:                       & ((sst1(i,j),j=1,iy),i=1,jx)
352:       if ( nyear/=myear .or. nmo/=mmo .or. nday/=mday .or.              &
353:          & nhour/=mhour ) go to 100
354:  
355:       do i = 1 , jx
356:         do j = 1 , iy
357:           if ( (topogm(i,j)<=1.) .and.                                  &
358:              & (xlandu(i,j)>13.9 .and. xlandu(i,j)<15.1) .and.          &
359:              & (sst1(i,j)>-900.0) ) tsccm(i,j) = sst1(i,j)
360:         end do
361:       end do
362:  
363:       rewind (60)
364:  
365:       return
366:  200  continue
367:       print * , 'SST file is not the right one'
368:       stop 12
369:       end subroutine mksst3
370: !
371:       end module mod_mksst
</PRE>

<HR>

</BODY>
</HTML>
