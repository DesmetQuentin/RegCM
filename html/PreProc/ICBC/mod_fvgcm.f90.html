<HTML>

<HEAD>
<TITLE>mod_fvgcm.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>mod_fvgcm.f90</H1>
<HR>
<H2 ALIGN=CENTER>mod_fvgcm.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=mod_fvgcm><H3>mod_fvgcm</H3></a></p>20:       module mod_fvgcm
21:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
22: 
23:       implicit none
24: 
25:       private
26: 
27:       integer , parameter :: nlev2 = 18 , nlat2 = 181 , nlon2 = 288
28: 
29:       real(4) , dimension(nlev2+1) :: ak , bk
30:       real(4) , dimension(nlev2) :: pplev , sigma1 , sigmar
31:       real(4) , dimension(nlat2) :: vlat
32:       real(4) , dimension(nlon2) :: vlon
33: 
34:       real(4) , target , dimension(nlon2,nlat2,nlev2*4+1) :: bb
35:       real(4) , target , dimension(nlon2,nlat2,nlev2*3) :: b2
36:       real(4) , target , dimension(nlon2,nlat2,nlev2*2) :: d2
37:       real(4) , allocatable , target , dimension(:,:,:) :: b3
38:       real(4) , allocatable , target , dimension(:,:,:) :: d3
39:       real(4) , allocatable , dimension(:,:,:) :: w3
40:       real(4) , allocatable , dimension(:,:) :: b3pd
41: 
42:       real(4) , dimension(nlon2,nlat2) :: zs2
43:       real(4) , dimension(nlon2,nlat2,nlev2) :: pp3d , z1
44: 
45:       real(4) , pointer , dimension(:,:) :: ps2
46:       real(4) , pointer , dimension(:,:,:) :: q2 , t2 , u2 , v2
47:       real(4) , pointer , dimension(:,:,:) :: tp , qp , hp
48:       real(4) , pointer , dimension(:,:,:) :: up , vp
49:       real(4) , pointer , dimension(:,:,:) :: t3 , q3 , h3
50:       real(4) , pointer , dimension(:,:,:) :: u3 , v3
51: 
52:       public :: getfvgcm , headerfv
53: 
54:       contains
55: 
<p><a name=getfvgcm><H3>getfvgcm</H3></a></p> Click <a href="./callingtree/getfvgcm_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where getfvgcm is used.
<hr>
56:       subroutine getfvgcm(idate)
57:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a> , only : julian
58:       use <a href="./mod_grid.f90.html#mod_grid" TARGET=CENT_PANEL>mod_grid</a>
59:       use <a href="./mod_write.f90.html#mod_write" TARGET=CENT_PANEL>mod_write</a>
60:       use <a href="./mod_interp.f90.html#mod_interp" TARGET=CENT_PANEL>mod_interp</a> , only : bilinx2
61:       use <a href="./mod_vertint.f90.html#mod_vertint" TARGET=CENT_PANEL>mod_vertint</a>
62:       use <a href="./mod_hgt.f90.html#mod_hgt" TARGET=CENT_PANEL>mod_hgt</a>
63:       use <a href="./mod_humid.f90.html#mod_humid" TARGET=CENT_PANEL>mod_humid</a>
64:       use <a href="./mod_mksst.f90.html#mod_mksst" TARGET=CENT_PANEL>mod_mksst</a>
65:       use <a href="./mod_uvrot.f90.html#mod_uvrot" TARGET=CENT_PANEL>mod_uvrot</a>
66:       use <a href="./mod_vectutil.f90.html#mod_vectutil" TARGET=CENT_PANEL>mod_vectutil</a>
67:       implicit none
68: !
69: ! Dummy arguments
70: !
71:       integer :: idate
72: !
73: ! Local variables
74: !
75:       character(3) , dimension(12) :: chmon
76:       character(20) :: finm , fips
77:       character(5) :: fn_a2 , fn_rf , pn_a2 , pn_rf
78:       integer :: i , i2 , ii , j , j2 , k , month , mrec , nday ,       &
79:                & nhour , nmop , nrec , numx , numy , nyear , nyrp
80:       integer(2) , dimension(288,181) :: itmp
81:       real(8) :: offset , xscale
82:       real(4) , dimension(288,181) :: temp
83:       logical :: there
84:       real(4) :: wt
85:       character(4) , dimension(30) :: yr_a2 , yr_rf
86: !
87:       data fn_rf/'FV_RF'/ , fn_a2/'FV_A2'/
88:       data pn_rf/'PS_RF'/ , pn_a2/'PS_A2'/
89:       data yr_rf/'1961' , '1962' , '1963' , '1964' , '1965' , '1966' ,  &
90:           &'1967' , '1968' , '1969' , '1970' , '1971' , '1972' ,        &
91:          & '1973' , '1974' , '1975' , '1976' , '1977' , '1978' ,        &
92:          & '1979' , '1980' , '1981' , '1982' , '1983' , '1984' ,        &
93:          & '1985' , '1986' , '1987' , '1988' , '1989' , '1990'/
94:       data yr_a2/'2071' , '2072' , '2073' , '2074' , '2075' , '2076' ,  &
95:           &'2077' , '2078' , '2079' , '2080' , '2081' , '2082' ,        &
96:          & '2083' , '2084' , '2085' , '2086' , '2087' , '2088' ,        &
97:          & '2089' , '2090' , '2091' , '2092' , '2093' , '2094' ,        &
98:          & '2095' , '2096' , '2097' , '2098' , '2099' , '2100'/
99:       data chmon/'JAN' , 'FEB' , 'MAR' , 'APR' , 'MAY' , 'JUN' , 'JUL' ,&
100:           &'AUG' , 'SEP' , 'OCT' , 'NOV' , 'DEC'/
101: !
102: !
103:       if ( idate==globidate1 ) then
104:         numx = nint((lon1-lon0)/1.25) + 1
105:         numy = nint(lat1-lat0) + 1
106:         inquire (file=trim(inpglob)//'/FVGCM/HT_SRF',exist=there)
107:         if ( .not.there ) then
108:           write (*,*) trim(inpglob)//'/FVGCM/HT_SRF is not available'
109:           stop
110:         end if
111:         open (61,file=trim(inpglob)//'/FVGCM/HT_SRF',form='unformatted',&
112:             & recl=numx*numy*ibyte,access='direct')
113:         read (61,rec=1) ((temp(i,j),i=1,numx),j=1,numy)
114:         do j = nint(lat0) , nint(lat1)
115:           do i = nint(lon0/1.25) , nint(lon1/1.25)
116:             ii = i + 1
117:             if ( ii<=0 ) ii = ii + 288
118:             if ( ii>288 ) ii = ii - 288
119:             i2 = i - nint(lon0/1.25) + 1
120:             j2 = j - nint(lat0) + 1
121:             zs2(ii,j+91) = temp(i2,j2)/9.80616
122:           end do
123:         end do
124:         close (61)
125:       end if
126:  
127:       nyear = idate/1000000
128:       month = idate/10000 - nyear*100
129:       nday = idate/100 - (idate/10000)*100
130:       nhour = mod(idate,100)
131:  
132:       if ( nday/=1 .or. nhour/=0 ) then
133:         if ( ssttyp=='FV_RF' ) then
134:           finm = 'RF/'//yr_rf(nyear-1960)//'/'//fn_rf//yr_rf(nyear-1960)&
135:                & //chmon(month)
136:           fips = 'RF/'//yr_rf(nyear-1960)//'/'//pn_rf//yr_rf(nyear-1960)&
137:                & //chmon(month)
138:         else if ( ssttyp=='FV_A2' ) then
139:           finm = 'A2/'//yr_a2(nyear-2070)//'/'//fn_a2//yr_a2(nyear-2070)&
140:                & //chmon(month)
141:           fips = 'A2/'//yr_a2(nyear-2070)//'/'//pn_a2//yr_a2(nyear-2070)&
142:                & //chmon(month)
143:         else
144:           write (*,*) 'ERROR IN SSTTYP'
145:           stop
146:         end if
147:       else if ( month/=1 ) then
148:         if ( ssttyp=='FV_RF' ) then
149:           finm = 'RF/'//yr_rf(nyear-1960)//'/'//fn_rf//yr_rf(nyear-1960)&
150:                & //chmon(month-1)
151:           fips = 'RF/'//yr_rf(nyear-1960)//'/'//pn_rf//yr_rf(nyear-1960)&
152:                & //chmon(month-1)
153:         else if ( ssttyp=='FV_A2' ) then
154:           finm = 'A2/'//yr_a2(nyear-2070)//'/'//fn_a2//yr_a2(nyear-2070)&
155:                & //chmon(month-1)
156:           fips = 'A2/'//yr_a2(nyear-2070)//'/'//pn_a2//yr_a2(nyear-2070)&
157:                & //chmon(month-1)
158:         else
159:           write (*,*) 'ERROR IN SSTTYP'
160:           stop
161:         end if
162:       else if ( ssttyp=='FV_RF' ) then
163:         if ( nyear==1961 ) then
164:           write (*,*) 'Fields on 00z01jan1961 is not saved'
165:           write (*,*) 'Please run from 00z02jan1961'
166:           stop
167:         end if
168:         finm = 'RF/'//yr_rf(nyear-1961)//'/'//fn_rf//yr_rf(nyear-1961)  &
169:              & //chmon(12)
170:         fips = 'RF/'//yr_rf(nyear-1961)//'/'//pn_rf//yr_rf(nyear-1961)  &
171:              & //chmon(12)
172:       else if ( ssttyp=='FV_A2' ) then
173:         if ( nyear==2071 ) then
174:           write (*,*) 'Fields on 00z01jan2071 is not saved'
175:           write (*,*) 'Please run from 00z02jan2071'
176:           stop
177:         end if
178:         finm = 'A2/'//yr_a2(nyear-2071)//'/'//fn_a2//yr_a2(nyear-2071)  &
179:              & //chmon(12)
180:         fips = 'A2/'//yr_a2(nyear-2071)//'/'//pn_a2//yr_a2(nyear-2071)  &
181:              & //chmon(12)
182:       else
183:         write (*,*) 'ERROR IN SSTTYP'
184:         stop
185:       end if
186:       numx = nint((lon1-lon0)/1.25) + 1
187:       numy = nint(lat1-lat0) + 1
188:       do k = 1 , nlev2*4 + 1
189:         do j = 1 , nlat2
190:           do i = 1 , nlon2
191:             bb(i,j,k) = -9999.
192:           end do
193:         end do
194:       end do
195:       inquire (file=trim(inpglob)//'/FVGCM/'//finm,exist=there)
196:       if ( .not.there ) then
197:         write (*,*) trim(inpglob)//'/FVGCM/'//finm , ' is not available'
198:         write (*,*) 'please copy FVGCM output under ',                  &
199:             &       trim(inpglob)//'/FVGCM/'
200:         stop
201:       end if
202:       open (63,file=trim(inpglob)//'/FVGCM/'//finm,form='unformatted',  &
203:           & recl=(numx*numy*2+16)/4*ibyte,access='direct')
204:       open (62,file=trim(inpglob)//'/FVGCM/'//fips,form='unformatted',  &
205:           & recl=numx*numy*ibyte,access='direct')
206:       if ( nday/=1 .or. nhour/=0 ) then
207:         nrec = ((nday-1)*4+nhour/6-1)*(nlev2*4)
208:         mrec = (nday-1)*4 + nhour/6 - 1
209:       else if ( month==1 .or. month==2 .or. month==4 .or. month==6 .or. &
210:               & month==8 .or. month==9 .or. month==11 ) then
211:         nrec = (31*4-1)*(nlev2*4)
212:         mrec = 31*4 - 1
213:       else if ( month==5 .or. month==7 .or. month==10 .or. month==12 )  &
214:               & then
215:         nrec = (30*4-1)*(nlev2*4)
216:         mrec = 30*4 - 1
217:       else if ( mod(nyear,4)==0 .and. nyear/=2100 ) then
218:         nrec = (29*4-1)*(nlev2*4)
219:         mrec = 29*4 - 1
220:       else
221:         nrec = (28*4-1)*(nlev2*4)
222:         mrec = 28*4 - 1
223:       end if
224:       mrec = mrec + 1
225:       read (62,rec=mrec) ((temp(i,j),i=1,numx),j=1,numy)
226:       do j = nint(lat0) , nint(lat1)
227:         do i = nint(lon0/1.25) , nint(lon1/1.25)
228:           ii = i + 1
229:           if ( ii<=0 ) ii = ii + 288
230:           if ( ii>288 ) ii = ii - 288
231:           i2 = i - nint(lon0/1.25) + 1
232:           j2 = j - nint(lat0) + 1
233:           ps2(ii,j+91) = temp(i2,j2)*0.01
234:         end do
235:       end do
236:       do k = 1 , nlev2
237:         nrec = nrec + 1
238:         read (63,rec=nrec) offset , xscale ,                             &
239:                          & ((itmp(i,j),i=1,numx),j=1,numy)
240:         do j = nint(lat0) , nint(lat1)
241:           do i = nint(lon0/1.25) , nint(lon1/1.25)
242:             ii = i + 1
243:             if ( ii<=0 ) ii = ii + 288
244:             if ( ii>288 ) ii = ii - 288
245:             i2 = i - nint(lon0/1.25) + 1
246:             j2 = j - nint(lat0) + 1
247:             u2(ii,j+91,k) = itmp(i2,j2)*xscale + offset
248:           end do
249:         end do
250:       end do
251:       do k = 1 , nlev2
252:         nrec = nrec + 1
253:         read (63,rec=nrec) offset , xscale ,                             &
254:                          & ((itmp(i,j),i=1,numx),j=1,numy)
255:         do j = nint(lat0) , nint(lat1)
256:           do i = nint(lon0/1.25) , nint(lon1/1.25)
257:             ii = i + 1
258:             if ( ii<=0 ) ii = ii + 288
259:             if ( ii>288 ) ii = ii - 288
260:             i2 = i - nint(lon0/1.25) + 1
261:             j2 = j - nint(lat0) + 1
262:             v2(ii,j+91,k) = itmp(i2,j2)*xscale + offset
263:           end do
264:         end do
265:       end do
266:       do k = 1 , nlev2
267:         nrec = nrec + 1
268:         read (63,rec=nrec) offset , xscale ,                             &
269:                          & ((itmp(i,j),i=1,numx),j=1,numy)
270:         do j = nint(lat0) , nint(lat1)
271:           do i = nint(lon0/1.25) , nint(lon1/1.25)
272:             ii = i + 1
273:             if ( ii<=0 ) ii = ii + 288
274:             if ( ii>288 ) ii = ii - 288
275:             i2 = i - nint(lon0/1.25) + 1
276:             j2 = j - nint(lat0) + 1
277:             t2(ii,j+91,k) = itmp(i2,j2)*xscale + offset
278:           end do
279:         end do
280:       end do
281:       do k = 1 , nlev2
282:         nrec = nrec + 1
283:         read (63,rec=nrec) offset , xscale ,                             &
284:                          & ((itmp(i,j),i=1,numx),j=1,numy)
285:         do j = nint(lat0) , nint(lat1)
286:           do i = nint(lon0/1.25) , nint(lon1/1.25)
287:             ii = i + 1
288:             if ( ii<=0 ) ii = ii + 288
289:             if ( ii>288 ) ii = ii - 288
290:             i2 = i - nint(lon0/1.25) + 1
291:             j2 = j - nint(lat0) + 1
292:             q2(ii,j+91,k) = itmp(i2,j2)*xscale + offset
293:           end do
294:         end do
295:       end do
296:       close (63)
297:       close (62)
298:       write (*,*) 'READ IN fields at DATE:' , idate , ' from ' , finm
299:       do k = 1 , nlev2
300:         do j = 1 , nlat2
301:           do i = 1 , nlon2
302:             if ( ps2(i,j)>-9995. ) then
303:               pp3d(i,j,k) = ps2(i,j)*0.5*(bk(k)+bk(k+1))                &
304:                           & + 0.5*(ak(k)+ak(k+1))
305:             else
306:               pp3d(i,j,k) = -9999.0
307:             end if
308:           end do
309:         end do
310:       end do
311: !
312: !     to calculate Heights on sigma surfaces.
313:       call <a href="./mod_hgt.f90.html#htsig" TARGET=CENT_PANEL>htsig</a>(t2,z1,pp3d,ps2,zs2,nlon2,nlat2,nlev2)
314: !
315: !     to interpolate H,U,V,T,Q and QC
316: !     1. For Heights
317:       call <a href="./mod_hgt.f90.html#height" TARGET=CENT_PANEL>height</a>(hp,z1,t2,ps2,pp3d,zs2,nlon2,nlat2,nlev2,pplev,nlev2)
318: !     2. For Zonal and Meridional Winds
319:       call <a href="./mod_vertint.f90.html#intlin" TARGET=CENT_PANEL>intlin</a>(up,u2,ps2,pp3d,nlon2,nlat2,nlev2,pplev,nlev2)
320:       call <a href="./mod_vertint.f90.html#intlin" TARGET=CENT_PANEL>intlin</a>(vp,v2,ps2,pp3d,nlon2,nlat2,nlev2,pplev,nlev2)
321: !     3. For Temperatures
322:       call <a href="./mod_vertint.f90.html#intlog" TARGET=CENT_PANEL>intlog</a>(tp,t2,ps2,pp3d,nlon2,nlat2,nlev2,pplev,nlev2)
323: !     4. For Moisture qva & qca
324:       call <a href="./mod_humid.f90.html#humid1fv" TARGET=CENT_PANEL>humid1fv</a>(t2,q2,pp3d,nlon2,nlat2,nlev2)
325:       call <a href="./mod_vertint.f90.html#intlin" TARGET=CENT_PANEL>intlin</a>(qp,q2,ps2,pp3d,nlon2,nlat2,nlev2,pplev,nlev2)
326: !
327: !     HORIZONTAL INTERPOLATION OF BOTH THE SCALAR AND VECTOR FIELDS
328: !
329:       call <a href="./mod_interp.f90.html#bilinx2" TARGET=CENT_PANEL>bilinx2</a>(b3,b2,xlon,xlat,vlon,vlat,nlon2,nlat2,jx,iy,nlev2*3)
330:       call <a href="./mod_interp.f90.html#bilinx2" TARGET=CENT_PANEL>bilinx2</a>(d3,d2,dlon,dlat,vlon,vlat,nlon2,nlat2,jx,iy,nlev2*2)
331: !
332: !     ROTATE U-V FIELDS AFTER HORIZONTAL INTERPOLATION
333: !
334:       call <a href="./mod_uvrot.f90.html#uvrot4" TARGET=CENT_PANEL>uvrot4</a>(u3,v3,dlon,dlat,clon,clat,grdfac,jx,iy,nlev2,plon,    &
335:                 & plat,iproj)
336: !
337: !     X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X
338: !     X X
339: !     V E R T I C A L   I N T E R P O L A T I O N
340: !
341: !     X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X
342: !     X X
343: !HH:  CHANGE THE VERTICAL ORDER.
344:       call <a href="./mod_vectutil.f90.html#top2btm" TARGET=CENT_PANEL>top2btm</a>(t3,jx,iy,nlev2)
345:       call <a href="./mod_vectutil.f90.html#top2btm" TARGET=CENT_PANEL>top2btm</a>(q3,jx,iy,nlev2)
346:       call <a href="./mod_vectutil.f90.html#top2btm" TARGET=CENT_PANEL>top2btm</a>(h3,jx,iy,nlev2)
347:       call <a href="./mod_vectutil.f90.html#top2btm" TARGET=CENT_PANEL>top2btm</a>(u3,jx,iy,nlev2)
348:       call <a href="./mod_vectutil.f90.html#top2btm" TARGET=CENT_PANEL>top2btm</a>(v3,jx,iy,nlev2)
349: !HH:OVER
350: !
351: !     ******           NEW CALCULATION OF P* ON RegCM TOPOGRAPHY.
352:       call <a href="./mod_vertint.f90.html#intgtb" TARGET=CENT_PANEL>intgtb</a>(pa,za,tlayer,topogm,t3,h3,sigmar,jx,iy,nlev2)
353:  
354:       call <a href="./mod_vertint.f90.html#intpsn" TARGET=CENT_PANEL>intpsn</a>(ps4,topogm,pa,za,tlayer,ptop,jx,iy)
355:       call <a href="./mod_vectutil.f90.html#p1p2" TARGET=CENT_PANEL>p1p2</a>(b3pd,ps4,jx,iy)
356: !
357: !     F0    DETERMINE SURFACE TEMPS ON RegCM TOPOGRAPHY.
358: !     INTERPOLATION FROM PRESSURE LEVELS AS IN INTV2
359:       call <a href="./mod_vertint.f90.html#intv3" TARGET=CENT_PANEL>intv3</a>(ts4,t3,ps4,sigmar,ptop,jx,iy,nlev2)
360:  
361:       if ( ssttyp/='OI_WK' .and. ssttyp/='OI2WK' ) then
362: !       F1    CALCULATE SSTS FOR DATE FROM OBSERVED SSTS
363: !       PRINT *, 'INPUT DAY FOR SST DATA ACQUISITION:', IDATE
364:         call <a href="./mod_date.f90.html#julian" TARGET=CENT_PANEL>julian</a>(idate,nyrp,nmop,wt)
365: !
366:         if ( ssttyp=='OI2ST' ) then
367:           call <a href="./mod_mksst.f90.html#mkssta" TARGET=CENT_PANEL>mkssta</a>(ts4,sst1,sst2,ice1,ice2,topogm,xlandu,jx,iy,nyrp, &
368:                &      nmop,wt)
369:         else
370:           call <a href="./mod_mksst.f90.html#mksst" TARGET=CENT_PANEL>mksst</a>(ts4,sst1,sst2,topogm,xlandu,jx,iy,nyrp,nmop,wt)
371:         end if
372:       else
373:         if ( ssttyp=='OI2WK' ) then
374:           call <a href="./mod_mksst.f90.html#mksst2a" TARGET=CENT_PANEL>mksst2a</a>(ts4,sst1,sst2,ice1,ice2,topogm,xlandu,jx,iy,     &
375:                &      idate/100)
376:         else
377:           call <a href="./mod_mksst.f90.html#mksst2" TARGET=CENT_PANEL>mksst2</a>(ts4,sst1,sst2,topogm,xlandu,jx,iy,idate/100)
378:         end if
379:       end if
380:  
381: !     F2     DETERMINE P* AND HEIGHT.
382: !
383: !     F3     INTERPOLATE U, V, T, AND Q.
384:       call <a href="./mod_vertint.f90.html#intv1" TARGET=CENT_PANEL>intv1</a>(u4,u3,b3pd,sigma2,sigmar,ptop,jx,iy,kz,nlev2)
385:       call <a href="./mod_vertint.f90.html#intv1" TARGET=CENT_PANEL>intv1</a>(v4,v3,b3pd,sigma2,sigmar,ptop,jx,iy,kz,nlev2)
386: !
387:       call <a href="./mod_vertint.f90.html#intv2" TARGET=CENT_PANEL>intv2</a>(t4,t3,ps4,sigma2,sigmar,ptop,jx,iy,kz,nlev2)
388:  
389:       call <a href="./mod_vertint.f90.html#intv1" TARGET=CENT_PANEL>intv1</a>(q4,q3,ps4,sigma2,sigmar,ptop,jx,iy,kz,nlev2)
390:       call <a href="./mod_humid.f90.html#humid2fv" TARGET=CENT_PANEL>humid2fv</a>(t4,q4,ps4,ptop,sigma2,jx,iy,kz)
391: !
392: !     F4     DETERMINE H
393:       call <a href="./mod_hgt.f90.html#hydrost" TARGET=CENT_PANEL>hydrost</a>(h4,t4,topogm,ps4,ptop,sigmaf,sigma2,dsigma,jx,iy,kz)
394: !
395: !     G      WRITE AN INITIAL FILE FOR THE RegCM
396:       call <a href="./mod_write.f90.html#writef" TARGET=CENT_PANEL>writef</a>(ptop,idate)
397: !
398:       end subroutine getfvgcm
399: 
<p><a name=headerfv><H3>headerfv</H3></a></p> Click <a href="./callingtree/headerfv_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where headerfv is used.
<hr>
400:       subroutine headerfv
401:       implicit none
402: !
403: ! Local variables
404: !
405:       integer :: i , j , k , kr
406: !
407:       do j = 1 , nlat2
408:         vlat(j) = float(j-1) - 90.0
409:       end do
410: !
411:       do i = 1 , nlon2
412:         vlon(i) = float(i-1)*1.25
413:       end do
414:  
415:       pplev(1) = 30.
416:       pplev(2) = 50.
417:       pplev(3) = 70.
418:       pplev(4) = 100.
419:       pplev(5) = 150.
420:       pplev(6) = 200.
421:       pplev(7) = 250.
422:       pplev(8) = 300.
423:       pplev(9) = 350.
424:       pplev(10) = 420.
425:       pplev(11) = 500.
426:       pplev(12) = 600.
427:       pplev(13) = 700.
428:       pplev(14) = 780.
429:       pplev(15) = 850.
430:       pplev(16) = 920.
431:       pplev(17) = 960.
432:       pplev(18) = 1000.
433:  
434:       do k = 1 , nlev2
435:         sigmar(k) = pplev(k)*0.001
436:       end do
437: !HH:OVER
438: !     CHANGE ORDER OF VERTICAL INDEXES FOR PRESSURE LEVELS
439: !
440:       do k = 1 , nlev2
441:         kr = nlev2 - k + 1
442:         sigma1(k) = sigmar(kr)
443:       end do
444: !
445:       ak(1) = 2.9170
446:       ak(2) = 7.9292
447:       ak(3) = 21.5539
448:       ak(4) = 49.1834
449:       ak(5) = 83.1425
450:       ak(6) = 79.9308
451:       ak(7) = 75.7738
452:       ak(8) = 70.5752
453:       ak(9) = 64.2963
454:       ak(10) = 56.9838
455:       ak(11) = 48.7913
456:       ak(12) = 39.9895
457:       ak(13) = 30.9631
458:       ak(14) = 22.1902
459:       ak(15) = 14.2039
460:       ak(16) = 7.5413
461:       ak(17) = 2.6838
462:       ak(18) = 0.0
463:       ak(19) = 0.0
464:  
465:       bk(1) = 0.0
466:       bk(2) = 0.0
467:       bk(3) = 0.0
468:       bk(4) = 0.0
469:       bk(5) = 0.0
470:       bk(6) = 0.0380541
471:       bk(7) = 0.0873088
472:       bk(8) = 0.1489307
473:       bk(9) = 0.2232996
474:       bk(10) = 0.3099406
475:       bk(11) = 0.4070096
476:       bk(12) = 0.5112977
477:       bk(13) = 0.6182465
478:       bk(14) = 0.7221927
479:       bk(15) = 0.8168173
480:       bk(16) = 0.8957590
481:       bk(17) = 0.9533137
482:       bk(18) = 0.9851222
483:       bk(19) = 1.0
484:  
485:       allocate(b3(jx,iy,nlev2*3))
486:       allocate(d3(jx,iy,nlev2*2))
487:       allocate(w3(jx,iy,nlev2))
488:       allocate(b3pd(jx,iy))
489: 
490: !     Set up pointers
491: 
492:       ps2 => bb(:,:,1)
493:       t2 => bb(:,:,2:nlev2+1)
494:       q2 => bb(:,:,nlev2+2:2*nlev2+1)
495:       u2 => bb(:,:,2*nlev2+2:3*nlev2+1)
496:       v2 => bb(:,:,3*nlev2+2:4*nlev2+1)
497:       tp => b2(:,:,1:nlev2)
498:       qp => b2(:,:,nlev2+1:2*nlev2)
499:       hp => b2(:,:,2*nlev2+1:3*nlev2)
500:       up => d2(:,:,1:nlev2)
501:       vp => d2(:,:,nlev2+1:2*nlev2)
502:       t3 => b3(:,:,1:nlev2)
503:       q3 => b3(:,:,nlev2+1:2*nlev2)
504:       h3 => b3(:,:,2*nlev2+1:3*nlev2)
505:       u3 => d3(:,:,1:nlev2)
506:       v3 => d3(:,:,nlev2+1:2*nlev2)
507: 
508:       end subroutine headerfv
509: 
510:       end module mod_fvgcm
</PRE>

<HR>

</BODY>
</HTML>
