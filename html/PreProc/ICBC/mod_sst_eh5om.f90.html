<HTML>

<HEAD>
<TITLE>mod_sst_eh5om.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>mod_sst_eh5om.f90</H1>
<HR>
<H2 ALIGN=CENTER>mod_sst_eh5om.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=mod_sst_eh5om><H3>mod_sst_eh5om</H3></a></p>20:       module mod_sst_eh5om
21: 
22:       contains
23: 
<p><a name=sst_eh5om><H3>sst_eh5om</H3></a></p> Click <a href="./callingtree/sst_eh5om_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where sst_eh5om is used.
<hr>
24:       subroutine sst_eh5om
25: 
26: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
27: ! Comments on dataset sources and location:                          !
28: !                                                                    !
29: ! EH5OM    EH5OM_SST is from the coupled model run by EC-MPI         !
30: !          6 hourly frequncy, 1.875x1.875                            !
31: !          for 'RF'       run , from 1941 to 2000,                   !
32: !          for 'A2'/'B2'/'A1B', from 2001 to 2100.                   !
33: !                                                                    !
34: !          ML= 1 is   0.0; ML= 2 is   1.875; => ML=192 is 358.125E   !
35: !          NL= 1 is  90.0; ML= 2 is  88.75 ; => ML=96 is -89.0625    !
36: !                                                                    !
37: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
38: 
39:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
40:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
41:       use <a href="./mod_interp.f90.html#mod_interp" TARGET=CENT_PANEL>mod_interp</a> , only : bilinx
42:       use <a href="./mod_printl.f90.html#mod_printl" TARGET=CENT_PANEL>mod_printl</a>
43: 
44:       implicit none
45: !
46: ! PARAMETER definitions
47: !
48:       integer , parameter :: ilon = 192 , jlat = 96
49: !
50: ! Local variables
51: !
52:       integer :: it_base
53:       integer(2) , dimension(ilon,jlat) :: ivar
54:       real(8) :: offset , xscale
55:       real(4) , dimension(ilon,jlat) :: sst
56:       integer :: idate
57:       integer :: nnnend , nstart
58:       integer :: i , it , j , mrec , nday , nhour , nmo , nyear
59:       real(4) , dimension(jlat) :: lati
60:       real(4) , dimension(ilon) :: loni
61:       logical :: there
62:       real(4) , allocatable , dimension(:,:) :: lu , sstmm , xlat , xlon
63:       character(256) :: terfile , sstfile
64: !
65:       it_base = 0
66:       allocate(lu(iy,jx))
67:       allocate(sstmm(iy,jx))
68:       allocate(xlat(iy,jx))
69:       allocate(xlon(iy,jx))
70: 
71:       if ( ssttyp=='EH5RF' ) then
72:         there = .false.
73:         if ( (globidate1>=1941010106 .and. globidate1<=1961123118) .or. &
74:            & (globidate2>=1941010106 .and. globidate2<=1961123118) ) then
75:           inquire (file=trim(inpglob)//                                 &
76:                    '/SST/SST_20C_3_1941010106_1961123118',exist=there)
77:           if ( .not.there ) then
78:             print * , 'SST_20C_3_1941010106_1961123118 is not available'&
79:                 & , ' under ',trim(inpglob),'/SST/'
80:             stop
81:           end if
82:         end if
83:         if ( (globidate1>=1962010100 .and. globidate1<=1993123118) .or. &
84:            & (globidate2>=1962010100 .and. globidate2<=1993123118) ) then
85:           inquire (file=trim(inpglob)//                                 &
86:                &   '/SST/SST_20C_3_1962010100_1993123118',exist=there)
87:           if ( .not.there ) then
88:             print * , 'SST_20C_3_1962010100_1993123118 is not available'&
89:                 & , ' under ',trim(inpglob),'/SST/'
90:             stop
91:           end if
92:         end if
93:         if ( (globidate1>=1994010100 .and. globidate1<=2001010100) .or. &
94:            & (globidate2>=1994010100 .and. globidate2<=2001010100) ) then
95:           inquire (file=trim(inpglob)//                                 &
96:                &   '/SST/SST_20C_3_1994010100_2001010100',exist=there)
97:           if ( .not.there ) then
98:             print * , 'SST_20C_3_1994010100_2001010100 is not available'&
99:                 & , ' under ',trim(inpglob),'/SST/'
100:             stop
101:           end if
102:         end if
103:         if ( .not.there ) then
104:           print * , 'EH5RF SST is just available from 1941010106 to' ,  &
105:                &' 2001010100'
106:           stop
107:         end if
108:       else if ( ssttyp=='EH5A2' ) then
109:         there = .false.
110:         if ( (globidate1>=2001010100 .and. globidate1<=2029123118) .or. &
111:            & (globidate2>=2001010100 .and. globidate2<=2029123118) ) then
112:           inquire (file=trim(inpglob)//                                 &
113:                  & '/SST/SST_A2_1_2001010100_2029123118',exist=there)
114:           if ( .not.there ) then
115:             print * , 'SST_A2_1_2001010100_2029123118 is not available' &
116:                 & , ' under ',trim(inpglob),'/SST/'
117:             stop
118:           end if
119:         end if
120:         if ( (globidate1>=2030010100 .and. globidate1<=2061123118) .or. &
121:            & (globidate2>=2030010100 .and. globidate2<=2061123118) ) then
122:           inquire (file=trim(inpglob)//                                 &
123:                  & '/SST/SST_A2_1_2030010100_2061123118',exist=there)
124:           if ( .not.there ) then
125:             print * , 'SST_A2_1_2030010100_2061123118 is not available' &
126:                 & , ' under ',trim(inpglob),'/SST/'
127:             stop
128:           end if
129:         end if
130:         if ( (globidate1>=2062010100 .and. globidate1<=2093123118) .or. &
131:            & (globidate2>=2062010100 .and. globidate2<=2093123118) ) then
132:           inquire (file=trim(inpglob)//                                 &
133:            &  '/SST/SST_A2_1_2062010100_2093123118',exist=there)
134:           if ( .not.there ) then
135:             print * , 'SST_A2_1_2062010100_2093123118 is not available' &
136:                 & , ' under ',trim(inpglob),'/SST/'
137:             stop
138:           end if
139:         end if
140:         if ( (globidate1>=2094010100 .and. globidate1<=2100123118) .or. &
141:            & (globidate2>=2094010100 .and. globidate2<=2100123118) ) then
142:           inquire (file=trim(inpglob)//                                 &
143:            &       '/SST/SST_A2_1_2094010100_2100123118',exist=there)
144:           if ( .not.there ) then
145:             print * , 'SST_A2_1_2094010100_2100123118 is not available' &
146:                 & , ' under ',trim(inpglob),'/SST/'
147:             stop
148:           end if
149:         end if
150:         if ( .not.there ) then
151:           print * , 'EH5A2 SST is just available from 2001010100 to' ,  &
152:                &' 2100123118'
153:           stop
154:         end if
155:       else if ( ssttyp=='EH5B1' ) then
156:         there = .false.
157:         if ( (globidate1>=2001010100 .and. globidate1<=2029123118) .or. &
158:            & (globidate2>=2001010100 .and. globidate2<=2029123118) ) then
159:           inquire (file=trim(inpglob)//                                 &
160:                 &  '/SST/SST_B1_1_2001010100_2029123118',exist=there)
161:           if ( .not.there ) then
162:             print * , 'SST_B1_1_2001010100_2029123118 is not available' &
163:                 & , ' under ',trim(inpglob),'/SST/'
164:             stop
165:           end if
166:         end if
167:         if ( (globidate1>=2030010100 .and. globidate1<=2061123118) .or. &
168:            & (globidate2>=2030010100 .and. globidate2<=2061123118) ) then
169:           inquire (file=trim(inpglob)//                                 &
170:              &     '/SST/SST_B1_1_2030010100_2061123118',exist=there)
171:           if ( .not.there ) then
172:             print * , 'SST_B1_1_2030010100_2061123118 is not available' &
173:                 & , ' under ',trim(inpglob),'/SST/'
174:             stop
175:           end if
176:         end if
177:         if ( (globidate1>=2062010100 .and. globidate1<=2093123118) .or. &
178:            & (globidate2>=2062010100 .and. globidate2<=2093123118) ) then
179:           inquire (file=trim(inpglob)//                                 &
180:               &    '/SST/SST_B1_1_2062010100_2093123118',exist=there)
181:           if ( .not.there ) then
182:             print * , 'SST_B1_1_2062010100_2093123118 is not available' &
183:                 & , ' under ',trim(inpglob),'/SST/'
184:             stop
185:           end if
186:         end if
187:         if ( (globidate1>=2094010100 .and. globidate1<=2100123118) .or. &
188:            & (globidate2>=2094010100 .and. globidate2<=2100123118) ) then
189:           inquire (file=trim(inpglob)//                                 &
190:              &     '/SST/SST_B1_1_2094010100_2100123118',exist=there)
191:           if ( .not.there ) then
192:             print * , 'SST_B1_1_2094010100_2100123118 is not available' &
193:                 & , ' under ',trim(inpglob),'/SST/'
194:             stop
195:           end if
196:         end if
197:         if ( .not.there ) then
198:           print * , 'EH5B1 SST is just available from 2001010100 to' ,  &
199:                &' 2100123118'
200:           stop
201:         end if
202:       else if ( ssttyp=='EHA1B' ) then
203:         there = .false.
204:         if ( (globidate1>=2001010100 .and. globidate1<=2029123118) .or. &
205:            & (globidate2>=2001010100 .and. globidate2<=2029123118) ) then
206:           inquire (file=trim(inpglob)//                                 &
207:              &     '/SST/SST_A1B_3_2001010100_2029123118',exist=there)
208:           if ( .not.there ) then
209:             print * , 'SST_A1B_3_2001010100_2029123118 is not available'&
210:                 & , ' under ',trim(inpglob),'/SST/'
211:             stop
212:           end if
213:         end if
214:         if ( (globidate1>=2030010100 .and. globidate1<=2061123118) .or. &
215:            & (globidate2>=2030010100 .and. globidate2<=2061123118) ) then
216:           inquire (file=trim(inpglob)//                                 &
217:                 &  '/SST/SST_A1B_3_2030010100_2061123118',exist=there)
218:           if ( .not.there ) then
219:             print * , 'SST_A1B_3_2030010100_2061123118 is not available'&
220:                 & , ' under ',trim(inpglob),'/SST/'
221:             stop
222:           end if
223:         end if
224:         if ( (globidate1>=2062010100 .and. globidate1<=2093123118) .or. &
225:            & (globidate2>=2062010100 .and. globidate2<=2093123118) ) then
226:           inquire (file=trim(inpglob)//                                 &
227:               &    '/SST/SST_A1B_3_2062010100_2093123118',exist=there)
228:           if ( .not.there ) then
229:             print * , 'SST_A1B_3_2062010100_2093123118 is not available'&
230:                 & , ' under ',trim(inpglob),'/SST/'
231:             stop
232:           end if
233:         end if
234:         if ( (globidate1>=2094010100 .and. globidate1<=2100123118) .or. &
235:            & (globidate2>=2094010100 .and. globidate2<=2100123118) ) then
236:           inquire (file=trim(inpglob)//                                 &
237:                  & '/SST/SST_A1B_3_2094010100_2100123118',exist=there)
238:           if ( .not.there ) then
239:             print * , 'SST_A1B_3_2094010100_2100123118 is not available'&
240:                 & , ' under ',trim(inpglob),'/SST/'
241:             stop
242:           end if
243:         end if
244:         if ( .not.there ) then
245:           print * , 'EHA1B SST is just available from 2001010100 to' ,  &
246:                &' 2100123118'
247:           stop
248:         end if
249:       else
250:         write (*,*) 'PLEASE SET right SSTTYP in regcm.in'
251:         write (*,*) 'Supported types are EH5RF EH5A2 EH5B1 EHA1B'
252:         stop
253:       end if
254: 
255:       write (sstfile,99001) trim(dirglob), pthsep, trim(domname) ,      &
256:          &   '_SST.RCM'
257:       open (21,file=sstfile,form='unformatted',status='replace')
258:  
259: !     ******    ON WHAT RegCM GRID ARE SST DESIRED?
260:       write (terfile,99001)                                             &
261:         & trim(dirter), pthsep, trim(domname) , '.INFO'
262:       open (10,file=terfile,form='unformatted',recl=iy*jx*ibyte,        &
263:          &  access='direct',status='unknown',err=100)
264:       call <a href="./mod_date.f90.html#initdate_eh50" TARGET=CENT_PANEL>initdate_eh50</a>(ssttyp)
265:       call <a href="./mod_date.f90.html#finddate_eh50" TARGET=CENT_PANEL>finddate_eh50</a>(nstart,globidate1)
266:       call <a href="./mod_date.f90.html#finddate_eh50" TARGET=CENT_PANEL>finddate_eh50</a>(nnnend,globidate2)
267:       write (*,*) nstart , nnnend
268:       print * , globidate1 , nnnend - nstart + 1
269:       write (sstfile,99001) trim(dirglob), pthsep, trim(domname) ,      &
270:           &  '_RCM_SST.dat'
271:       open (25,file=sstfile,status='unknown',form='unformatted',        &
272:           & recl=iy*jx*ibyte,access='direct')
273:       if ( igrads==1 ) then
274:         write (sstfile,99001) trim(dirglob), pthsep, trim(domname) ,    &
275:           &  '_RCM_SST.ctl'
276:         open (31,file=sstfile,status='replace')
277:         write (31,'(a,a,a)') 'dset ^',trim(domname),'_RCM_SST.dat'
278:       end if
279:       call <a href="./mod_sst_eh5om.f90.html#gridmlo" TARGET=CENT_PANEL>gridmlo</a>(xlon,xlat,lu,iy,jx,globidate1,nnnend-nstart+1)
280:       mrec = 0
281:  
282: !     ******    SET UP LONGITUDES AND LATITUDES FOR SST DATA
283:       do i = 1 , ilon
284:         loni(i) = float(i-1)*1.875
285:       end do
286:       do j = 1 , jlat
287:         lati(j) = -89.0625 + 1.875*float(j-1)
288:       end do
289:  
290: !     **  REF  SST DATA, 1.875x1.1.25, AVAILABLE FROM 16/1/1959 TO
291: !     16/1/1991 ** A2&B2 SST DATA, 1.875x1.1.25, AVAILABLE FROM
292: !     16/1/2069 TO 16/1/2101
293:       do it = nstart , nnnend
294:         idate = mdate(it)
295:         if ( ssttyp=='EH5RF' ) then
296:           if ( idate>=1941010106 .and. idate<=1961123118 ) then
297:             open (11,file=trim(inpglob)//                               &
298:              &    '/SST/SST_20C_3_1941010106_1961123118',               &
299:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
300:              &    access='direct')
301:             it_base = 1
302:           else if ( idate>=1962010100 .and. idate<=1993123118 ) then
303:             open (11,file=trim(inpglob)//                               &
304:              &    '/SST/SST_20C_3_1962010100_1993123118',               &
305:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
306:              &    access='direct')
307:             it_base = 30680
308:           else if ( idate>=1994010100 .and. idate<=2001010100 ) then
309:             open (11,file=trim(inpglob)//                               &
310:              &    '/SST/SST_20C_3_1994010100_2001010100',               &
311:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
312:              &    access='direct')
313:             it_base = 30680 + 46752
314:           else
315:           end if
316:         else if ( ssttyp=='EH5A2' ) then
317:           if ( idate>=2001010100 .and. idate<=2029123118 ) then
318:             open (11,file=trim(inpglob)//                               &
319:              &    '/SST/SST_A2_1_2001010100_2029123118',                &
320:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
321:              &    access='direct')
322:             it_base = 0
323:           else if ( idate>=2030010100 .and. idate<=2061123118 ) then
324:             open (11,file=trim(inpglob)//                               &
325:              &    '/SST/SST_A2_1_2030010100_2061123118',                &
326:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
327:              &    access='direct')
328:             it_base = 42368
329:           else if ( idate>=2062010100 .and. idate<=2093123118 ) then
330:             open (11,file=trim(inpglob)//                               &
331:              &    '/SST/SST_A2_1_2062010100_2093123118',                &
332:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
333:              &    access='direct')
334:             it_base = 42368 + 46752
335:           else if ( idate>=2094010100 .and. idate<=2100123118 ) then
336:             open (11,file=trim(inpglob)//                               &
337:              &    '/SST/SST_A2_1_2094010100_2100123118',                &
338:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
339:              &    access='direct')
340:             it_base = 42368 + 46752*2
341:           else
342:           end if
343:         else if ( ssttyp=='EH5B1' ) then
344:           if ( idate>=2001010100 .and. idate<=2029123118 ) then
345:             open (11,file=trim(inpglob)//                               &
346:              &    '/SST/SST_B1_1_2001010100_2029123118',                &
347:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
348:              &    access='direct')
349:             it_base = 0
350:           else if ( idate>=2030010100 .and. idate<=2061123118 ) then
351:             open (11,file=trim(inpglob)//                               &
352:              &    '/SST/SST_B1_1_2030010100_2061123118',                &
353:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
354:              &    access='direct')
355:             it_base = 42368
356:           else if ( idate>=2062010100 .and. idate<=2093123118 ) then
357:             open (11,file=trim(inpglob)//                               &
358:              &    '/SST/SST_B1_1_2062010100_2093123118',                &
359:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
360:              &    access='direct')
361:             it_base = 42368 + 46752
362:           else if ( idate>=2094010100 .and. idate<=2100123118 ) then
363:             open (11,file=trim(inpglob)//                               &
364:              &    '/SST/SST_B1_1_2094010100_2100123118',                &
365:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
366:              &    access='direct')
367:             it_base = 42368 + 46752*2
368:           else
369:           end if
370:         else if ( ssttyp=='EHA1B' ) then
371:           if ( idate>=2001010100 .and. idate<=2029123118 ) then
372:             open (11,file=trim(inpglob)//                               &
373:              &    '/SST/SST_A1B_3_2001010100_2029123118',               &
374:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
375:              &    access='direct')
376:             it_base = 0
377:           else if ( idate>=2030010100 .and. idate<=2061123118 ) then
378:             open (11,file=trim(inpglob)//                               &
379:              &    '/SST/SST_A1B_3_2030010100_2061123118',               &
380:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
381:              &    access='direct')
382:             it_base = 42368
383:           else if ( idate>=2062010100 .and. idate<=2093123118 ) then
384:             open (11,file=trim(inpglob)//                               &
385:              &    '/SST/SST_A1B_3_2062010100_2093123118',               &
386:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
387:              &    access='direct')
388:             it_base = 42368 + 46752
389:           else if ( idate>=2094010100 .and. idate<=2100123118 ) then
390:             open (11,file=trim(inpglob)//                               &
391:              &    '/SST/SST_A1B_3_2094010100_2100123118',               &
392:              &    form='unformatted',recl=(ilon*jlat/2+4)*ibyte,        &
393:              &    access='direct')
394:             it_base = 42368 + 46752*2
395:           else
396:           end if
397:         else
398:         end if
399:         nyear = idate/1000000
400:         nmo = (idate-nyear*1000000)/10000
401:         nday = (idate-nyear*1000000-nmo*10000)/100
402:         nhour = idate - nyear*1000000 - nmo*10000 - nday*100
403:         read (11,rec=it-it_base) offset , xscale , ivar
404:         write (*,*) offset , xscale
405:         do j = 1 , jlat
406:           do i = 1 , ilon
407:             sst(i,j) = ivar(i,jlat+1-j)*xscale + offset
408:             if ( sst(i,j)<273.16 ) sst(i,j) = -9999.
409:           end do
410:         end do
411:  
412: !       ******           PRINT OUT DATA AS A CHECK
413:         if ( nmo==1 ) call <a href="./mod_printl.f90.html#printl" TARGET=CENT_PANEL>printl</a>(sst,ilon,jlat)
414:  
415:         call <a href="./aerosol.f90.html#bilinx" TARGET=CENT_PANEL>bilinx</a>(sst,sstmm,xlon,xlat,loni,lati,ilon,jlat,iy,jx,1)
416:         print * , 'XLON,XLAT,SST=' , xlon(1,1) , xlat(1,1) , sstmm(1,1)
417:  
418: !       ******           WRITE OUT SST DATA ON MM4 GRID
419:         write (21) nhour , nday , nmo , nyear , sstmm
420:         print * , 'WRITING OUT MM4 SST DATA:' , nmo , nyear
421:         mrec = mrec + 1
422:         write (25,rec=mrec) ((sstmm(i,j),j=1,jx),i=1,iy)
423:       end do
424:  
425:       deallocate(lu)
426:       deallocate(sstmm)
427:       deallocate(xlat)
428:       deallocate(xlon)
429: 
430:       return
431: 
432: !     4810 PRINT *,'ERROR OPENING GISST FILE'
433: !     STOP '4810 IN PROGRAM RDSST'
434:  100  continue
435:       print * , 'ERROR OPENING DOMAIN HEADER FILE'
436:       stop '4830 IN PROGRAM RDSST'
437: 
438: 99001 format (a,a,a,a)
439:       end subroutine sst_eh5om
440: !
441: !-----------------------------------------------------------------------
442: !
<p><a name=gridmlo><H3>gridmlo</H3></a></p> Click <a href="./callingtree/gridmlo_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where gridmlo is used.
<hr>
443:       subroutine gridmlo(xlon,xlat,lu,iy,jx,idate1,numrec)
444:       implicit none
445: !
446: ! Dummy arguments
447: !
448:       integer :: idate1 , iy , jx , numrec
449:       real(4) , dimension(iy,jx) :: lu , xlat , xlon
450:       intent (in) idate1 , iy , jx , numrec
451:       intent (out) lu , xlat , xlon
452: !
453: ! Local variables
454: !
455:       real(4) :: truelath , truelatl
456:       real(4) :: alatmax , alatmin , alonmax , alonmin , centeri ,      &
457:             & centerj , clat , clon , dsinm , grdfac , plat , plon ,    &
458:             & ptop , rlatinc , rloninc
459:       character(2) , dimension(31) :: cday
460:       character(3) , dimension(12) :: cmonth
461:       integer :: i , ibigend , igrads , iyy , j , jxx , k , kz ,        &
462:                & month , nday , nhour , nx , ny , nyear , period
463:       character(6) :: iproj
464:       real(4) , dimension(30) :: sigmaf
465: !
466:       data cday/'01' , '02' , '03' , '04' , '05' , '06' , '07' , '08' , &
467:           &'09' , '10' , '11' , '12' , '13' , '14' , '15' , '16' ,      &
468:          & '17' , '18' , '19' , '20' , '21' , '22' , '23' , '24' ,      &
469:          & '25' , '26' , '27' , '28' , '29' , '30' , '31'/
470:       data cmonth/'jan' , 'feb' , 'mar' , 'apr' , 'may' , 'jun' ,       &
471:          & 'jul' , 'aug' , 'sep' , 'oct' , 'nov' , 'dec'/
472: !
473:       alatmin = 999999.
474:       alatmax = -999999.
475:       alonmin = 999999.
476:       alonmax = -999999.
477:       nx = 0
478:       ny = 0
479: 
480:       read (10,rec=1) iyy , jxx , kz , dsinm , clat , clon , plat ,     &
481:                     & plon , grdfac , iproj , (sigmaf(k),k=1,kz+1) ,    &
482:                     & ptop , igrads , ibigend , truelatl , truelath
483:       if ( iyy/=iy .or. jxx/=jx ) then
484:         write (*,*) 'IY,JX,IYY,JXX' , iy , jx , iyy , jxx
485:         stop
486:       end if
487:       read (10,rec=4) ((lu(i,j),j=1,jx),i=1,iy)
488:       read (10,rec=5) ((xlat(i,j),j=1,jx),i=1,iy)
489:       read (10,rec=6) ((xlon(i,j),j=1,jx),i=1,iy)
490: !
491:       if ( igrads==1 ) then
492:         open (31,file='RCM_SST.ctl',status='replace')
493:         write (31,'(a)') 'title SST fields for RegCM domain'
494:         if ( ibigend==1 ) then
495:           write (31,'(a)') 'options big_endian'
496:         else
497:           write (31,'(a)') 'options little_endian'
498:         end if
499:         write (31,'(a)') 'undef -9999.'
500:         if ( iproj=='LAMCON' .or. iproj=='ROTMER' ) then
501:           do j = 1 , jx
502:             if ( xlat(1,j)<alatmin ) alatmin = xlat(1,j)
503:             if ( xlat(iy,j)>alatmax ) alatmax = xlat(iy,j)
504:           end do
505:           do i = 1 , iy
506:             do j = 1 , jx
507:               if ( clon>=0.0 ) then
508:                 if ( xlon(i,j)>=0.0 ) then
509:                   alonmin = amin1(alonmin,xlon(i,j))
510:                   alonmax = amax1(alonmax,xlon(i,j))
511:                 else if ( abs(clon-xlon(i,j))<abs(clon-(xlon(i,j)+360.))&
512:                         & ) then
513:                   alonmin = amin1(alonmin,xlon(i,j))
514:                   alonmax = amax1(alonmax,xlon(i,j))
515:                 else
516:                   alonmin = amin1(alonmin,xlon(i,j)+360.)
517:                   alonmax = amax1(alonmax,xlon(i,j)+360.)
518:                 end if
519:               else if ( xlon(i,j)<0.0 ) then
520:                 alonmin = amin1(alonmin,xlon(i,j))
521:                 alonmax = amax1(alonmax,xlon(i,j))
522:               else if ( abs(clon-xlon(i,j))<abs(clon-(xlon(i,j)-360.)) )&
523:                       & then
524:                 alonmin = amin1(alonmin,xlon(i,j))
525:                 alonmax = amax1(alonmax,xlon(i,j))
526:               else
527:                 alonmin = amin1(alonmin,xlon(i,j)-360.)
528:                 alonmax = amax1(alonmax,xlon(i,j)-360.)
529:               end if
530:             end do
531:           end do
532:           rlatinc = dsinm*0.001/111./2.
533:           rloninc = dsinm*0.001/111./2.
534:           ny = 2 + nint(abs(alatmax-alatmin)/rlatinc)
535:           nx = 1 + nint(abs((alonmax-alonmin)/rloninc))
536:  
537:           centerj = jx/2.
538:           centeri = iy/2.
539:         end if
540:         if ( iproj=='LAMCON' ) then        ! Lambert projection
541:           write (31,99001) jx , iy , clat , clon , centerj , centeri ,  &
542:                          & truelatl , truelath , clon , dsinm , dsinm
543:           write (31,99002) nx + 2 , alonmin - rloninc , rloninc
544:           write (31,99003) ny + 2 , alatmin - rlatinc , rlatinc
545:         else if ( iproj=='POLSTR' ) then   !
546:         else if ( iproj=='NORMER' ) then
547:           write (31,99004) jx , xlon(1,1) , xlon(1,2) - xlon(1,1)
548:           write (31,99005) iy
549:           write (31,99006) (xlat(i,1),i=1,iy)
550:         else if ( iproj=='ROTMER' ) then
551:           write (*,*) 'Note that rotated Mercartor (ROTMER)' ,          &
552:                      &' projections are not supported by GrADS.'
553:           write (*,*) '  Although not exact, the eta.u projection' ,    &
554:                      &' in GrADS is somewhat similar.'
555:           write (*,*) ' FERRET, however, does support this projection.'
556:           write (31,99007) jx , iy , plon , plat , dsinm/111000. ,      &
557:                          & dsinm/111000.*.95238
558:           write (31,99002) nx + 2 , alonmin - rloninc , rloninc
559:           write (31,99003) ny + 2 , alatmin - rlatinc , rlatinc
560:         else
561:           write (*,*) 'Are you sure your map projection is correct ?'
562:           stop
563:         end if
564:         write (31,99008) 1 , 1000.
565:         period = numrec
566:         nyear = idate1/1000000
567:         month = (idate1-nyear*1000000)/10000
568:         nday = (idate1-nyear*1000000-month*10000)/100
569:         nhour = mod(idate1,100)
570:         write (31,99009) period , nhour , cday(nday) , cmonth(month) ,  &
571:                        & nyear
572:         write (31,99010) 1
573:         write (31,99011) 'sst ' , 'surface elevation          '
574:         write (31,'(a)') 'endvars'
575:         close (31)
576:       end if
577: 99001 format ('pdef ',i4,1x,i4,1x,'lcc',7(1x,f7.2),1x,2(f7.0,1x))
578: 99002 format ('xdef ',i4,' linear ',f7.2,1x,f7.4)
579: 99003 format ('ydef ',i4,' linear ',f7.2,1x,f7.4)
580: 99004 format ('xdef ',i3,' linear ',f9.4,' ',f9.4)
581: 99005 format ('ydef ',i3,' levels')
582: 99006 format (10F7.2)
583: 99007 format ('pdef ',i4,1x,i4,1x,'eta.u',2(1x,f7.3),2(1x,f9.5))
584: 99008 format ('zdef ',i1,' levels ',f7.2)
585: 99009 format ('tdef ',i6,' linear ',i2,'z',a2,a3,i4,' 6hr')
586: 99010 format ('vars ',i1)
587: 99011 format (a4,'0 99 ',a26)
588: !
589:       end subroutine gridmlo
590: !
591:       end module mod_sst_eh5om
</PRE>

<HR>

</BODY>
</HTML>
