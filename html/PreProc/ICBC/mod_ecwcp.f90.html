<HTML>

<HEAD>
<TITLE>mod_ecwcp.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>mod_ecwcp.f90</H1>
<HR>
<H2 ALIGN=CENTER>mod_ecwcp.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=mod_ecwcp><H3>mod_ecwcp</H3></a></p>20:       module mod_ecwcp
21: 
22:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
23: 
24:       implicit none
25: 
26:       private
27: 
28:       integer , parameter :: nlev1 = 15 , jlat = 64 , ilon = 128
29: 
30:       real(4) , dimension(jlat) :: hlat
31:       real(4) , dimension(ilon) :: hlon
32:       real(4) , dimension(nlev1) :: sigma1 , sigmar
33: 
34:       real(4) , dimension(ilon,jlat,nlev1) :: w1
35: 
36:       real(4) , target , dimension(ilon,jlat,nlev1*3) :: b2
37:       real(4) , target , dimension(ilon,jlat,nlev1*2) :: d2
38:       real(4) , allocatable , target , dimension(:,:,:) :: b3
39:       real(4) , allocatable , target , dimension(:,:,:) :: d3
40: 
41:       real(4) , pointer , dimension(:,:,:) :: t1 , q1 , h1
42:       real(4) , pointer , dimension(:,:,:) :: u1 , v1
43:       real(4) , pointer , dimension(:,:,:) :: t3 , q3 , h3
44:       real(4) , pointer , dimension(:,:,:) :: u3 , v3
45: 
46:       public :: getecwcp , headerec
47: 
48:       contains
49: 
<p><a name=getecwcp><H3>getecwcp</H3></a></p> Click <a href="./callingtree/getecwcp_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where getecwcp is used.
<hr>
50:       subroutine getecwcp(idate)
51:       use <a href="./mod_date.f90.html#mod_date" TARGET=CENT_PANEL>mod_date</a> , only : julian
52:       use <a href="./mod_grid.f90.html#mod_grid" TARGET=CENT_PANEL>mod_grid</a>
53:       use <a href="./mod_write.f90.html#mod_write" TARGET=CENT_PANEL>mod_write</a>
54:       use <a href="./mod_interp.f90.html#mod_interp" TARGET=CENT_PANEL>mod_interp</a> , only : bilinx2
55:       use <a href="./mod_vertint.f90.html#mod_vertint" TARGET=CENT_PANEL>mod_vertint</a>
56:       use <a href="./mod_hgt.f90.html#mod_hgt" TARGET=CENT_PANEL>mod_hgt</a>
57:       use <a href="./mod_humid.f90.html#mod_humid" TARGET=CENT_PANEL>mod_humid</a>
58:       use <a href="./mod_mksst.f90.html#mod_mksst" TARGET=CENT_PANEL>mod_mksst</a>
59:       use <a href="./mod_uvrot.f90.html#mod_uvrot" TARGET=CENT_PANEL>mod_uvrot</a>
60:       use <a href="./mod_vectutil.f90.html#mod_vectutil" TARGET=CENT_PANEL>mod_vectutil</a>
61:       implicit none
62: !
63: ! Dummy arguments
64: !
65:       integer :: idate
66: !
67: ! Local variables
68: !
69:       character(12) , dimension(12,5) :: finm
70:       integer :: i , j , k , month , nday , nhour , nmop , nrec ,       &
71:                & nyear , nyrp
72:       logical :: there
73:       real(4) :: wt
74: !
75:       data finm/'ECT421993JAN' , 'ECT421993FEB' , 'ECT421993MAR' ,      &
76:           &'ECT421993APR' , 'ECT421993MAY' , 'ECT421993JUN' ,           &
77:           &'ECT421993JUL' , 'ECT421993AUG' , 'ECT421993SEP' ,           &
78:           &'ECT421993OCT' , 'ECT421993NOV' , 'ECT421993DEC' ,           &
79:           &'ECT421994JAN' , 'ECT421994FEB' , 'ECT421994MAR' ,           &
80:           &'ECT421994APR' , 'ECT421994MAY' , 'ECT421994JUN' ,           &
81:           &'ECT421994JUL' , 'ECT421994AUG' , 'ECT421994SEP' ,           &
82:           &'ECT421994OCT' , 'ECT421994NOV' , 'ECT421994DEC' ,           &
83:           &'ECT421995JAN' , 'ECT421995FEB' , 'ECT421995MAR' ,           &
84:           &'ECT421995APR' , 'ECT421995MAY' , 'ECT421995JUN' ,           &
85:           &'ECT421995JUL' , 'ECT421995AUG' , 'ECT421995SEP' ,           &
86:           &'ECT421995OCT' , 'ECT421995NOV' , 'ECT421995DEC' ,           &
87:           &'ECT421996JAN' , 'ECT421996FEB' , 'ECT421996MAR' ,           &
88:           &'ECT421996APR' , 'ECT421996MAY' , 'ECT421996JUN' ,           &
89:           &'ECT421996JUL' , 'ECT421996AUG' , 'ECT421996SEP' ,           &
90:           &'ECT421996OCT' , 'ECT421996NOV' , 'ECT421996DEC' ,           &
91:           &'ECT421997JAN' , 'ECT421997FEB' , 'ECT421997MAR' ,           &
92:           &'ECT421997APR' , 'ECT421997MAY' , 'ECT421997JUN' ,           &
93:           &'ECT421997JUL' , 'ECT421997AUG' , 'ECT421997SEP' ,           &
94:           &'ECT421997OCT' , 'ECT421997NOV' , 'ECT421997DEC'/
95: !
96:       nyear = idate/1000000
97:       month = idate/10000 - nyear*100
98:       nday = idate/100 - (idate/10000)*100
99:       nhour = mod(idate,100)
100:  
101:       inquire (file=trim(inpglob)//'/ECWCRP/'//finm(month,nyear-1992),  &
102:              & exist=there)
103:       if ( .not.there ) then
104:         write (*,*) trim(inpglob)//'/ECWCRP/'//finm(month,nyear-1992) , &
105:                    &' is not available'
106:         stop
107:       end if
108:       open (63,file=trim(inpglob)//'/ECWCRP/'//finm(month,nyear-1992),  &
109:            &form='unformatted',recl=ilon*jlat*ibyte,access='direct')
110:       nrec = ((nday-1)*4+nhour/6)*(nlev1*6+1)
111:       nrec = nrec + 1
112:       do k = 1 , nlev1
113:         nrec = nrec + 1
114:         read (63,rec=nrec) ((h1(i,j,k),i=1,ilon),j=1,jlat)
115:       end do
116:       do k = 1 , nlev1
117:         nrec = nrec + 1
118:         read (63,rec=nrec) ((t1(i,j,k),i=1,ilon),j=1,jlat)
119:       end do
120:       do k = 1 , nlev1
121:         nrec = nrec + 1
122:         read (63,rec=nrec) ((u1(i,j,k),i=1,ilon),j=1,jlat)
123:       end do
124:       do k = 1 , nlev1
125:         nrec = nrec + 1
126:         read (63,rec=nrec) ((v1(i,j,k),i=1,ilon),j=1,jlat)
127:       end do
128:       do k = 1 , nlev1
129:         nrec = nrec + 1
130:         read (63,rec=nrec) ((w1(i,j,k),i=1,ilon),j=1,jlat)
131:       end do
132:       do k = 1 , nlev1
133:         nrec = nrec + 1
134:         read (63,rec=nrec) ((q1(i,j,k),i=1,ilon),j=1,jlat)
135:       end do
136:       write (*,*) 'READ IN fields at DATE:' , idate , ' from ' ,        &
137:                 & finm(month,nyear-1992)
138:       close (21)
139: !
140: !     HORIZONTAL INTERPOLATION OF BOTH THE SCALAR AND VECTOR FIELDS
141: !
142:       call <a href="./mod_interp.f90.html#bilinx2" TARGET=CENT_PANEL>bilinx2</a>(b3,b2,xlon,xlat,hlon,hlat,ilon,jlat,jx,iy,nlev1*3)
143:       call <a href="./mod_interp.f90.html#bilinx2" TARGET=CENT_PANEL>bilinx2</a>(d3,d2,dlon,dlat,hlon,hlat,ilon,jlat,jx,iy,nlev1*2)
144: !
145: !     ROTATE U-V FIELDS AFTER HORIZONTAL INTERPOLATION
146: !
147:       call <a href="./mod_uvrot.f90.html#uvrot4" TARGET=CENT_PANEL>uvrot4</a>(u3,v3,dlon,dlat,clon,clat,grdfac,jx,iy,nlev1,plon,    &
148:                 & plat,iproj)
149: !
150: !     X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X
151: !     X X
152: !     V E R T I C A L   I N T E R P O L A T I O N
153: !
154: !     X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X X
155: !     X X
156: !     ******           NEW CALCULATION OF P* ON RegCM TOPOGRAPHY.
157:       call <a href="./mod_vertint.f90.html#intgtb" TARGET=CENT_PANEL>intgtb</a>(pa,za,tlayer,topogm,t3,h3,sigmar,jx,iy,nlev1)
158:  
159:       call <a href="./mod_vertint.f90.html#intpsn" TARGET=CENT_PANEL>intpsn</a>(ps4,topogm,pa,za,tlayer,ptop,jx,iy)
160:       call <a href="./mod_vectutil.f90.html#p1p2" TARGET=CENT_PANEL>p1p2</a>(b3pd,ps4,jx,iy)
161:  
162: !
163: !     F0    DETERMINE SURFACE TEMPS ON RegCM TOPOGRAPHY.
164: !     INTERPOLATION FROM PRESSURE LEVELS AS IN INTV2
165:       call <a href="./mod_vertint.f90.html#intv3" TARGET=CENT_PANEL>intv3</a>(ts4,t3,ps4,sigmar,ptop,jx,iy,nlev1)
166:  
167:       if ( ssttyp/='OI_WK' .and. ssttyp/='OI2WK') then
168: !       F1    CALCULATE SSTS FOR DATE FROM OBSERVED SSTS
169: !       PRINT *, 'INPUT DAY FOR SST DATA ACQUISITION:', IDATE
170:         call <a href="./mod_date.f90.html#julian" TARGET=CENT_PANEL>julian</a>(idate,nyrp,nmop,wt)
171: !
172:         if ( ssttyp=='OI2ST') then
173:           call <a href="./mod_mksst.f90.html#mkssta" TARGET=CENT_PANEL>mkssta</a>(ts4,sst1,sst2,ice1,ice2,topogm,xlandu,jx,iy,      &
174:                     & nyrp,nmop,wt)
175:         else
176:           call <a href="./mod_mksst.f90.html#mksst" TARGET=CENT_PANEL>mksst</a>(ts4,sst1,sst2,topogm,xlandu,jx,iy,nyrp,nmop,wt)
177:         end if
178:       else
179:         if ( ssttyp=='OI2WK') then
180:           call <a href="./mod_mksst.f90.html#mksst2a" TARGET=CENT_PANEL>mksst2a</a>(ts4,sst1,sst2,ice1,ice2,topogm,xlandu,jx,iy,     &
181:                      & idate/100)
182:         else
183:           call <a href="./mod_mksst.f90.html#mksst2" TARGET=CENT_PANEL>mksst2</a>(ts4,sst1,sst2,topogm,xlandu,jx,iy,idate/100)
184:         end if
185:       end if
186:  
187: !     F3     INTERPOLATE U, V, T, AND Q.
188:       call <a href="./mod_vertint.f90.html#intv1" TARGET=CENT_PANEL>intv1</a>(u4,u3,b3pd,sigma2,sigmar,ptop,jx,iy,kz,nlev1)
189:       call <a href="./mod_vertint.f90.html#intv1" TARGET=CENT_PANEL>intv1</a>(v4,v3,b3pd,sigma2,sigmar,ptop,jx,iy,kz,nlev1)
190: !
191:       call <a href="./mod_vertint.f90.html#intv2" TARGET=CENT_PANEL>intv2</a>(t4,t3,ps4,sigma2,sigmar,ptop,jx,iy,kz,nlev1)
192:  
193:       call <a href="./mod_humid.f90.html#humid1" TARGET=CENT_PANEL>humid1</a>(t3,q3,100.,0.0,sigma1,jx,iy,nlev1)
194:       call <a href="./mod_vertint.f90.html#intv1" TARGET=CENT_PANEL>intv1</a>(q4,q3,ps4,sigma2,sigmar,ptop,jx,iy,kz,nlev1)
195:       call <a href="./mod_humid.f90.html#humid2" TARGET=CENT_PANEL>humid2</a>(t4,q4,ps4,ptop,sigma2,jx,iy,kz)
196: !
197: !     F4     DETERMINE H
198:       call <a href="./mod_hgt.f90.html#hydrost" TARGET=CENT_PANEL>hydrost</a>(h4,t4,topogm,ps4,ptop,sigmaf,sigma2,dsigma,jx,iy,kz)
199: !
200: !     G      WRITE AN INITIAL FILE FOR THE RegCM
201:       call <a href="./mod_write.f90.html#writef" TARGET=CENT_PANEL>writef</a>(ptop,idate)
202: !
203:       end subroutine getecwcp
204: !
<p><a name=headerec><H3>headerec</H3></a></p> Click <a href="./callingtree/headerec_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where headerec is used.
<hr>
205:       subroutine headerec
206:       implicit none
207: !
208: ! Local variables
209: !
210:       integer :: i , k , kr
211: !
212:       hlat(1) = -87.8638
213:       hlat(2) = -85.0965
214:       hlat(3) = -82.3129
215:       hlat(4) = -79.5256
216:       hlat(5) = -76.7369
217:       hlat(6) = -73.9475
218:       hlat(7) = -71.1578
219:       hlat(8) = -68.3678
220:       hlat(9) = -65.5776
221:       hlat(10) = -62.7874
222:       hlat(11) = -59.9970
223:       hlat(12) = -57.2066
224:       hlat(13) = -54.4162
225:       hlat(14) = -51.6257
226:       hlat(15) = -48.8352
227:       hlat(16) = -46.0447
228:       hlat(17) = -43.2542
229:       hlat(18) = -40.4636
230:       hlat(19) = -37.6731
231:       hlat(20) = -34.8825
232:       hlat(21) = -32.0919
233:       hlat(22) = -29.3014
234:       hlat(23) = -26.5108
235:       hlat(24) = -23.7202
236:       hlat(25) = -20.9296
237:       hlat(26) = -18.1390
238:       hlat(27) = -15.3484
239:       hlat(28) = -12.5578
240:       hlat(29) = -9.76715
241:       hlat(30) = -6.97653
242:       hlat(31) = -4.18592
243:       hlat(32) = -1.39531
244:       hlat(33) = 1.39531
245:       hlat(34) = 4.18592
246:       hlat(35) = 6.97653
247:       hlat(36) = 9.76715
248:       hlat(37) = 12.5578
249:       hlat(38) = 15.3484
250:       hlat(39) = 18.1390
251:       hlat(40) = 20.9296
252:       hlat(41) = 23.7202
253:       hlat(42) = 26.5108
254:       hlat(43) = 29.3014
255:       hlat(44) = 32.0919
256:       hlat(45) = 34.8825
257:       hlat(46) = 37.6731
258:       hlat(47) = 40.4636
259:       hlat(48) = 43.2542
260:       hlat(49) = 46.0447
261:       hlat(50) = 48.8352
262:       hlat(51) = 51.6257
263:       hlat(52) = 54.4162
264:       hlat(53) = 57.2066
265:       hlat(54) = 59.9970
266:       hlat(55) = 62.7874
267:       hlat(56) = 65.5776
268:       hlat(57) = 68.3678
269:       hlat(58) = 71.1578
270:       hlat(59) = 73.9475
271:       hlat(60) = 76.7369
272:       hlat(61) = 79.5256
273:       hlat(62) = 82.3129
274:       hlat(63) = 85.0965
275:       hlat(64) = 87.8638
276:       do i = 1 , ilon
277:         hlon(i) = float(i-1)*2.8125
278:       end do
279: !
280:       sigmar(1) = .01
281:       sigmar(2) = .03
282:       sigmar(3) = .05
283:       sigmar(4) = .07
284:       sigmar(5) = .1
285:       sigmar(6) = .15
286:       sigmar(7) = .2
287:       sigmar(8) = .25
288:       sigmar(9) = .3
289:       sigmar(10) = .4
290:       sigmar(11) = .5
291:       sigmar(12) = .7
292:       sigmar(13) = .85
293:       sigmar(14) = .925
294:       sigmar(15) = 1.0
295: !
296: !HH:OVER
297: !     CHANGE ORDER OF VERTICAL INDEXES FOR PRESSURE LEVELS
298: !
299: !HH:ECMWF-T42
300: !:
301:       do k = 1 , nlev1
302:         kr = nlev1 - k + 1
303:         sigma1(k) = sigmar(kr)
304:       end do
305: 
306:       allocate(b3(jx,iy,nlev1*3))
307:       allocate(d3(jx,iy,nlev1*2))
308:       
309: !       Set up pointers
310: 
311:       u3 => d3(:,:,1:nlev1)
312:       v3 => d3(:,:,nlev1+1:2*nlev1)
313:       t3 => b3(:,:,1:nlev1)
314:       h3 => b3(:,:,nlev1+1:2*nlev1)
315:       q3 => b3(:,:,2*nlev1+1:3*nlev1)
316:       u1 => d2(:,:,1:nlev1)
317:       v1 => d2(:,:,nlev1+1:2*nlev1)
318:       t1 => b2(:,:,1:nlev1)
319:       h1 => b2(:,:,nlev1+1:2*nlev1)
320:       q1 => b2(:,:,2*nlev1+1:3*nlev1)
321: 
322:       end subroutine headerec
323: 
324:       end module mod_ecwcp
</PRE>

<HR>

</BODY>
</HTML>
