<HTML>

<HEAD>
<TITLE>clm3grid1.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>clm3grid1.f90</H1>
<HR>
<H2 ALIGN=CENTER>clm3grid1.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=clm3grid1><H3>clm3grid1</H3></a></p> Click <a href="./callingtree/clm3grid1_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where clm3grid1 is used.
<hr>
20:       subroutine clm3grid1(nlon,nlat,nlev,ntim,glon1,glon2,glat1,glat2, &
21:                          & xlonmin,xlonmax,xlatmin,xlatmax,glon,glat,   &
22:                          & istart,icount)
23:       implicit none
24: !
25: ! Dummy arguments
26: !
27:       real(4) :: glat1 , glat2 , glon1 , glon2 , xlatmax , xlatmin ,    &
28:             & xlonmax , xlonmin
29:       integer :: nlat , nlev , nlon , ntim
30:       real(4) , dimension(nlat) :: glat
31:       real(4) , dimension(nlon) :: glon
32:       integer , dimension(4) :: icount , istart
33:       intent (in) glat1 , glat2 , nlat , nlev , nlon , ntim
34:       intent (out) glat , glon , icount , istart
35:       intent (inout) glon1 , glon2 , xlatmax , xlatmin , xlonmax ,      &
36:                    & xlonmin
37: !
38: ! Local variables
39: !
40:       integer :: corrlatn , corrlats , i , ilatmax , ilatmin , ilonmax ,&
41:                & ilonmin , j
42:       real(4) :: dlat , dlon
43:  
44: !     dlon = 360./nlon
45: !     dlat = 180./nlat
46: 
47: !     ABT added to get mksrf dependent resolution
48:       dlon = (glon2+abs(glon1)+0.5)/nlon
49:       dlat = (glat2+abs(glat1)+0.5)/nlat
50: !     ABT correction terms in case the grid is not from 90S to 90N 
51:       corrlatn = 90 - nint(glat2)
52:       corrlats = -90 - nint(glat1)
53:  
54:       if ( glon1>=0. ) then
55:         glon1 = glon1 - 180.
56:         glon2 = glon2 - 180.
57:       end if
58:       do i = 1 , nlon
59:         glon(i) = glon1 + dlon*float(i-1)
60:       end do
61:       do j = 1 , nlat
62:         glat(j) = glat1 + dlat*float(j-1)
63:       end do
64:  
65:       xlonmin = max(xlonmin-dlon,glon1)
66:       xlonmax = min(xlonmax+dlon,glon2)
67:       xlatmin = max(xlatmin-dlat,glat1)
68:       xlatmax = min(xlatmax+dlat,glat2)
69:       ilonmin = max(min(nint((glon2+xlonmin)/dlon)-1,nlon),1)
70:       ilonmax = max(min(nint((glon2+xlonmax)/dlon)+1,nlon),1)
71: !     abt ilatmin = max(min(nint((glat2+xlatmin)/dlat)-1,nlat),1)
72: !     abt ilatmax = max(min(nint((glat2+xlatmax)/dlat)+1,nlat),1)
73:       ilatmin = max(min(nint((glat2+xlatmin+corrlatn+corrlats)/dlat)-1, &
74:               & nlat),1)   ! ABT added corrlat terms
75:       ilatmax = max(min(nint((glat2+xlatmax+corrlatn+corrlats)/dlat)+1, &
76:               & nlat),1)   ! ABT added corrlat terms
77:       istart(1) = ilonmin
78:       icount(1) = ilonmax - ilonmin + 1
79:       istart(2) = ilatmin
80:       icount(2) = ilatmax - ilatmin + 1
81:       istart(3) = 1
82:       icount(3) = nlev
83:       istart(4) = 1
84:       icount(4) = ntim
85:  
86:       end subroutine clm3grid1
</PRE>

<HR>

</BODY>
</HTML>
