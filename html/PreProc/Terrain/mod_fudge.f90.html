<HTML>

<HEAD>
<TITLE>mod_fudge.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>mod_fudge.f90</H1>
<HR>
<H2 ALIGN=CENTER>mod_fudge.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=mod_fudge><H3>mod_fudge</H3></a></p>20:       module mod_fudge
21: 
22:       implicit none
23: 
24:       contains
25: 
<p><a name=lndfudge><H3>lndfudge</H3></a></p> Click <a href="./callingtree/lndfudge_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where lndfudge is used.
<hr>
26:       subroutine lndfudge(fudge,ch,lndout,htgrid,iy,jx,lsmtyp,char_lnd)
27: 
28:       implicit none
29: !
30: ! Dummy arguments
31: !
32:       character(*) :: char_lnd
33:       logical :: fudge
34:       integer :: iy , jx
35:       character(4) :: lsmtyp
36:       character(1) , dimension(iy,jx) :: ch
37:       real(4) , dimension(iy,jx) :: htgrid , lndout
38:       intent (in) char_lnd , fudge , iy , jx , lsmtyp
39:       intent (inout) ch , htgrid , lndout
40: !
41: ! Local variables
42: !
43:       integer :: i , j
44: !
45:       if ( lsmtyp=='BATS' ) then
46:         if ( fudge ) then
47:           open (13,file=char_lnd,form='formatted')
48:           do i = iy , 1 , -1
49:             read (13,99001) (ch(i,j),j=1,jx)
50:           end do
51:           close (13)
52:           do j = 1 , jx
53:             do i = 1 , iy
54:               if ( ch(i,j)==' ' ) then
55:                 lndout(i,j) = 15.
56:               else if ( ch(i,j)=='1' ) then
57:                 lndout(i,j) = 1.
58:               else if ( ch(i,j)=='2' ) then
59:                 lndout(i,j) = 2.
60:               else if ( ch(i,j)=='3' ) then
61:                 lndout(i,j) = 3.
62:               else if ( ch(i,j)=='4' ) then
63:                 lndout(i,j) = 4.
64:               else if ( ch(i,j)=='5' ) then
65:                 lndout(i,j) = 5.
66:               else if ( ch(i,j)=='6' ) then
67:                 lndout(i,j) = 6.
68:               else if ( ch(i,j)=='7' ) then
69:                 lndout(i,j) = 7.
70:               else if ( ch(i,j)=='8' ) then
71:                 lndout(i,j) = 8.
72:               else if ( ch(i,j)=='9' ) then
73:                 lndout(i,j) = 9.
74:               else if ( ch(i,j)=='A' ) then
75:                 lndout(i,j) = 10.
76:               else if ( ch(i,j)=='B' ) then
77:                 lndout(i,j) = 11.
78:               else if ( ch(i,j)=='C' ) then
79:                 lndout(i,j) = 12.
80:               else if ( ch(i,j)=='D' ) then
81:                 lndout(i,j) = 13.
82:               else if ( ch(i,j)=='E' ) then
83:                 lndout(i,j) = 14.
84:               else if ( ch(i,j)=='F' ) then
85:                 lndout(i,j) = 15.
86:               else if ( ch(i,j)=='G' ) then
87:                 lndout(i,j) = 16.
88:               else if ( ch(i,j)=='H' ) then
89:                 lndout(i,j) = 17.
90:               else if ( ch(i,j)=='I' ) then
91:                 lndout(i,j) = 18.
92:               else if ( ch(i,j)=='J' ) then
93:                 lndout(i,j) = 19.
94:               else if ( ch(i,j)=='K' ) then
95:                 lndout(i,j) = 20.
96:               else if ( nint(lndout(i,j))==0 ) then
97: !               ch(i,j) = 'X'
98:                 ch(i,j) = ' '
99:               else
100:                 write (*,*) 'LANDUSE MASK exceed the limit'
101:                 stop
102:               end if
103: !_fix         if(nint(lndout(i,j)).eq.15) htgrid(i,j) = 0.0
104:               if ( htgrid(i,j)<0.1 .and. nint(lndout(i,j))==15 )        &
105:                  & htgrid(i,j) = 0.0
106:             end do
107:           end do
108:         else
109:           do j = 1 , jx
110:             do i = 1 , iy
111:               if ( nint(lndout(i,j))==15 .or. nint(lndout(i,j))==0 ) then
112:                 ch(i,j) = ' '
113:               else if ( nint(lndout(i,j))==1 ) then
114:                 ch(i,j) = '1'
115:               else if ( nint(lndout(i,j))==2 ) then
116:                 ch(i,j) = '2'
117:               else if ( nint(lndout(i,j))==3 ) then
118:                 ch(i,j) = '3'
119:               else if ( nint(lndout(i,j))==4 ) then
120:                 ch(i,j) = '4'
121:               else if ( nint(lndout(i,j))==5 ) then
122:                 ch(i,j) = '5'
123:               else if ( nint(lndout(i,j))==6 ) then
124:                 ch(i,j) = '6'
125:               else if ( nint(lndout(i,j))==7 ) then
126:                 ch(i,j) = '7'
127:               else if ( nint(lndout(i,j))==8 ) then
128:                 ch(i,j) = '8'
129:               else if ( nint(lndout(i,j))==9 ) then
130:                 ch(i,j) = '9'
131:               else if ( nint(lndout(i,j))==10 ) then
132:                 ch(i,j) = 'A'
133:               else if ( nint(lndout(i,j))==11 ) then
134:                 ch(i,j) = 'B'
135:               else if ( nint(lndout(i,j))==12 ) then
136:                 ch(i,j) = 'C'
137:               else if ( nint(lndout(i,j))==13 ) then
138:                 ch(i,j) = 'D'
139:               else if ( nint(lndout(i,j))==14 ) then
140:                 ch(i,j) = 'E'
141:               else if ( nint(lndout(i,j))==16 ) then
142:                 ch(i,j) = 'G'
143:               else if ( nint(lndout(i,j))==17 ) then
144:                 ch(i,j) = 'H'
145:               else if ( nint(lndout(i,j))==18 ) then
146:                 ch(i,j) = 'I'
147:               else if ( nint(lndout(i,j))==19 ) then
148:                 ch(i,j) = 'J'
149:               else if ( nint(lndout(i,j))==20 ) then
150:                 ch(i,j) = 'K'
151:               else
152:                 write (*,*) 'LANDUSE MASK' , nint(lndout(i,j)) ,        &
153:                            &'exceed the limit'
154:                 stop
155:               end if
156:             end do
157:           end do
158:           open (13,file=char_lnd,form='formatted')
159:           do i = iy , 1 , -1
160:             write (13,99001) (ch(i,j),j=1,jx)
161:           end do
162:           close (13)
163:         end if
164:       else if ( lsmtyp=='USGS' ) then
165:         if ( fudge ) then
166:           open (13,file=char_lnd,form='formatted')
167:           do i = iy , 1 , -1
168:             read (13,99001) (ch(i,j),j=1,jx)
169:           end do
170:           close (13)
171:           do j = 1 , jx
172:             do i = 1 , iy
173:               if ( ch(i,j)==' ' ) then
174:                 lndout(i,j) = 25.
175:               else if ( ch(i,j)=='1' ) then
176:                 lndout(i,j) = 1.
177:               else if ( ch(i,j)=='2' ) then
178:                 lndout(i,j) = 2.
179:               else if ( ch(i,j)=='3' ) then
180:                 lndout(i,j) = 3.
181:               else if ( ch(i,j)=='4' ) then
182:                 lndout(i,j) = 4.
183:               else if ( ch(i,j)=='5' ) then
184:                 lndout(i,j) = 5.
185:               else if ( ch(i,j)=='6' ) then
186:                 lndout(i,j) = 6.
187:               else if ( ch(i,j)=='7' ) then
188:                 lndout(i,j) = 7.
189:               else if ( ch(i,j)=='8' ) then
190:                 lndout(i,j) = 8.
191:               else if ( ch(i,j)=='9' ) then
192:                 lndout(i,j) = 9.
193:               else if ( ch(i,j)=='A' ) then
194:                 lndout(i,j) = 10.
195:               else if ( ch(i,j)=='B' ) then
196:                 lndout(i,j) = 11.
197:               else if ( ch(i,j)=='C' ) then
198:                 lndout(i,j) = 12.
199:               else if ( ch(i,j)=='D' ) then
200:                 lndout(i,j) = 13.
201:               else if ( ch(i,j)=='E' ) then
202:                 lndout(i,j) = 14.
203:               else if ( ch(i,j)=='F' ) then
204:                 lndout(i,j) = 15.
205:               else if ( ch(i,j)=='G' ) then
206:                 lndout(i,j) = 16.
207:               else if ( ch(i,j)=='H' ) then
208:                 lndout(i,j) = 17.
209:               else if ( ch(i,j)=='I' ) then
210:                 lndout(i,j) = 18.
211:               else if ( ch(i,j)=='J' ) then
212:                 lndout(i,j) = 19.
213:               else if ( ch(i,j)=='K' ) then
214:                 lndout(i,j) = 20.
215:               else if ( ch(i,j)=='L' ) then
216:                 lndout(i,j) = 21.
217:               else if ( ch(i,j)=='M' ) then
218:                 lndout(i,j) = 22.
219:               else if ( ch(i,j)=='N' ) then
220:                 lndout(i,j) = 23.
221:               else if ( ch(i,j)=='O' ) then
222:                 lndout(i,j) = 24.
223:               else
224:                 write (*,*) 'LANDUSE MASK exceed the limit'
225:                 stop
226:               end if
227:               if ( htgrid(i,j)<0.1 .and.                                &
228:                  & (nint(lndout(i,j))==25 .or. nint(lndout(i,j))==0) )  &
229:                  & htgrid(i,j) = 0.0
230:             end do
231:           end do
232:         else
233:           do j = 1 , jx
234:             do i = 1 , iy
235:               if ( nint(lndout(i,j))==25 .or. nint(lndout(i,j))==0 )    &
236:                  & then
237:                 ch(i,j) = ' '
238:               else if ( nint(lndout(i,j))==1 ) then
239:                 ch(i,j) = '1'
240:               else if ( nint(lndout(i,j))==2 ) then
241:                 ch(i,j) = '2'
242:               else if ( nint(lndout(i,j))==3 ) then
243:                 ch(i,j) = '3'
244:               else if ( nint(lndout(i,j))==4 ) then
245:                 ch(i,j) = '4'
246:               else if ( nint(lndout(i,j))==5 ) then
247:                 ch(i,j) = '5'
248:               else if ( nint(lndout(i,j))==6 ) then
249:                 ch(i,j) = '6'
250:               else if ( nint(lndout(i,j))==7 ) then
251:                 ch(i,j) = '7'
252:               else if ( nint(lndout(i,j))==8 ) then
253:                 ch(i,j) = '8'
254:               else if ( nint(lndout(i,j))==9 ) then
255:                 ch(i,j) = '9'
256:               else if ( nint(lndout(i,j))==10 ) then
257:                 ch(i,j) = 'A'
258:               else if ( nint(lndout(i,j))==11 ) then
259:                 ch(i,j) = 'B'
260:               else if ( nint(lndout(i,j))==12 ) then
261:                 ch(i,j) = 'C'
262:               else if ( nint(lndout(i,j))==13 ) then
263:                 ch(i,j) = 'D'
264:               else if ( nint(lndout(i,j))==14 ) then
265:                 ch(i,j) = 'E'
266:               else if ( nint(lndout(i,j))==15 ) then
267:                 ch(i,j) = 'F'
268:               else if ( nint(lndout(i,j))==16 ) then
269:                 ch(i,j) = 'G'
270:               else if ( nint(lndout(i,j))==17 ) then
271:                 ch(i,j) = 'H'
272:               else if ( nint(lndout(i,j))==18 ) then
273:                 ch(i,j) = 'I'
274:               else if ( nint(lndout(i,j))==19 ) then
275:                 ch(i,j) = 'J'
276:               else if ( nint(lndout(i,j))==20 ) then
277:                 ch(i,j) = 'K'
278:               else if ( nint(lndout(i,j))==21 ) then
279:                 ch(i,j) = 'L'
280:               else if ( nint(lndout(i,j))==22 ) then
281:                 ch(i,j) = 'M'
282:               else if ( nint(lndout(i,j))==23 ) then
283:                 ch(i,j) = 'N'
284:               else if ( nint(lndout(i,j))==24 ) then
285:                 ch(i,j) = 'O'
286:               else
287:                 write (*,*) 'LANDUSE MASK' , nint(lndout(i,j)) ,        &
288:                            &'exceed the limit'
289:                 stop
290:               end if
291:             end do
292:           end do
293:           open (13,file=char_lnd,form='formatted')
294:           do i = iy , 1 , -1
295:             write (13,99001) (ch(i,j),j=1,jx)
296:           end do
297:           close (13)
298:         end if
299:       else
300:         print * , 'LANDUSE LEGEND DOES NOT EXIST'
301:         stop 'subroutine LNDFUDGE'
302:       end if
303: 99001 format (132A1)
304:       end subroutine lndfudge
305: 
<p><a name=texfudge><H3>texfudge</H3></a></p> Click <a href="./callingtree/texfudge_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where texfudge is used.
<hr>
306:       subroutine texfudge(fudge,ch,texout,htgrid,iy,jx,char_tex)
307:       implicit none
308: !
309: ! Dummy arguments
310: !
311:       character(*) :: char_tex
312:       logical :: fudge
313:       integer :: iy , jx
314:       character(1) , dimension(iy,jx) :: ch
315:       real(4) , dimension(iy,jx) :: htgrid , texout
316:       intent (in) char_tex , fudge , iy , jx
317:       intent (out) htgrid
318:       intent (inout) ch , texout
319: !
320: ! Local variables
321: !
322:       integer :: i , j
323: !
324:       if ( fudge ) then
325:         open (13,file=char_tex,form='formatted')
326:         do i = iy , 1 , -1
327:           read (13,99001) (ch(i,j),j=1,jx)
328:         end do
329:         close (13)
330:         do j = 1 , jx
331:           do i = 1 , iy
332:             if ( ch(i,j)==' ' ) then
333:               texout(i,j) = 14.
334:             else if ( ch(i,j)=='1' ) then
335:               texout(i,j) = 1.
336:             else if ( ch(i,j)=='2' ) then
337:               texout(i,j) = 2.
338:             else if ( ch(i,j)=='3' ) then
339:               texout(i,j) = 3.
340:             else if ( ch(i,j)=='4' ) then
341:               texout(i,j) = 4.
342:             else if ( ch(i,j)=='5' ) then
343:               texout(i,j) = 5.
344:             else if ( ch(i,j)=='6' ) then
345:               texout(i,j) = 6.
346:             else if ( ch(i,j)=='7' ) then
347:               texout(i,j) = 7.
348:             else if ( ch(i,j)=='8' ) then
349:               texout(i,j) = 8.
350:             else if ( ch(i,j)=='9' ) then
351:               texout(i,j) = 9.
352:             else if ( ch(i,j)=='A' ) then
353:               texout(i,j) = 10.
354:             else if ( ch(i,j)=='B' ) then
355:               texout(i,j) = 11.
356:             else if ( ch(i,j)=='C' ) then
357:               texout(i,j) = 12.
358:             else if ( ch(i,j)=='D' ) then
359:               texout(i,j) = 13.
360:             else if ( ch(i,j)=='E' ) then
361:               texout(i,j) = 14.
362:             else if ( ch(i,j)=='F' ) then
363:               texout(i,j) = 15.
364:             else if ( ch(i,j)=='G' ) then
365:               texout(i,j) = 16.
366:             else if ( ch(i,j)=='H' ) then
367:               texout(i,j) = 17.
368:             else if ( nint(texout(i,j))==0 ) then
369: !             ch(i,j) = 'X'
370:               ch(i,j) = ' '
371:             else
372:               write (*,*) 'TEXTURE TYPE exceed the limit'
373:               stop
374:             end if
375:             if ( nint(texout(i,j))==14 ) htgrid(i,j) = 0.0
376:           end do
377:         end do
378:       else
379:         do j = 1 , jx
380:           do i = 1 , iy
381:             if ( nint(texout(i,j))==14 ) then
382:               ch(i,j) = ' '
383:             else if ( nint(texout(i,j))==1 ) then
384:               ch(i,j) = '1'
385:             else if ( nint(texout(i,j))==2 ) then
386:               ch(i,j) = '2'
387:             else if ( nint(texout(i,j))==3 ) then
388:               ch(i,j) = '3'
389:             else if ( nint(texout(i,j))==4 ) then
390:               ch(i,j) = '4'
391:             else if ( nint(texout(i,j))==5 ) then
392:               ch(i,j) = '5'
393:             else if ( nint(texout(i,j))==6 ) then
394:               ch(i,j) = '6'
395:             else if ( nint(texout(i,j))==7 ) then
396:               ch(i,j) = '7'
397:             else if ( nint(texout(i,j))==8 ) then
398:               ch(i,j) = '8'
399:             else if ( nint(texout(i,j))==9 ) then
400:               ch(i,j) = '9'
401:             else if ( nint(texout(i,j))==10 ) then
402:               ch(i,j) = 'A'
403:             else if ( nint(texout(i,j))==11 ) then
404:               ch(i,j) = 'B'
405:             else if ( nint(texout(i,j))==12 ) then
406:               ch(i,j) = 'C'
407:             else if ( nint(texout(i,j))==13 ) then
408:               ch(i,j) = 'D'
409:             else if ( nint(texout(i,j))==15 ) then
410:               ch(i,j) = 'F'
411:             else if ( nint(texout(i,j))==16 ) then
412:               ch(i,j) = 'G'
413:             else if ( nint(texout(i,j))==17 ) then
414:               ch(i,j) = 'H'
415:             else
416:               write (*,*) 'TEXTURE TYPE' , nint(texout(i,j)) ,          &
417:                          &'exceed the limit'
418:               stop
419:             end if
420:           end do
421:         end do
422:         open (13,file=char_tex,form='formatted')
423:         do i = iy , 1 , -1
424:           write (13,99001) (ch(i,j),j=1,jx)
425:         end do
426:         close (13)
427:       end if
428: 99001 format (132A1)
429:       end subroutine texfudge
430: 
<p><a name=lakeadj><H3>lakeadj</H3></a></p> Click <a href="./callingtree/lakeadj_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where lakeadj is used.
<hr>
431:       subroutine lakeadj(lsmtyp,lnduse,htgrid,xlat,xlon,imx,jmx)
432:  
433:       implicit none
434: !
435: ! PARAMETER definitions
436: !
437:       real(4) , parameter :: zerie = 174. , zhuron = 177. ,             &
438:                            & zontar = 75. , zsup = 183. , zmich = 177.
439: !
440: ! Dummy arguments
441: !
442:       integer :: imx , jmx
443:       character(4) :: lsmtyp
444:       real(4) , dimension(imx,jmx) :: htgrid , xlat , xlon
445:       integer , dimension(imx,jmx) :: lnduse
446:       intent (in) imx , jmx , lnduse , lsmtyp , xlat , xlon
447:       intent (inout) htgrid
448: !
449: ! Local variables
450: !
451:       integer :: i , j
452:       real(4) :: xx , yy
453: !
454: !     ****  ADJUST GREAT LAKE ELEVATION **** C
455: !
456:       do i = 1 , imx
457:         do j = 1 , jmx
458:           if ( (lsmtyp=='BATS' .and. lnduse(i,j)==14) .or.              &
459:               &(lsmtyp=='USGS' .and. lnduse(i,j)==16) ) then
460:             xx = xlon(i,j)
461:             yy = xlat(i,j)
462:             if ( yy<=43.2 .and. yy>=41.0 .and. xx<=-78.0 .and.          &
463:                & xx>=-84.0 ) then                       ! LAKE ERIE
464:               print * , '**** ADUJUSTING LAKE ERIE LEVEL ****'
465:               print * , '     NEW:' , zerie , '    OLD:' , htgrid(i,j) ,&
466:                   & i , j
467:               htgrid(i,j) = zerie
468:             else if ( yy<=46.4 .and. yy>=43.0 .and. xx<=-79.9 .and.     &
469:                     & yy>=-85.0 ) then                  ! LAKE HURON
470:               print * , '**** ADUJUSTING LAKE HURON LEVEL ****'
471:               print * , '     NEW:' , zhuron , '    OLD:' , htgrid(i,j) &
472:                   & , i , j
473:               htgrid(i,j) = zhuron
474:             else if ( yy<=44.5 .and. yy>=43.2 .and. xx<=-75.0 .and.     &
475:                     & yy>=-79.9 ) then                  ! LAKE ONTARIO
476:               print * , '**** ADUJUSTING LAKE ONTARIO LEVEL ****'
477:               print * , '     NEW:' , zontar , '    OLD:' , htgrid(i,j) &
478:                   & , i , j
479:               htgrid(i,j) = zontar
480:             else if ( yy<=49.4 .and. yy>=46.2 .and. xx<=-84.2 .and.     &
481:                     & xx>=-93.0 ) then                  ! LAKE SUPERIOR
482:               print * , '**** ADUJUSTING LAKE SUPERIOR LEVEL ****'
483:               print * , '     NEW:' , zsup , '    OLD:' , htgrid(i,j) , &
484:                   & i , j
485:               htgrid(i,j) = zsup
486:             else if ( yy<=46.2 .and. yy>=41.0 .and. xx<=-84.8 .and.     &
487:                     & xx>=-89.0 ) then                  ! LAKE MICHIGAN
488:               print * , '**** ADUJUSTING LAKE MICHIGAN LEVEL ****'
489:               print * , '     NEW:' , zmich , '    OLD:' , htgrid(i,j) ,&
490:                   & i , j
491:               htgrid(i,j) = zmich
492:             else
493:             end if
494:           end if
495:         end do
496:       end do
497:  
498:       end subroutine lakeadj
499: 
500:       end module mod_fudge
</PRE>

<HR>

</BODY>
</HTML>
