<HTML>

<HEAD>
<TITLE>radems.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>radems.f90</H1>
<HR>
<H2 ALIGN=CENTER>radems.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=radems><H3>radems</H3></a></p> Click <a href="./callingtree/radems_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where radems is used.
<hr>
20:       subroutine radems(s2c,s2t,w,tplnke,plh2o,pnm,plco2,tint,tint4,    &
21:                       & tlayr,tlayr4,plol,plos,ucfc11,ucfc12,un2o0,     &
22:                       & un2o1,uch4,uco211,uco212,uco213,uco221,uco222,  &
23:                       & uco223,uptype,bn2o0,bn2o1,bch4,co2em,co2eml,    &
24:                       & co2t,h2otr,abplnk1,abplnk2,jslc)
25: !
26: !-----------------------------------------------------------------------
27: !
28: ! Compute emissivity for H2O, CO2, O3
29: !
30: ! H2O  ....  Uses nonisothermal emissivity for water vapor from
31: !            Ramanathan, V. and  P.Downey, 1986: A Nonisothermal
32: !            Emissivity and Absorptivity Formulation for Water Vapor
33: !            Jouranl of Geophysical Research, vol. 91., D8, pp 8649-8666
34: !
35: !
36: ! CO2  ....  Uses absorptance parameterization of the 15 micro-meter
37: !            (500 - 800 cm-1) band system of Carbon Dioxide, from
38: !            Kiehl, J.T. and B.P.Briegleb, 1991: A New Parameterization
39: !            of the Absorptance Due to the 15 micro-meter Band System
40: !            of Carbon Dioxide Jouranl of Geophysical Research,
41: !            vol. 96., D5, pp 9013-9019
42: !
43: ! O3   ....  Uses absorptance parameterization of the 9.6 micro-meter
44: !            band system of ozone, from Ramanathan, V. and R. Dickinson,
45: !            1979: The Role of stratospheric ozone in the zonal and
46: !            seasonal radiative energy balance of the earth-troposphere
47: !            system. Journal of the Atmospheric Sciences, Vol. 36,
48: !            pp 1084-1104
49: !
50: ! Computes individual emissivities, accounting for band overlap, and
51: ! sums to obtain the total.
52: !
53: !---------------------------Code history--------------------------------
54: !
55: ! Original version:  CCM1
56: ! Standardized:      J. Rosinski, June 1992
57: ! Reviewed:          J. Kiehl, B. Briegleb, August 1992
58: !
59: !-----------------------------------------------------------------------
60: !
61:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
62:       use <a href="./mod_crdcae.f90.html#mod_crdcae" TARGET=CENT_PANEL>mod_crdcae</a>
63:       use <a href="./mod_constants.F90.html#mod_constants" TARGET=CENT_PANEL>mod_constants</a> , only : rsslp , rga , dpfco2 , dpfo3
64:       use <a href="./mod_radbuf.F90.html#mod_radbuf" TARGET=CENT_PANEL>mod_radbuf</a>
65:       implicit none
66: !
67: !------------------------------Arguments--------------------------------
68: !
69: !     Input arguments
70: !
71: ! s2c     - H2o continuum path length
72: ! s2t     - Tmp and prs wghted h2o path length
73: ! w       - H2o path length
74: ! tplnke  - Layer planck temperature
75: ! plh2o   - H2o prs wghted path length
76: ! pnm     - Model interface pressure
77: ! plco2   - Prs wghted path of co2
78: ! tint    - Model interface temperatures
79: ! tint4   - Tint to the 4th power
80: ! tlayr   - K-1 model layer temperature
81: ! tlayr4  - Tlayr to the 4th power
82: ! plol    - Pressure wghtd ozone path
83: ! plos    - Ozone path
84: !
85: !     Trace gas variables
86: !
87: ! ucfc11  - CFC11 path length
88: ! ucfc12  - CFC12 path length
89: ! un2o0   - N2O path length
90: ! un2o1   - N2O path length (hot band)
91: ! uch4    - CH4 path length
92: ! uco211  - CO2 9.4 micron band path length
93: ! uco212  - CO2 9.4 micron band path length
94: ! uco213  - CO2 9.4 micron band path length
95: ! uco221  - CO2 10.4 micron band path length
96: ! uco222  - CO2 10.4 micron band path length
97: ! uco223  - CO2 10.4 micron band path length
98: ! bn2o0   - pressure factor for n2o
99: ! bn2o1   - pressure factor for n2o
100: ! bch4    - pressure factor for ch4
101: ! uptype  - p-type continuum path length
102: !
103: !     Output arguments
104: !
105: ! co2em   - Layer co2 normalzd plnck funct drvtv
106: ! co2eml  - Intrfc co2 normalzd plnck func drvtv
107: ! co2t    - Tmp and prs weighted path length
108: ! h2otr   - H2o transmission over o3 band
109: ! emplnk  - emissivity Planck factor
110: ! abplnk1 - non-nearest layer Plack factor
111: ! abplnk2 - nearest layer factor
112: ! emstrc  - total trace gas emissivity
113: !
114: ! Dummy arguments
115: !
116:       integer :: jslc
117:       real(8) , dimension(14,iym1,kzp1) :: abplnk1 , abplnk2
118:       real(8) , dimension(iym1,kzp1) :: bch4 , bn2o0 , bn2o1 , co2em ,&
119:            & co2t , h2otr , plco2 , plh2o , plol , plos , pnm , s2c ,   &
120:            & s2t , tint , tint4 , tlayr , tlayr4 , ucfc11 , ucfc12 ,    &
121:            & uch4 , uco211 , uco212 , uco213 , uco221 , uco222 ,        &
122:            & uco223 , un2o0 , un2o1 , uptype , w
123:       real(8) , dimension(iym1,kz) :: co2eml
124:       real(8) , dimension(iym1) :: tplnke
125:       intent (in) jslc , plco2 , plh2o , plol , plos , s2t , tint4 ,    &
126:                 & tlayr4
127:       intent (out) co2em , co2eml
128:       intent (inout) co2t , h2otr
129: !
130: !---------------------------Local variables-----------------------------
131: !
132: ! i       - Longitude index
133: ! k       - Level index
134: ! k1      - Level index
135: ! iband   - H2o band index
136: !
137: !     Local variables for H2O:
138: !
139: ! h2oems  - H2o emissivity
140: ! tpathe  - Used to compute h2o emissivity
141: ! a       - Eq(2) in table A3a of R&D
142: ! corfac  - Correction factors in table A3b rotation band absorptivity
143: ! dtp     - Path temperature minus 300 K used in
144: ! dtx     - Planck temperature minus 250 K
145: ! dty     - Path temperature minus 250 K
146: ! dtz     - Planck temperature minus 300 K
147: ! emis    - Total emissivity (h2o+co2+o3)
148: ! rsum    - Eq(1) in table A2 of R&D
149: ! term1   - Equation(5) in table A3a of R&D(1986)
150: ! term2   - Delta a(Te) in table A3a of R&D(1986)
151: ! term3   - B(T) function for rotation and vibration-rotation band emissivity
152: ! term4   - Equation(6) in table A3a of R&D(1986)
153: ! term5   - Delta a(Tp) in table A3a of R&D(1986)
154: ! term6   - B(T) function for window region
155: ! term7   - Kl_inf(i) in eq(8) of table A3a of R&D
156: ! term8   - Delta kl_inf(i) in eq(8)
157: ! term9   - B(T) function for 500-800 cm-1 region
158: ! tr1     - Equation(6) in table A2 for 650-800
159: ! tr2     - Equation(6) in table A2 for 500-650
160: ! tr3     - Equation(4) in table A2 for 650-800
161: ! tr4     - Equation(4),table A2 of R&D for 500-650 
162: ! tr7     - Equation (6) times eq(4) in table A2 of R&D for 650-800 cm-1 region
163: ! tr8     - Equation (6) times eq(4) in table A2 of R&D for 500-650 cm-1 region
164: ! uc      - Y + 0.002U in eq(8) of table A2 of R&D
165: ! pnew    - Effective pressure for h2o linewidth
166: ! trline  - Transmission due to H2O lines in window
167: ! k21     - Exponential coefficient used to calc rot band transmissivity
168: !           in the 650-800 cm-1 region (tr1)
169: ! k22     - Exponential coefficient used to calc rot band transmissivity
170: !           in the 500-650 cm-1 region (tr2)
171: ! u       - Pressure weighted H2O path length
172: ! uc1     - H2o continuum pathlength 500-800 cm-1
173: ! r80257  - Conversion factor for h2o pathlength
174: ! a11     - A1 in table A3b for rotation band emiss
175: ! a31     - A3 in table A3b for rotation band emiss
176: ! a21     - First part in numerator of A2 table A3b
177: ! a22     - Second part in numertor of A2 table A3b
178: ! a23     - Denominator of A2 table A3b (rot band)
179: ! t1t4    - Eq(3) in table A3a of R&D
180: ! t2t5    - Eq(4) in table A3a of R&D
181: ! fwk     - Equation(33) in R&D far wing correction
182: ! a41     - Numerator in A2 in Vib-rot (table A3b)
183: ! a51     - Denominator in A2 in Vib-rot(table A3b)
184: ! a61     - A3 factor for Vib-rot band in table A3b
185: ! phi     - Eq(11) in table A3a of R&D
186: ! psi     - Eq(12) in table A3a of R&D
187: ! ubar    - H2o scaled path comment eq(10) table A2
188: ! g1      - Part of eq(10) table A2
189: ! pbar    - H2o scaled pres comment eq(10) table A2
190: ! g3      - Part of eq(10) table A2
191: ! g2      - Part of arguement in eq(10) in table A2
192: ! g4      - Arguement in exp() in eq(10) table A2
193: ! cf812   - Eq(11) in table A2 of R&D
194: ! troco2  - H2o overlap factor for co2 absorption
195: !
196: !     Local variables for CO2:
197: !
198: ! co2ems  - Co2 emissivity
199: ! co2plk  - Used to compute co2 emissivity
200: ! xsum    - Used to calculate path temperature
201: ! t1i     - Co2 hot band temperature factor
202: ! sqti    - Sqrt of temperature
203: ! pi      - Pressure used in co2 mean line width
204: ! et      - Co2 hot band factor
205: ! et2     - Co2 hot band factor
206: ! et4     - Co2 hot band factor
207: ! omet    - Co2 stimulated emission term
208: ! ex      - Part of co2 planck function
209: ! f1co2   - Co2 weak band factor
210: ! f2co2   - Co2 weak band factor
211: ! f3co2   - Co2 weak band factor
212: ! t1co2   - Overlap factor weak bands strong band
213: ! sqwp    - Sqrt of co2 pathlength
214: ! f1sqwp  - Main co2 band factor
215: ! oneme   - Co2 stimulated emission term
216: ! alphat  - Part of the co2 stimulated emiss term
217: ! wco2    - Consts used to define co2 pathlength
218: ! posqt   - Effective pressure for co2 line width
219: ! rbeta7  - Inverse of co2 hot band line width par
220: ! rbeta8  - Inverse of co2 hot band line width par
221: ! rbeta9  - Inverse of co2 hot band line width par
222: ! rbeta13 - Inverse of co2 hot band line width par
223: ! tpath   - Path temp used in co2 band model
224: ! tmp1    - Co2 band factor
225: ! tmp2    - Co2 band factor
226: ! tmp3    - Co2 band factor
227: ! tlayr5  - Temperature factor in co2 Planck func
228: ! rsqti   - Reciprocal of sqrt of temperature
229: ! exm1sq  - Part of co2 Planck function
230: ! u7      - Absorber amount for various co2 band systems
231: ! u8      - Absorber amount for various co2 band systems
232: ! u9      - Absorber amount for various co2 band systems
233: ! u13     - Absorber amount for various co2 band systems
234: ! r250    - Inverse 250K
235: ! r300    - Inverse 300K
236: ! rsslp   - Inverse standard sea-level pressure
237: !
238: !     Local variables for O3:
239: !
240: ! o3ems   - Ozone emissivity
241: ! dbvtt   - Tmp drvtv of planck fctn for tplnke
242: ! te      - Temperature factor
243: ! u1      - Path length factor
244: ! u2      - Path length factor
245: ! phat    - Effecitive path length pressure
246: ! tlocal  - Local planck function temperature
247: ! tcrfac  - Scaled temperature factor
248: ! beta    - Absorption funct factor voigt effect
249: ! realnu  - Absorption function factor
250: ! o3bndi  - Band absorption factor
251: !
252: !     Transmission terms for various spectral intervals:
253: !
254: ! trem4   - H2o   800 - 1000 cm-1
255: ! trem6   - H2o  1000 - 1200 cm-1
256: ! absbnd  - Proportional to co2 band absorptance
257: ! tco2    - co2 overlap factor
258: ! th2o    - h2o overlap factor
259: ! to3     - o3 overlap factor
260: !
261: !
262: ! Local variables
263: !
264:       real(8) , dimension(iym1) :: a , co2plk , corfac , dbvtt , dtp ,  &
265:                                   & dtx , dty , dtz , k21 , k22 , pnew ,&
266:                                   & rsum , tco2 , th2o , to3 , tpathe , &
267:                                   & tr1 , tr2 , tr3 , tr4 , tr7 , tr8 , &
268:                                   & trem4 , trem6 , u , uc , uc1 , xsum
269:       real(8) :: a11 , a21 , a22 , a23 , a31 , a41 , a51 , a61 ,        &
270:                & absbnd , alphat , beta , cf812 , et , et2 , et4 , ex , &
271:                & exm1sq , f1co2 , f1sqwp , f2co2 , f3co2 , fwk , g1 ,   &
272:                & g2 , g3 , g4 , o3bndi , omet , oneme , pbar , phat ,   &
273:                & phi , pi , posqt , <a href="./mod_zengocn.F90.html#psi" TARGET=CENT_PANEL>psi</a> , r250 , r300 , r80257 ,        &
274:                & rbeta13 , rbeta7 , rbeta8 , rbeta9 , realnu , rsqti ,  &
275:                & sqti , sqwp , t , t1co2 , t1i , t1t4 , t2t5 ,          &
276:                & tcrfac , te , tlayr5 , tlocal , tmp1 , tmp2 , tmp3 ,   &
277:                & tpath , u1 , u13 , u2 , u7 , u8 , u9 , ubar , ux , vx ,&
278:                & wco2
279:       real(8) , dimension(iym1,kzp1) :: co2ems , emstrc , h2oems ,    &
280:            & o3ems , troco2
281:       real(8) :: dbvt , fo3
282:       real(8) , dimension(iym1,4) :: emis , term1 , term2 , term3 ,    &
283:                                     & term4 , term5
284:       real(8) , dimension(14,iym1) :: emplnk
285:       integer :: i , iband , k , k1
286:       real(8) , dimension(iym1,2) :: term6 , term7 , term8 , term9 ,   &
287:                                     & trline
288: !
289: !---------------------------Statement functions-------------------------
290: !
291: !     Statement functions
292: !     Derivative of planck function at 9.6 micro-meter wavelength, and
293: !     an absorption function factor:
294: !
295: !
296:       dbvt(t) = (-2.8911366682D-4+(2.3771251896D-6+1.1305188929D-10*t)  &
297:               & *t)/(1.D0+(-6.1364820707D-3+1.5550319767D-5*t)*t)
298: !
299:       fo3(ux,vx) = ux/dsqrt(4.D0+ux*(1.D0+vx))
300: !
301: !-----------------------------------------------------------------------
302: !
303: !     Initialize
304: !
305:       r80257 = 1.D0/8.0257D-04
306: !
307:       r250 = 1.D0/250.D0
308:       r300 = 1.D0/300.D0
309: !
310: !     Planck function for co2
311: !
312:       do i = 1 , iym1
313:         ex = dexp(960.D0/tplnke(i))
314:         co2plk(i) = 5.D8/((tplnke(i)**4)*(ex-1.))
315:         co2t(i,1) = tplnke(i)
316:         xsum(i) = co2t(i,1)*pnm(i,1)
317:       end do
318:       k = 1
319:       do k1 = kzp1 , 2 , -1
320:         k = k + 1
321:         do i = 1 , iym1
322:           xsum(i) = xsum(i) + tlayr(i,k)*(pnm(i,k)-pnm(i,k-1))
323:           ex = dexp(960./tlayr(i,k1))
324:           tlayr5 = tlayr(i,k1)*tlayr4(i,k1)
325:           co2eml(i,k1-1) = 1.2E11*ex/(tlayr5*(ex-1.)**2)
326:           co2t(i,k) = xsum(i)/pnm(i,k)
327:         end do
328:       end do
329: !     bndfct = 2.d0*22.18/(dsqrt(196.d0)*300.)
330: !
331: !     Initialize planck function derivative for O3
332: !
333:       do i = 1 , iym1
334:         dbvtt(i) = dbvt(tplnke(i))
335:       end do
336: !
337: !     Calculate trace gas Planck functions
338: !
339:       call <a href="./trcplk.f90.html#trcplk" TARGET=CENT_PANEL>trcplk</a>(tint,tlayr,tplnke,emplnk,abplnk1,abplnk2)
340: !
341: !     Interface loop
342: !
343:       do k1 = 1 , kzp1
344: !
345: !       H2O emissivity
346: !
347: !       emis(i,1)     0 -  800 cm-1   rotation band
348: !       emis(i,2)  1200 - 2200 cm-1   vibration-rotation band
349: !       emis(i,3)   800 - 1200 cm-1   window
350: !       emis(i,4)   500 -  800 cm-1   rotation band overlap with co2
351: !
352: !       For the p type continuum
353: !
354:         do i = 1 , iym1
355:           uc(i) = s2c(i,k1) + 2.E-3*plh2o(i,k1)
356:           u(i) = plh2o(i,k1)
357:           pnew(i) = u(i)/w(i,k1)
358: !
359: !         Apply scaling factor for 500-800 continuum
360: !
361:           uc1(i) = (s2c(i,k1)+1.7E-3*plh2o(i,k1))*(1.+2.*s2c(i,k1))     &
362:                  & /(1.+15.*s2c(i,k1))
363:           tpathe(i) = s2t(i,k1)/plh2o(i,k1)
364:         end do
365:         do i = 1 , iym1
366:           dtx(i) = tplnke(i) - 250.
367:           dty(i) = tpathe(i) - 250.
368:           dtz(i) = dtx(i) - 50.
369:           dtp(i) = dty(i) - 50.
370:         end do
371:         do iband = 1 , 3 , 2
372:           do i = 1 , iym1
373:             term1(i,iband) = coefe(1,iband) + coefe(2,iband)*dtx(i)     &
374:                            & *(1.+c1(iband)*dtx(i))
375:             term2(i,iband) = coefb(1,iband) + coefb(2,iband)*dtx(i)     &
376:                            & *(1.+c2(iband)*dtx(i)*(1.+c3(iband)*dtx(i))&
377:                            & )
378:             term3(i,iband) = coefd(1,iband) + coefd(2,iband)*dtx(i)     &
379:                            & *(1.+c4(iband)*dtx(i)*(1.+c5(iband)*dtx(i))&
380:                            & )
381:             term4(i,iband) = coefa(1,iband) + coefa(2,iband)*dty(i)     &
382:                            & *(1.+c6(iband)*dty(i))
383:             term5(i,iband) = coefc(1,iband) + coefc(2,iband)*dty(i)     &
384:                            & *(1.+c7(iband)*dty(i))
385:           end do
386:         end do
387: !
388: !       emis(i,1)     0 -  800 cm-1   rotation band
389: !
390:         do i = 1 , iym1
391:           a11 = .37 - 3.33E-5*dtz(i) + 3.33E-6*dtz(i)*dtz(i)
392:           a31 = 1.07 - 1.00E-3*dtp(i) + 1.475E-5*dtp(i)*dtp(i)
393:           a21 = 1.3870 + 3.80E-3*dtz(i) - 7.8E-6*dtz(i)*dtz(i)
394:           a22 = 1.0 - 1.21E-3*dtp(i) - 5.33E-6*dtp(i)*dtp(i)
395:           a23 = 0.9 + 2.62*dsqrt(u(i))
396:           corfac(i) = a31*(a11+((a21*a22)/a23))
397:           t1t4 = term1(i,1)*term4(i,1)
398:           t2t5 = term2(i,1)*term5(i,1)
399:           a(i) = t1t4 + t2t5/(1.+t2t5*dsqrt(u(i))*corfac(i))
400:           fwk = fwcoef + fwc1/(1.+fwc2*u(i))
401:           rsum(i) = dexp(-a(i)*(dsqrt(u(i))+fwk*u(i)))
402:           emis(i,1) = (1.-rsum(i))*term3(i,1)
403: !         trem1(i)  = rsum(i)
404: !
405: !         emis(i,2)  1200 - 2200 cm-1   vibration-rotation band
406: !
407:           a41 = 1.75 - 3.96E-3*dtz(i)
408:           a51 = 1.00 + 1.3*dsqrt(u(i))
409:           a61 = 1.00 + 1.25E-3*dtp(i) + 6.25E-5*dtp(i)*dtp(i)
410:           corfac(i) = .3*(1.+(a41)/(a51))*a61
411:           t1t4 = term1(i,3)*term4(i,3)
412:           t2t5 = term2(i,3)*term5(i,3)
413:           a(i) = t1t4 + t2t5/(1.+t2t5*dsqrt(u(i))*corfac(i))
414:           fwk = fwcoef + fwc1/(1.+fwc2*u(i))
415:           rsum(i) = dexp(-a(i)*(dsqrt(u(i))+fwk*u(i)))
416:           emis(i,2) = (1.-rsum(i))*term3(i,3)
417: !         trem7(i) = rsum(i)
418:         end do
419: !
420: !       Line transmission in 800-1000 and 1000-1200 cm-1 intervals
421: !
422:         do k = 1 , 2
423:           do i = 1 , iym1
424:             phi = a1(k)*(dty(i)+15.) + a2(k)*(dty(i)+15.)**2
425:             <a href="./mod_zengocn.F90.html#psi" TARGET=CENT_PANEL>psi</a> = b1(k)*(dty(i)+15.) + b2(k)*(dty(i)+15.)**2
426:             phi = dexp(phi)
427:             <a href="./mod_zengocn.F90.html#psi" TARGET=CENT_PANEL>psi</a> = dexp(<a href="./mod_zengocn.F90.html#psi" TARGET=CENT_PANEL>psi</a>)
428:             ubar = w(i,k1)*phi
429:             ubar = (ubar*1.66)*r80257
430:             pbar = pnew(i)*(<a href="./mod_zengocn.F90.html#psi" TARGET=CENT_PANEL>psi</a>/phi)
431:             cf812 = cfa1 + ((1.-cfa1)/(1.+ubar*pbar*10.))
432:             g1 = (realk(k)*pbar)/(2.*st(k))
433:             g2 = 1. + (ubar*4.0*st(k)*cf812)/pbar
434:             g3 = dsqrt(g2) - 1.
435:             g4 = g1*g3
436:             trline(i,k) = dexp(-g4)
437:           end do
438:         end do
439:         do i = 1 , iym1
440:           term7(i,1) = coefj(1,1) + coefj(2,1)*dty(i)*(1.+c16*dty(i))
441:           term8(i,1) = coefk(1,1) + coefk(2,1)*dty(i)*(1.+c17*dty(i))
442:           term7(i,2) = coefj(1,2) + coefj(2,2)*dty(i)*(1.+c26*dty(i))
443:           term8(i,2) = coefk(1,2) + coefk(2,2)*dty(i)*(1.+c27*dty(i))
444:         end do
445: !
446: !       emis(i,3)   800 - 1200 cm-1   window
447: !
448:         do i = 1 , iym1
449:           term6(i,1) = coeff(1,1) + coeff(2,1)*dtx(i)                   &
450:                      & *(1.+c8*dtx(i)*(1.+c10*dtx(i)                    &
451:                      & *(1.+c12*dtx(i)*(1.+c14*dtx(i)))))
452:           trem4(i) = dexp(-(coefg(1,1)+coefg(2,1)*dtx(i))*uc(i))        &
453:                    & *trline(i,2)
454:           trem6(i) = dexp(-(coefg(1,2)+coefg(2,2)*dtx(i))*uc(i))        &
455:                    & *trline(i,1)
456:           emis(i,3) = term6(i,1)*(1.-.5*trem4(i)-.5*trem6(i))
457: !
458: !         emis(i,4)   500 -  800 cm-1   rotation band overlap with co2
459: !
460:           k21(i) = term7(i,1) + term8(i,1)                              &
461:                  & /(1.+(c30+c31*(dty(i)-10.)*(dty(i)-10.))*dsqrt(u(i)))
462:           k22(i) = term7(i,2) + term8(i,2)                              &
463:                  & /(1.+(c28+c29*(dty(i)-10.))*dsqrt(u(i)))
464:           term9(i,1) = coefi(1,1) + coefi(2,1)*dtx(i)                   &
465:                      & *(1.+c18*dtx(i)*(1.+c20*dtx(i)                   &
466:                      & *(1.+c22*dtx(i)*(1.+c24*dtx(i)))))
467:           fwk = fwcoef + fwc1/(1.+fwc2*u(i))
468:           tr1(i) = dexp(-(k21(i)*(dsqrt(u(i))+fc1*fwk*u(i))))
469:           tr2(i) = dexp(-(k22(i)*(dsqrt(u(i))+fc1*fwk*u(i))))
470:           tr3(i) = dexp(-((coefh(1,1)+coefh(2,1)*dtx(i))*uc1(i)))
471:           tr4(i) = dexp(-((coefh(1,2)+coefh(2,2)*dtx(i))*uc1(i)))
472:           tr7(i) = tr1(i)*tr3(i)
473:           tr8(i) = tr2(i)*tr4(i)
474:           emis(i,4) = term9(i,1)*.5*(tr1(i)-tr7(i)+tr2(i)-tr8(i))
475:           h2oems(i,k1) = emis(i,1) + emis(i,2) + emis(i,3) + emis(i,4)
476:           troco2(i,k1) = 0.65*tr7(i) + 0.35*tr8(i)
477:           th2o(i) = tr8(i)
478: !         trem2(i)     = troco2(i,k1)
479:         end do
480: !
481: !       CO2 emissivity for 15 micron band system
482: !
483:         do i = 1 , iym1
484:           t1i = dexp(-480./co2t(i,k1))
485:           sqti = dsqrt(co2t(i,k1))
486:           rsqti = 1./sqti
487:           et = t1i
488:           et2 = et*et
489:           et4 = et2*et2
490:           omet = 1. - 1.5*et2
491:           f1co2 = 899.70*omet*(1.+1.94774*et+4.73486*et2)*rsqti
492:           sqwp = dsqrt(plco2(i,k1))
493:           f1sqwp = f1co2*sqwp
494:           t1co2 = 1./(1.+245.18*omet*sqwp*rsqti)
495:           oneme = 1. - et2
496:           alphat = oneme**3*rsqti
497:           wco2 = 2.5221*co2vmr*pnm(i,k1)*rga
498:           u7 = 4.9411E4*alphat*et2*wco2
499:           u8 = 3.9744E4*alphat*et4*wco2
500:           u9 = 1.0447E5*alphat*et4*et2*wco2
501:           u13 = 2.8388E3*alphat*et4*wco2
502: !
503:           tpath = co2t(i,k1)
504:           tlocal = tplnke(i)
505:           tcrfac = dsqrt((tlocal*r250)*(tpath*r300))
506:           pi = pnm(i,k1)*rsslp + 2.*dpfco2*tcrfac
507:           posqt = pi/(2.*sqti)
508:           rbeta7 = 1./(5.3288*posqt)
509:           rbeta8 = 1./(10.6576*posqt)
510:           rbeta9 = rbeta7
511:           rbeta13 = rbeta9
512:           f2co2 = (u7/dsqrt(4.+u7*(1.+rbeta7)))                         &
513:                 & + (u8/dsqrt(4.+u8*(1.+rbeta8)))                       &
514:                 & + (u9/dsqrt(4.+u9*(1.+rbeta9)))
515:           f3co2 = u13/dsqrt(4.+u13*(1.+rbeta13))
516:           tmp1 = dlog(1.+f1sqwp)
517:           tmp2 = dlog(1.+f2co2)
518:           tmp3 = dlog(1.+f3co2)
519:           absbnd = (tmp1+2.*t1co2*tmp2+2.*tmp3)*sqti
520:           tco2(i) = 1.0/(1.0+10.0*(u7/dsqrt(4.+u7*(1.+rbeta7))))
521:           co2ems(i,k1) = troco2(i,k1)*absbnd*co2plk(i)
522:           ex = dexp(960./tint(i,k1))
523:           exm1sq = (ex-1.)**2
524:           co2em(i,k1) = 1.2E11*ex/(tint(i,k1)*tint4(i,k1)*exm1sq)
525: !         trem3(i) = 1. - bndfct*absbnd
526:         end do
527: !
528: !       O3 emissivity
529: !
530:         do i = 1 , iym1
531:           h2otr(i,k1) = dexp(-12.*s2c(i,k1))
532:           te = (co2t(i,k1)/293.)**.7
533:           u1 = 18.29*plos(i,k1)/te
534:           u2 = .5649*plos(i,k1)/te
535:           phat = plos(i,k1)/plol(i,k1)
536:           tlocal = tplnke(i)
537:           tcrfac = dsqrt(tlocal*r250)*te
538:           beta = (1./.3205D0)*((1./phat)+(dpfo3*tcrfac))
539:           realnu = (1./beta)*te
540:           o3bndi = 74.*te*(tplnke(i)/375.)                              &
541:                  & *dlog(1.+fo3(u1,realnu)+fo3(u2,realnu))
542:           o3ems(i,k1) = dbvtt(i)*h2otr(i,k1)*o3bndi
543:           to3(i) = 1.0/(1.+0.1*fo3(u1,realnu)+0.1*fo3(u2,realnu))
544: !         trem5(i)    = 1.-(o3bndi/(1060-980.))
545:         end do
546: !
547: !       Calculate trace gas emissivities
548: !
549:         call <a href="./trcems.f90.html#trcems" TARGET=CENT_PANEL>trcems</a>(k1,co2t,pnm,ucfc11,ucfc12,un2o0,un2o1,bn2o0,bn2o1,  &
550:                   & uch4,bch4,uco211,uco212,uco213,uco221,uco222,uco223,&
551:                   & uptype,w,s2c,u,emplnk,th2o,tco2,to3,emstrc)
552: !
553: !       Total emissivity:
554: !
555:         do i = 1 , iym1
556:           emstot(i,k1,jslc) = h2oems(i,k1) + co2ems(i,k1) + o3ems(i,k1) &
557:                             & + emstrc(i,k1)
558:         end do
559:       end do            ! End of interface loop
560: !
561:       end subroutine radems
</PRE>

<HR>

</BODY>
</HTML>
