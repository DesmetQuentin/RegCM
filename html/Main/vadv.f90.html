<HTML>

<HEAD>
<TITLE>vadv.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>vadv.f90</H1>
<HR>
<H2 ALIGN=CENTER>vadv.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=vadv><H3>vadv</H3></a></p> Click <a href="./callingtree/vadv_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where vadv is used.
<hr>
20:       subroutine vadv(ften,fa,j,ind)
21: 
22: !cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
23: !                                                                     c
24: !     this subroutine computes the vertical flux-divergence terms.    c
25: !                                                                     c
26: !     ften   : is the tendency of variable 'f'.                       c
27: !                                                                     c
28: !     fa     : is p*f.                                                c
29: !                                                                     c
30: !     qdot   : is the vertical sigma-velocity                         c
31: !                                                                     c
32: !     f      : is the working space used to store the interlated      c
33: !              values.                                                c
34: !                                                                     c
35: !     psa    : is p* used to interpolate the temperature.             c
36: !                                                                     c
37: !     j      : j'th slice of variable fa.                             c
38: !                                                                     c
39: !     ind = 1 : for t.                                                c
40: !           2 : for qv.                                               c
41: !           3 : for qc and qr.                                        c
42: !           4 : for u and v.                                          c
43: !                                                                     c
44: !cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
45:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
46:       use <a href="./mod_param3.f90.html#mod_param3" TARGET=CENT_PANEL>mod_param3</a> , only : dsigma , r8pt , qcon , twt , a , sigma
47:       use <a href="./mod_main.F90.html#mod_main" TARGET=CENT_PANEL>mod_main</a>
48:       use <a href="./mod_cvaria.F90.html#mod_cvaria" TARGET=CENT_PANEL>mod_cvaria</a>
49:       implicit none
50: !
51: ! Dummy arguments
52: !
53:       integer :: ind , j
54:       real(8) , dimension(iy,kz) :: fa , ften
55:       intent (in) fa , ind , j
56:       intent (inout) ften
57: !
58: ! Local variables
59: !
60:       real(8) :: f1 , f2
61:       real(8) , dimension(iy,kz) :: fg
62:       integer :: i , k
63: !
64: !----------------------------------------------------------------------
65: !
66:       if ( ind.eq.1 ) then
67: !
68: !-----vertical advection terms for:
69: !.....interpolate ta to full sigma levels:
70: !
71:         do i = 2 , iym2
72:           fg(i,1) = 0.
73:         end do
74:         do k = 2 , kz
75:           do i = 2 , iym2
76:             fg(i,k) = twt(k,1)*fa(i,k)                                  &
77:                     & *((psa(i,j)*sigma(k)+r8pt)/(psa(i,j)*a(k)+r8pt))  &
78:                     & **0.287 + twt(k,2)*fa(i,k-1)                      &
79:                     & *((psa(i,j)*sigma(k)+r8pt)/(psa(i,j)*a(k-1)+r8pt))&
80:                     & **0.287
81:           end do
82:         end do
83: !......k = 1
84:         do i = 2 , iym2
85:           ften(i,1) = ften(i,1) - qdot(i,2,j)*fg(i,2)/dsigma(1)
86:         end do
87: !......k = 2,kzm1
88:         do k = 2 , kzm1
89:           do i = 2 , iym2
90:             ften(i,k) = ften(i,k)                                       &
91:                       & - (qdot(i,k+1,j)*fg(i,k+1)-qdot(i,k,j)*fg(i,k)) &
92:                       & /dsigma(k)
93:           end do
94:         end do
95: !,.....k = kz
96:         do i = 2 , iym2
97:           ften(i,kz) = ften(i,kz) + qdot(i,kz,j)*fg(i,kz)/dsigma(kz)
98:         end do
99: !
100:       else if ( ind.eq.2 ) then
101: !
102: !-----vertical advection term for qv:
103: !.....interpolate qv to full sigma levels:
104: !
105:         do i = 2 , iym2
106:           fg(i,1) = 0.
107:         end do
108:         do k = 2 , kz
109:           do i = 2 , iym2
110: ! modif !!
111:             if ( fa(i,k).gt.1.E-15 .and. fa(i,k-1).gt.1.E-15 ) then
112:               fg(i,k) = fa(i,k)*(fa(i,k-1)/fa(i,k))**qcon(k)
113:             else
114:               fg(i,k) = 0.
115:             end if
116:           end do
117:         end do
118: !......k = 1
119:         do i = 2 , iym2
120:           ften(i,1) = ften(i,1) - qdot(i,2,j)*fg(i,2)/dsigma(1)
121:         end do
122: !......k = 2,kzm1
123:         do k = 2 , kzm1
124:           do i = 2 , iym2
125:             ften(i,k) = ften(i,k)                                       &
126:                       & - (qdot(i,k+1,j)*fg(i,k+1)-qdot(i,k,j)*fg(i,k)) &
127:                       & /dsigma(k)
128:           end do
129:         end do
130: !,.....k = kz
131:         do i = 2 , iym2
132:           ften(i,kz) = ften(i,kz) + qdot(i,kz,j)*fg(i,kz)/dsigma(kz)
133:         end do
134: !
135:       else if ( ind.eq.3 ) then
136: !
137: !-----vertical advection terms for qc and qr:
138: !
139: !......k = 1
140:         do i = 2 , iym2
141:           if ( qdot(i,2,j).ge.0. ) then
142:             f2 = fa(i,1)
143:           else
144:             f2 = fa(i,2)
145:           end if
146:           ften(i,1) = ften(i,1) - qdot(i,2,j)*f2/dsigma(1)
147:         end do
148: !......k = 2,kzm1
149:         do k = 2 , kzm1
150:           do i = 2 , iym2
151:             if ( qdot(i,k+1,j).ge.0. ) then
152:               f2 = fa(i,k)
153:             else
154:               f2 = fa(i,k+1)
155:             end if
156:             if ( qdot(i,k,j).ge.0. ) then
157:               f1 = fa(i,k-1)
158:             else
159:               f1 = fa(i,k)
160:             end if
161:             ften(i,k) = ften(i,k) - (qdot(i,k+1,j)*f2-qdot(i,k,j)*f1)   &
162:                       & /dsigma(k)
163:           end do
164:         end do
165: !......k = kz
166:         do i = 2 , iym2
167:           if ( qdot(i,kz,j).ge.0. ) then
168:             f1 = fa(i,kzm1)
169:           else
170:             f1 = fa(i,kz)
171:           end if
172:           ften(i,kz) = ften(i,kz) + qdot(i,kz,j)*f1/dsigma(kz)
173:         end do
174: !
175:       else if ( ind.eq.4 ) then
176: !
177: !-----vertical advection terms for u and v:
178: !.....interpolate ua or va to full sigma levels:
179: !
180:         do i = 2 , iym1
181:           fg(i,1) = 0.
182:         end do
183:         do k = 2 , kz
184:           do i = 2 , iym1
185:             fg(i,k) = 0.5*(fa(i,k)+fa(i,k-1))/msfd(i,j)
186:           end do
187:         end do
188: !......k = 1
189:         do i = 2 , iym1
190:           ften(i,1) = ften(i,1)                                         &
191:                     & - (qdot(i-1,2,j-1)+qdot(i,2,j-1)+qdot(i,2,j)      &
192:                     & +qdot(i-1,2,j))*fg(i,2)/(4.*dsigma(1))
193:         end do
194: !......k = 2,kzm1
195:         do k = 2 , kzm1
196:           do i = 2 , iym1
197:             ften(i,k) = ften(i,k)                                       &
198:                       & - ((qdot(i,k+1,j-1)+qdot(i-1,k+1,j-1)+qdot(i,   &
199:                       & k+1,j)+qdot(i-1,k+1,j))*fg(i,k+1)               &
200:                       & -(qdot(i,k,j-1)+qdot(i-1,k,j-1)+qdot(i,k,j)     &
201:                       & +qdot(i-1,k,j))*fg(i,k))/(4.*dsigma(k))
202:           end do
203:         end do
204: !......k = kz
205:         do i = 2 , iym1
206:           ften(i,kz) = ften(i,kz)                                       &
207:                      & + (qdot(i,kz,j-1)+qdot(i-1,kz,j-1)+qdot(i,kz,j)  &
208:                      & +qdot(i-1,kz,j))*fg(i,kz)/(4.*dsigma(kz))
209:         end do
210: !
211:  
212:  
213:       else if ( ind.eq.5 ) then
214:  
215:         do k = 2 , kz
216:           do i = 2 , iym2
217:             fg(i,k) = twt(k,1)*fa(i,k) + twt(k,2)*fa(i,k-1)
218:           end do
219:         end do
220:  
221: !......k = 1
222:         do i = 2 , iym2
223:           ften(i,1) = ften(i,1) - qdot(i,2,j)*fg(i,2)/dsigma(1)
224:         end do
225: !......k = 2,kzm1
226:         do k = 2 , kzm1
227:           do i = 2 , iym2
228:             ften(i,k) = ften(i,k)                                       &
229:                       & - (qdot(i,k+1,j)*fg(i,k+1)-qdot(i,k,j)*fg(i,k)) &
230:                       & /dsigma(k)
231:           end do
232:         end do
233: !,.....k = kz
234:         do i = 2 , iym2
235:           ften(i,kz) = ften(i,kz) + qdot(i,kz,j)*fg(i,kz)/dsigma(kz)
236:         end do
237:  
238:       else
239:       end if
240: !
241:       end subroutine vadv
</PRE>

<HR>

</BODY>
</HTML>
