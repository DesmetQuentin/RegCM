<HTML>

<HEAD>
<TITLE>mod_dust.F90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>mod_dust.F90</H1>
<HR>
<H2 ALIGN=CENTER>mod_dust.F90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19: 
<p><a name=mod_dust><H3>mod_dust</H3></a></p>20:       module mod_dust
21: 
22:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
23: 
24:       implicit none
25: !
26: ! PARAMETER definitions
27: !
28:       integer , parameter :: nsoil = 152
29:       integer , parameter :: nats = 12
30:       integer , parameter :: mode = 3
31:       integer , parameter :: jsoilm = 2 
32:       integer , parameter :: jfs =1 
33:       integer , parameter :: ust = 1
34: !
35:       real(8) , allocatable, dimension(:,:,:) :: clay2row2 , sand2row2 ,&
36:            & silt2row2
37:       real(8) ,allocatable,  dimension(:,:) :: clayrow2 , dustsotex ,   &
38:            & sandrow2
39:       real(8) ,allocatable,  dimension(:,:,:) :: srel2d
40:       real(8) , dimension(nsoil) :: dp
41: 
42:       contains 
43: 
<p><a name=allocate_mod_dust><H3>allocate_mod_dust</H3></a></p> Click <a href="./callingtree/allocate_mod_dust_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where allocate_mod_dust is used.
<hr>
44:         subroutine allocate_mod_dust 
45:         implicit none
46: #ifdef MPP1
47:         allocate(clay2row2(iy,nats,jxp))
48:         allocate(sand2row2(iy,nats,jxp))
49:         allocate(silt2row2(iy,nats,jxp))
50:         allocate(clayrow2(iy,jxp))
51:         allocate(dustsotex(iy,jxp))
52:         allocate(sandrow2(iy,jxp))
53:         allocate(srel2d(iy,jxp,nsoil))
54: #else        
55:         allocate(clay2row2(iy,nats,jx))
56:         allocate(sand2row2(iy,nats,jx))
57:         allocate(silt2row2(iy,nats,jx))
58:         allocate(clayrow2(iy,jx))
59:         allocate(dustsotex(iy,jx))
60:         allocate(sandrow2(iy,jx))
61:         allocate(srel2d(iy,jx,nsoil))
62: #endif 
63: 
64:         end subroutine allocate_mod_dust
65: 
<p><a name=inidust><H3>inidust</H3></a></p> Click <a href="./callingtree/inidust_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where inidust is used.
<hr>
66:       subroutine inidust
67:  
68: !  ***********************************************************
69: !  * description of 12- soil categories                  *****
70: !  *                                                     *****
71: !  * i         cat                     sizing            *****
72: !  * ------------------------------------------------    *****
73: !  * 1         sand                   coarse             *****
74: !  * 2         lomay sand             coarse             *****
75: !  * 3         sand lomay             coarse-medium      *****
76: !  * 4         silt loma              medium-fine        *****
77: !  * 5         silt                   medium             *****
78: !  * 6         loam                   fine               *****
79: !  * 7         sandy clay loam        coarse-medium-fine *****
80: !  * 8         silty clay loam        medium             *****
81: !  * 9         clay loam              medium-fine        *****
82: !  * 10        sandy clay             coarse-fine        *****
83: !  * 11        silty clay             medium-fine        *****
84: !  * 12        clay                   fine               *****
85: !  ***********************************************************
86:  
87:       use <a href="./mod_constants.F90.html#mod_constants" TARGET=CENT_PANEL>mod_constants</a> , only : twopi
88:       implicit none
89: !
90: ! Local variables
91: !
92:       real(8) , dimension(nats) :: bcly , bslt , bsnd
93:       real(8) :: deldp , eps , rhop , stotal , xk , xl , xm , xn
94:       integer :: i , itex , j , n , nm , ns , nt , t
95:       real(8) , dimension(3,12) :: mmd , pcent , sigma
96:       real(8) , dimension(iy,nsoil,nats) :: srel
97:       real(8) , dimension(nsoil) :: ss
98: !
99:       data bcly/0.00 , 0.10 , 0.10 , 0.15 , 0.15 , 0.15 , 0.20 , 0.20 , &
100:          & 0.30 , 0.35 , 0.40 , 0.50/
101:       data bsnd/0.90 , 0.60 , 0.60 , 0.50 , 0.45 , 0.35 , 0.30 , 0.30 , &
102:          & 0.20 , 0.65 , 0.60 , 0.50/
103:       data bslt/0.10 , 0.30 , 0.30 , 0.35 , 0.40 , 0.50 , 0.50 , 0.50 , &
104:          & 0.50 , 0.00 , 0.00 , 0.00/
105:  
106:       data rhop/2650.000/
107:       data eps/1.0E-7/
108:       data mmd/1000.0 , 100.0 , 10.0 , 690.0 , 100.0 , 10.0 , 520.0 ,   &
109:          & 100.0 , 5.0 , 520.0 , 100.0 , 5.0 , 520.0 , 75.0 , 2.5 ,     &
110:          & 520.0 , 75.0 , 2.5 , 210.0 , 75.0 , 2.5 , 210.0 , 50.0 ,     &
111:          & 2.5 , 125.0 , 50.0 , 1.0 , 100.0 , 10.0 , 1.0 , 100.0 ,      &
112:          & 10.0 , 0.5 , 100.0 , 10.0 , 0.5/
113:  
114:       data sigma/1.6 , 1.7 , 1.8 , 1.6 , 1.7 , 1.8 , 1.6 , 1.7 , 1.8 ,  &
115:          & 1.6 , 1.7 , 1.8 , 1.6 , 1.7 , 1.8 , 1.6 , 1.7 , 1.8 , 1.7 ,  &
116:          & 1.7 , 1.8 , 1.7 , 1.7 , 1.8 , 1.7 , 1.7 , 1.8 , 1.8 , 1.8 ,  &
117:          & 1.8 , 1.8 , 1.8 , 1.8 , 1.8 , 1.8 , 1.8/
118:  
119:       data pcent/0.90 , 0.10 , 0.00 , 0.60 , 0.30 , 0.10 , 0.60 , 0.30 ,&
120:          & 0.10 , 0.50 , 0.35 , 0.15 , 0.45 , 0.40 , 0.15 , 0.35 ,      &
121:          & 0.50 , 0.15 , 0.30 , 0.50 , 0.20 , 0.30 , 0.50 , 0.20 ,      &
122:          & 0.20 , 0.50 , 0.30 , 0.65 , 0.00 , 0.35 , 0.60 , 0.00 ,      &
123:          & 0.40 , 0.50 , 0.00 , 0.50/
124:  
125:       clay2row2 = 0.0
126:       sand2row2 = 0.0
127:       silt2row2 = 0.0
128:       srel2d    = 0.0
129: 
130: #ifdef MPP1
131:       do j = jbegin , jendm
132:         do i = 2 , iym2
133:           itex = nint(dustsotex(i,j))
134:           if ( itex.ge.1 .and. itex.le.nats ) then
135: !           remember for the moment one texture type per grid cell !
136:             clay2row2(i,itex,j) = bcly(itex)*100.0
137:             sand2row2(i,itex,j) = bsnd(itex)*100.0
138:             silt2row2(i,itex,j) = bslt(itex)*100.0
139:           end if
140:           do t = 1 , nats
141:             sandrow2(i,j) = sandrow2(i,j) + sand2row2(i,t,j)
142:             clayrow2(i,j) = clayrow2(i,j) + clay2row2(i,t,j)
143:           end do
144:         end do
145:       end do
146: #else
147:       do j = 2 , jxm2
148:         do i = 2 , iym2
149:           itex = nint(dustsotex(i,j))
150:           if ( itex.ge.1 .and. itex.le.nats ) then
151: !           remember for the moment one texture type per grid cell !
152:             clay2row2(i,itex,j) = bcly(itex)*100.0
153:             sand2row2(i,itex,j) = bsnd(itex)*100.0
154:             silt2row2(i,itex,j) = bslt(itex)*100.0
155:           end if
156:           do t = 1 , nats
157:             sandrow2(i,j) = sandrow2(i,j) + sand2row2(i,t,j)
158:             clayrow2(i,j) = clayrow2(i,j) + clay2row2(i,t,j)
159:           end do
160:         end do
161:       end do
162: #endif
163:  
164:       dp(1) = 0.0001  !cm
165:       do ns = 2 , nsoil
166:         dp(ns) = dp(ns-1)*exp(0.0460517018598807)
167:         deldp = dp(ns) - dp(ns-1)
168:       end do
169:  
170: #ifdef MPP1
171:       do j = jbegin , jendm
172:         do n = 1 , nats
173:           do ns = 1 , nsoil
174:             do i = 1 , iy
175:               srel(i,ns,n) = 0.
176:             end do
177:           end do
178:         end do
179:         do i = 2 , iym2
180:           if ( sandrow2(i,j).gt.0.0 .or. clayrow2(i,j).gt.0.0 ) then
181:             do nt = 1 , nats                  !soil types
182:               do ns = 1 , nsoil
183:                 ss(ns) = 0.0
184:               end do
185:               stotal = 0.0
186:               if ( sand2row2(i,nt,j).gt.0. ) then
187:                 do ns = 1 , nsoil          !soil size segregatoin no
188:                   do nm = 1 , mode       !soil mode = 3
189:                     if ( (pcent(nm,nt).gt.eps) .and.                    &
190:                        & (sigma(nm,nt).ne.0.0) ) then
191:                       xk = pcent(nm,nt)/(sqrt(twopi)*log(sigma(nm,nt)))
192:                       xl = ((log(dp(ns))-log(mmd(nm,nt)*1.E-4))**2)     &
193:                          & /(2.0*(log(sigma(nm,nt)))**2)
194:                       xm = xk*exp(-xl)
195:                     else
196:                       xm = 0.0
197:                     end if
198:                     xn = rhop*(2.0/3.0)*(dp(ns)/2.0)
199:                     deldp = 0.0460517018598807
200:                                               ! dp(2)-dp(1) ss(nsoil)
201:                     ss(ns) = ss(ns) + (xm*deldp/xn)
202:                   end do
203:                   stotal = stotal + ss(ns)
204:                 end do
205:                 do ns = 1 , nsoil
206:                   if ( stotal.gt.0.0 ) srel(i,ns,nt) = ss(ns)/stotal
207:                                                 !srel(iy,nsoil,nats)
208:                 end do
209:               end if
210:             end do                    ! soil types
211:           end if
212:         end do
213:         do i = 2 , iym2
214:           itex = nint(dustsotex(i,j))
215:           if ( itex.ge.1 .and. itex.le.nats ) then
216:             do ns = 1 , nsoil
217:               srel2d(i,j,ns) = srel(i,ns,itex)
218:             end do
219:           end if
220:         end do
221:       end do
222: #else 
223:       do j = 2 , jxm2
224:         do n = 1 , nats
225:           do ns = 1 , nsoil
226:             do i = 1 , iy
227:               srel(i,ns,n) = 0.
228:             end do
229:           end do
230:         end do
231:         do i = 2 , iym2
232:           if ( sandrow2(i,j).gt.0.0 .or. clayrow2(i,j).gt.0.0 ) then
233:             do nt = 1 , nats                  !soil types
234:               do ns = 1 , nsoil
235:                 ss(ns) = 0.0
236:               end do
237:               stotal = 0.0
238:               if ( sand2row2(i,nt,j).gt.0. ) then
239:                 do ns = 1 , nsoil          !soil size segregatoin no
240:                   do nm = 1 , mode       !soil mode = 3
241:                     if ( (pcent(nm,nt).gt.eps) .and.                    &
242:                        & (sigma(nm,nt).ne.0.0) ) then
243:                       xk = pcent(nm,nt)/(sqrt(twopi)*log(sigma(nm,nt)))
244:                       xl = ((log(dp(ns))-log(mmd(nm,nt)*1.E-4))**2)     &
245:                          & /(2.0*(log(sigma(nm,nt)))**2)
246:                       xm = xk*exp(-xl)
247:                     else
248:                       xm = 0.0
249:                     end if
250:                     xn = rhop*(2.0/3.0)*(dp(ns)/2.0)
251:                     deldp = 0.0460517018598807
252:                                               ! dp(2)-dp(1) ss(nsoil)
253:                     ss(ns) = ss(ns) + (xm*deldp/xn)
254:                   end do
255:                   stotal = stotal + ss(ns)
256:                 end do
257:                 do ns = 1 , nsoil
258:                   if ( stotal.gt.0.0 ) srel(i,ns,nt) = ss(ns)/stotal
259:                                                 !srel(iy,nsoil,nats)
260:                 end do
261:               end if
262:             end do                    ! soil types
263:           end if
264:         end do
265:         do i = 2 , iym2
266:           itex = nint(dustsotex(i,j))
267:           if ( itex.ge.1 .and. itex.le.nats ) then
268:             do ns = 1 , nsoil
269:               srel2d(i,j,ns) = srel(i,ns,itex)
270:             end do
271:           end if
272:         end do
273:       end do
274: #endif
275:       print *, 'MAXVAL srel2d    : ' , maxval(srel2d)
276:       print *, 'MAXVAL dustsotex : ' , maxval(dustsotex)
277: 
278:       end subroutine inidust
279: 
280:       end module mod_dust
</PRE>

<HR>

</BODY>
</HTML>
