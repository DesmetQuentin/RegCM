<HTML>

<HEAD>
<TITLE>trcabn.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>trcabn.f90</H1>
<HR>
<H2 ALIGN=CENTER>trcabn.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=trcabn><H3>trcabn</H3></a></p> Click <a href="./callingtree/trcabn_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where trcabn is used.
<hr>
20:       subroutine trcabn(k2,kn,ucfc11,ucfc12,un2o0,un2o1,uch4,uco211,    &
21:                       & uco212,uco213,uco221,uco222,uco223,tbar,bplnk,  &
22:                       & winpl,pinpl,tco2,th2o,to3,uptype,dw,s2c,up2,    &
23:                       & pnew,abstrc,uinpl)
24: !
25:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
26:       use <a href="./mod_constants.F90.html#mod_constants" TARGET=CENT_PANEL>mod_constants</a> , only : sslp
27:       implicit none
28: !
29: !----------------------------------------------------------------------
30: ! Calculate nearest layer absorptivity due to CH4, N2O, CFC11 and CFC12
31: !
32: !         Coded by J.T. Kiehl November 21, 1994
33: !-----------------------------------------------------------------------
34: !
35: !------------------------------Arguments--------------------------------
36: !
37: ! tbar   - pressure weighted temperature
38: ! ucfc11 - CFC11 path length
39: ! ucfc12 - CFC12 path length
40: ! un2o0  - N2O path length
41: ! un2o1  - N2O path length (hot band)
42: ! uch4   - CH4 path length
43: ! uco211 - CO2 9.4 micron band path length
44: ! uco212 - CO2 9.4 micron band path length
45: ! uco213 - CO2 9.4 micron band path length
46: ! uco221 - CO2 10.4 micron band path length
47: ! uco222 - CO2 10.4 micron band path length
48: ! uco223 - CO2 10.4 micron band path length
49: ! bplnk  - weighted Planck function for absorptivity
50: ! winpl  - fractional path length
51: ! pinpl  - pressure factor for subdivided layer
52: ! tco2   - co2 transmission
53: ! th2o   - h2o transmission
54: ! to3    - o3 transmission
55: ! dw     - h2o path length
56: ! pnew   - pressure factor
57: ! s2c    - h2o continuum factor
58: ! uptype - p-type path length
59: ! up2    - p squared path length
60: ! uinpl  - Nearest layer subdivision factor
61: !
62: !------------------------------Output Arguments-------------------------
63: !
64: ! abstrc - total trace gas absorptivity
65: !
66: !-----------------------------------------------------------------------
67: !
68: ! Dummy arguments
69: !
70:       integer :: k2 , kn
71:       real(8) , dimension(iym1) :: abstrc , dw , pnew , tco2 , th2o ,  &
72:                                   & to3 , up2
73:       real(8) , dimension(14,iym1,4) :: bplnk
74:       real(8) , dimension(iym1,4) :: pinpl , tbar , uinpl , winpl
75:       real(8) , dimension(iym1,kzp1) :: s2c , ucfc11 , ucfc12 , uch4 ,&
76:            & uco211 , uco212 , uco213 , uco221 , uco222 , uco223 ,      &
77:            & un2o0 , un2o1 , uptype
78:       intent (in) bplnk , dw , k2 , kn , pinpl , pnew , s2c , tbar ,    &
79:                 & tco2 , th2o , to3 , ucfc11 , ucfc12 , uch4 , uco211 , &
80:                 & uco212 , uco213 , uco221 , uco222 , uco223 , uinpl ,  &
81:                 & un2o0 , un2o1 , up2 , uptype , winpl
82:       intent (out) abstrc
83: !
84: ! Local variables
85: !
86: ! sqti    - square root of mean temp
87: ! rsqti   - reciprocal of sqti
88: ! du1     - cfc11 path length
89: ! du2     - cfc12 path length
90: ! acfc1   - absorptivity of cfc11 798 cm-1 band
91: ! acfc2   - absorptivity of cfc11 846 cm-1 band
92: ! acfc3   - absorptivity of cfc11 933 cm-1 band
93: ! acfc4   - absorptivity of cfc11 1085 cm-1 band
94: ! acfc5   - absorptivity of cfc11 889 cm-1 band
95: ! acfc6   - absorptivity of cfc11 923 cm-1 band
96: ! acfc7   - absorptivity of cfc11 1102 cm-1 band
97: ! acfc8   - absorptivity of cfc11 1161 cm-1 band
98: ! du01    - n2o path length
99: ! dbeta01 - n2o pressure factors
100: ! dbeta11 -        "
101: ! an2o1   - absorptivity of the 1285 cm-1 n2o band
102: ! du02    - n2o path length
103: ! dbeta02 - n2o pressure factor
104: ! an2o2   - absorptivity of the 589 cm-1 n2o band
105: ! du03    - n2o path length
106: ! dbeta03 - n2o pressure factor
107: ! an2o3   - absorptivity of the 1168 cm-1 n2o band
108: ! duch4   - ch4 path length
109: ! dbetac  - ch4 pressure factor
110: ! ach4    - absorptivity of the 1306 cm-1 ch4 band
111: ! du11    - co2 path length
112: ! du12    -       "
113: ! du13    -       "
114: ! dbetc1 -  co2 pressure factor
115: ! dbetc2 -  co2 pressure factor
116: ! aco21  -  absorptivity of the 1064 cm-1 co2 band
117: ! du21   -  co2 path length
118: ! du22   -        "
119: ! du23   -        "
120: ! aco22  -  absorptivity of the 961 cm-1 co2 band
121: ! tt     -  temp. factor for h2o overlap
122: ! psi1   -           "
123: ! phi1   -           "
124: ! p1     -  factor for h2o overlap
125: ! w1     -           "
126: ! ds2c   -  continuum path length
127: ! duptyp -  p-type path length
128: ! tw     -  h2o transmission overlap
129: ! g1     -  h2o overlap factor
130: ! g2     -          "
131: ! g3     -          "
132: ! g4     -          "
133: ! ab     -  h2o temp. factor
134: ! bb     -          "
135: ! abp    -          "
136: ! bbp    -          "
137: ! tcfc3  -  transmission of cfc11 band
138: ! tcfc4  -  transmission of cfc11 band
139: ! tcfc6  -  transmission of cfc12 band
140: ! tcfc7  -          "
141: ! tcfc8  -          "
142: ! tlw    -  h2o transmission
143: ! tch4   -  ch4 transmission
144: !
145:       real(8) , dimension(6) :: ab , abp , bb , bbp , g1 , g2 , g3 , g4
146:       real(8) :: acfc1 , acfc2 , acfc3 , acfc4 , acfc5 , acfc6 , acfc7 ,&
147:                & acfc8 , ach4 , aco21 , aco22 , an2o1 , an2o2 , an2o3 , &
148:                & b , dbeta01 , dbeta02 , dbeta03 , dbeta11 , dbetac ,   &
149:                & dbetc1 , dbetc2 , du01 , du02 , du03 , du1 , du11 ,    &
150:                & du12 , du13 , du2 , du21 , du22 , du23 , duch4 , p1 ,  &
151:                & phi1 , psi1 , tcfc3 , tcfc4 , tcfc6 , tcfc7 , tcfc8 ,  &
152:                & tch4 , tlw , u , w1
153:       real(8) , dimension(iym1) :: ds2c , duptyp , rsqti , sqti , tt
154:       real(8) :: func
155:       integer :: i , l
156:       real(8) , dimension(iym1,6) :: tw
157:       data g1/0.0468556 , 0.0397454 , 0.0407664 , 0.0304380 ,           &
158:          & 0.0540398 , 0.0321962/
159:       data g2/14.4832 , 4.30242 , 5.23523 , 3.25342 , 0.698935 ,        &
160:          & 16.5599/
161:       data g3/26.1898 , 18.4476 , 15.3633 , 12.1927 , 9.14992 , 8.07092/
162:       data g4/0.0261782 , 0.0369516 , 0.0307266 , 0.0243854 ,           &
163:          & 0.0182932 , 0.0161418/
164:       data ab/3.0857E-2 , 2.3524E-2 , 1.7310E-2 , 2.6661E-2 ,           &
165:          & 2.8074E-2 , 2.2915E-2/
166:       data bb/ - 1.3512E-4 , -6.8320E-5 , -3.2609E-5 , -1.0228E-5 ,     &
167:          & -9.5743E-5 , -1.0304E-4/
168:       data abp/2.9129E-2 , 2.4101E-2 , 1.9821E-2 , 2.6904E-2 ,          &
169:          & 2.9458E-2 , 1.9892E-2/
170:       data bbp/ - 1.3139E-4 , -5.5688E-5 , -4.6380E-5 , -8.0362E-5 ,    &
171:          & -1.0115E-4 , -8.8061E-5/
172: !------------------------------------------------------------------
173:       func(u,b) = u/dsqrt(4.0+u*(1.0+1.0/b))
174: !
175:       do i = 1 , iym1
176:         sqti(i) = dsqrt(tbar(i,kn))
177:         rsqti(i) = 1./sqti(i)
178: !       h2o transmission
179:         tt(i) = dabs(tbar(i,kn)-250.0)
180:         ds2c(i) = dabs(s2c(i,k2+1)-s2c(i,k2))*uinpl(i,kn)
181:         duptyp(i) = dabs(uptype(i,k2+1)-uptype(i,k2))*uinpl(i,kn)
182:       end do
183: !
184:       do l = 1 , 6
185:         do i = 1 , iym1
186:           psi1 = dexp(abp(l)*tt(i)+bbp(l)*tt(i)*tt(i))
187:           phi1 = dexp(ab(l)*tt(i)+bb(l)*tt(i)*tt(i))
188:           p1 = pnew(i)*(psi1/phi1)/sslp
189:           w1 = dw(i)*winpl(i,kn)*phi1
190:           tw(i,l) = dexp(-g1(l)*p1*(dsqrt(1.0+g2(l)*(w1/p1))-1.0)-g3(l) &
191:                   & *ds2c(i)-g4(l)*duptyp(i))
192:         end do
193:       end do
194: !
195:       do i = 1 , iym1
196: !
197:         du1 = dabs(ucfc11(i,k2+1)-ucfc11(i,k2))*winpl(i,kn)
198:         du2 = dabs(ucfc12(i,k2+1)-ucfc12(i,k2))*winpl(i,kn)
199: !       cfc transmissions
200:         tcfc3 = dexp(-175.005*du1)
201:         tcfc4 = dexp(-1202.18*du1)
202:         tcfc6 = dexp(-5786.73*du2)
203:         tcfc7 = dexp(-2873.51*du2)
204:         tcfc8 = dexp(-2085.59*du2)
205: !       Absorptivity for CFC11 bands
206:         acfc1 = 50.0*(1.0-dexp(-54.09*du1))*tw(i,1)*bplnk(7,i,kn)
207:         acfc2 = 60.0*(1.0-dexp(-5130.03*du1))*tw(i,2)*bplnk(8,i,kn)
208:         acfc3 = 60.0*(1.0-tcfc3)*tw(i,4)*tcfc6*bplnk(9,i,kn)
209:         acfc4 = 100.0*(1.0-tcfc4)*tw(i,5)*bplnk(10,i,kn)
210: !       Absorptivity for CFC12 bands
211:         acfc5 = 45.0*(1.0-dexp(-1272.35*du2))*tw(i,3)*bplnk(11,i,kn)
212:         acfc6 = 50.0*(1.0-tcfc6)*tw(i,4)*bplnk(12,i,kn)
213:         acfc7 = 80.0*(1.0-tcfc7)*tw(i,5)*tcfc4*bplnk(13,i,kn)
214:         acfc8 = 70.0*(1.0-tcfc8)*tw(i,6)*bplnk(14,i,kn)
215: !       Emissivity for CH4 band 1306 cm-1
216:         tlw = dexp(-1.0*dsqrt(up2(i)))
217:         duch4 = dabs(uch4(i,k2+1)-uch4(i,k2))*winpl(i,kn)
218:         dbetac = 2.94449*pinpl(i,kn)*rsqti(i)/sslp
219:         ach4 = 6.00444*sqti(i)*dlog(1.0+func(duch4,dbetac))             &
220:              & *tlw*bplnk(3,i,kn)
221:         tch4 = 1.0/(1.0+0.02*func(duch4,dbetac))
222: !       Absorptivity for N2O bands
223:         du01 = dabs(un2o0(i,k2+1)-un2o0(i,k2))*winpl(i,kn)
224:         du11 = dabs(un2o1(i,k2+1)-un2o1(i,k2))*winpl(i,kn)
225:         dbeta01 = 19.399*pinpl(i,kn)*rsqti(i)/sslp
226:         dbeta11 = dbeta01
227: !       1285 cm-1 band
228:         an2o1 = 2.35558*sqti(i)                                         &
229:               & *dlog(1.0+func(du01,dbeta01)+func(du11,dbeta11))        &
230:               & *tlw*tch4*bplnk(4,i,kn)
231:         du02 = 0.100090*du01
232:         du12 = 0.0992746*du11
233:         dbeta02 = 0.964282*dbeta01
234: !       589 cm-1 band
235:         an2o2 = 2.65581*sqti(i)                                         &
236:               & *dlog(1.0+func(du02,dbeta02)+func(du12,dbeta02))*tco2(i)&
237:               & *th2o(i)*bplnk(5,i,kn)
238:         du03 = 0.0333767*du01
239:         dbeta03 = 0.982143*dbeta01
240: !       1168 cm-1 band
241:         an2o3 = 2.54034*sqti(i)*dlog(1.0+func(du03,dbeta03))*tw(i,6)    &
242:               & *tcfc8*bplnk(6,i,kn)
243: !       Emissivity for 1064 cm-1 band of CO2
244:         du11 = dabs(uco211(i,k2+1)-uco211(i,k2))*winpl(i,kn)
245:         du12 = dabs(uco212(i,k2+1)-uco212(i,k2))*winpl(i,kn)
246:         du13 = dabs(uco213(i,k2+1)-uco213(i,k2))*winpl(i,kn)
247:         dbetc1 = 2.97558*pinpl(i,kn)*rsqti(i)/sslp
248:         dbetc2 = 2.0*dbetc1
249:         aco21 = 3.7571*sqti(i)                                          &
250:               & *dlog(1.0+func(du11,dbetc1)+func(du12,dbetc2)           &
251:               & +func(du13,dbetc2))*to3(i)*tw(i,5)                      &
252:               & *tcfc4*tcfc7*bplnk(2,i,kn)
253: !       Emissivity for 961 cm-1 band of co2
254:         du21 = dabs(uco221(i,k2+1)-uco221(i,k2))*winpl(i,kn)
255:         du22 = dabs(uco222(i,k2+1)-uco222(i,k2))*winpl(i,kn)
256:         du23 = dabs(uco223(i,k2+1)-uco223(i,k2))*winpl(i,kn)
257:         aco22 = 3.8443*sqti(i)                                          &
258:               & *dlog(1.0+func(du21,dbetc1)+func(du22,dbetc1)           &
259:               & +func(du23,dbetc2))*tw(i,4)*tcfc3*tcfc6*bplnk(1,i,kn)
260: !       total trace gas absorptivity
261:         abstrc(i) = acfc1 + acfc2 + acfc3 + acfc4 + acfc5 + acfc6 +     &
262:                   & acfc7 + acfc8 + an2o1 + an2o2 + an2o3 + ach4 +      &
263:                   & aco21 + aco22
264:       end do
265:       end subroutine trcabn
</PRE>

<HR>

</BODY>
</HTML>
