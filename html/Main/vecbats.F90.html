<HTML>

<HEAD>
<TITLE>vecbats.F90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>vecbats.F90</H1>
<HR>
<H2 ALIGN=CENTER>vecbats.F90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=vecbats><H3>vecbats</H3></a></p> Click <a href="./callingtree/vecbats_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where vecbats is used.
<hr>
20:       subroutine vecbats(j,k,istart,iend,ng)
21: 
22: !=======================================================================
23: !l  based on: bats version 1e          copyright 18 august 1989
24: !=======================================================================
25: !      written by robert e. dickinson and patrick j. kennedy with
26: ! contributions from klaus bluemel, filippo giorgi, and ann henderson-
27: ! sellers.  version 1b (1 dec 1988) greatly modifies versions 1 and 1a,
28: ! for example:  general cleanup and stabilization of iterations;
29: ! three-layer soil moisture; improvement and bug fixes by bluemel
30: ! including an improved canopy model; improvement in soil temperature
31: ! force-restore method for overlying snow; stomatal resistance
32: ! dependence on solar radiation made dependent on lai; inclusion of a
33: ! non-zero displacement level; elimination of soil water movement
34: ! in frozen ground; fixing of the carbon routine;
35: ! and derivation of leaf iteration scheme.
36: !
37: !      version 1c (1 march 1989) modifies version 1b by:
38: ! adding a dependence of stomatal resistance on vapor pressure deficit,
39: ! allowing for solar zenith dependence of incident light in
40: ! calculating dependence of stomatal resistance on light;
41: ! further streamlining the iterative calculation of leaf temperature;
42: ! and fixing a bug in the soil moisture calculation of bats1b.
43: !
44: !      version 1d (1 june 1989) fixes two bugs introduced into 1c,
45: ! in subroutines lftemp and tgrund, and includes minor changes
46: ! suggested by k. bluemel.  it redefines output fluxes of sensible and
47: ! latent heat to agree exactly with those used for soil energy balance
48: ! to ensure conservation of energy.  some other cleanup is done also.
49: !
50: !      verson 1e (18 august 1989) makes changes consistent with 1d to
51: ! insure water conservation.  latent heat of sublimation now applies
52: ! to all soil terms where snow-covered or below freezing.  two minor
53: ! bugs from misplaced lines of code are fixed.  leaf temperature
54: ! calculation reformulated to use average longwave rather than over
55: ! bare soil as done previously, to better match ccm1 tie-in.
56: !
57: !      vector bats (1989) was developed from bats1e by gary bates.
58: ! it is designed such that one call to bats perfoms calculations at
59: ! a specified arbitrary number of gridpoints instead of just one point
60: ! as in the standard version of bats1e.  this allows a more efficient
61: ! vectorization of the code.  vector bats was coupled to the mm4
62: ! in februrary 1992 by gary bates.
63: !
64: !
65: !                  main drive program
66: !
67: ! the core model begins with subroutine bndry, which is driven by
68: ! this routine.
69: !
70: ! *********************************************************************
71: !
72: !
73: !                      * ts (lowest model layer "midpt" at 75m)
74: !
75: !
76: !                         i-----------i
77: !                         i         ======= taf (temp air in leaves)
78: !                         i     tlef  i
79: !                         i-----------i
80: !                              i  i
81: !          ta (anemom)         i  i
82: !          is actually a ss    i  i
83: !             i   i temp (4')  i  i
84: !  -----------i---i------------i--i------------------------------------
85: !                                                  tg
86: ! -------------------------------------------------------------------
87: !                                                    tgb
88: ! ********************************************************************
89: !  **  type1-crop
90: !  **  type2-short grass                  ****************************
91: !  **  type3-evergreen needle leaf tree   * soils parameters are a fn of
92: !  **  type4-deciduous ""  """ "" "" "    * soil colour -- from 1(light)
93: !  **  type5- "" """"  broadleaf tree     *                  to 8(dark)
94: !  **  type6- evergreen   """  """"       * soil texture -- from 1(sand)
95: !  **  type7-tall grass                   *     thru 6(loam) to 12(clay)
96: !  **  type8-desert                       *
97: !  **  type9-tundra                       * soil drainage - 7(free),
98: !  **  type10-irrig crop                  *      8(poor), 9(impeded)
99: !  **  type11-semi-desert                 *
100: !  **  type12-ice                         *  (drainage to be used yet)
101: !  **  type13-bog or marsh                *
102: !  **  type14-(inland water)              *
103: !  **  type15-(sea)                       *****************************
104: !  **  type16-evgr shrub
105: !  **  type17-decid shrub
106: !  **  type18-mixed tree
107: !
108: !
109: !
110: !  flow from this driver and order of subroutines is:
111: !
112: !   bconst
113: !   initb
114: !  bmarch   ==> soilbc
115: !    outb       albedo
116: !               zenith
117: !                bndry   ==>   drag  ==> dragdn  ==> depth
118: !               bufout        satur
119: !                            vcover
120: !                              drip
121: !                            lftemp   =====================> stomat
122: !                              drip                          frawat
123: !                               co2 ===> carbon             frawat
124: !                            tseice                           root
125: !                            tgrund                          satur
126: !                              snow                         lfdrag
127: !                             water                         condch
128: !                                                           condcq
129: !                                                            deriv
130: !
131: !=======================================================================
132: !  si version  - water fluxes are generally calculated in kg/m**2/s.
133: !  1000 kg/m**2/s = 1 m/s  - converted to energy units for display:
134: !                            1 kg/m**2/s = 2.5 x 10.e6  watts/m**2.
135: !  note also  1 kg/m**2/s = 1 mm/m**2/s so fluxes can be thought of
136: !                            in mm/s.
137: !=======================================================================
138:  
139:       use <a href="./mod_bats.F90.html#mod_bats" TARGET=CENT_PANEL>mod_bats</a> , only : interf
140:       use <a href="./mod_param1.f90.html#mod_param1" TARGET=CENT_PANEL>mod_param1</a> , only : klake
141:       use <a href="./mod_param2.F90.html#mod_param2" TARGET=CENT_PANEL>mod_param2</a> , only : iemiss , lakemod
142:       use <a href="./mod_date.F90.html#mod_date" TARGET=CENT_PANEL>mod_date</a> , only : jyear , jyear0 , ktau
143:       use <a href="./mod_lake.f90.html#mod_lake" TARGET=CENT_PANEL>mod_lake</a> , only : lakedrv
144:       implicit none
145: !
146: ! Dummy arguments
147: !
148:       integer, intent(in) :: j , k , istart , iend , ng
149: 
150: !---------------------------------------------------------------------
151: 
152:       call <a href="./mod_bats.F90.html#interf" TARGET=CENT_PANEL>interf</a>(1 , j , k , istart , iend , ng)
153: ! 
154: ! ****** calculate surface fluxes and hydrology budgets
155: !
156:       call <a href="./soilbc.f90.html#soilbc" TARGET=CENT_PANEL>soilbc</a>
157:       call <a href="./bndry.f90.html#bndry" TARGET=CENT_PANEL>bndry</a>(iemiss)
158:  
159: !
160: ! ****************************************************************
161: !
162: !     call hostetler lake model hourly at lake points
163: !
164:       if ( lakemod.eq.1 ) then
165:         if ( (jyear.eq.jyear0 .and. ktau.eq.0) .or.                     &
166:            &  mod(ktau+1,klake).eq.0 ) call <a href="./mod_lake.f90.html#lakedrv" TARGET=CENT_PANEL>lakedrv</a>(j)
167:       end if
168: ! 
169: ! ****************************************************************
170: ! 
171:       end subroutine vecbats
</PRE>

<HR>

</BODY>
</HTML>
