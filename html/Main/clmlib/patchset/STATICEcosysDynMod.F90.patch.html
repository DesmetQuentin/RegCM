<HTML>

<HEAD>
<TITLE>STATICEcosysDynMod.F90.patch</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>clmlib/patchset/STATICEcosysDynMod.F90.patch</H1>
<HR>
<H2 ALIGN=CENTER>STATICEcosysDynMod.F90.patch</H2>
<HR>
</FONT>

<HR>

<PRE>
<OL>
<LI>--- orig/STATICEcosysDynMod.F90	2010-03-10 16:34:21.000000000 +0100
<LI>+++ patchd/STATICEcosysDynMod.F90	2010-03-10 16:19:07.000000000 +0100
<LI>@@ -245,7 +245,7 @@
<LI> ! Determine if 2 new months of data are to be read.
<LI> !
<LI> ! !USES:
<LI>-    use clm_varctl  , only : fsurdat
<LI>+    use clm_varctl  , only : fsurdat,mksrf_flai
<LI>     use clm_time_manager, only : get_curr_date, get_step_size, get_perp_date, is_perpetual
<LI> !
<LI> ! !ARGUMENTS:
<LI>@@ -288,7 +288,8 @@
<LI>     timwt(2) = 1._r8-timwt(1)
<LI> 
<LI>     if (InterpMonths1 /= months(1)) then
<LI>-       call readMonthlyVegetation (fsurdat, kmo, kda, months)
<LI>+!   abt    call readMonthlyVegetation (fsurdat, kmo, kda, months)
<LI>+       call readMonthlyVegetation (mksrf_flai, kmo, kda, months)
<LI>        InterpMonths1 = months(1)
<LI>     end if
<LI> 
<LI>@@ -314,6 +315,9 @@
<LI>     use spmdMod     , only : masterproc, mpicom, MPI_REAL8
<LI>     use clm_time_manager, only : get_nstep
<LI>     use ncdio       , only : check_ret
<LI>+!abt added below
<LI>+!    use clm_varsur  , only : monlai
<LI>+!abt added above
<LI> !
<LI> ! !ARGUMENTS:
<LI>     implicit none
<LI>@@ -363,7 +367,9 @@
<LI>              msai(begg:endg,0:numpft), &
<LI>              mhgtt(begg:endg,0:numpft), &
<LI>              mhgtb(begg:endg,0:numpft), stat=ier)
<LI>-
<LI>+!abt added below
<LI>+!    allocate(monlai(begp:endp,2))
<LI>+!abt above
<LI>     if (ier /= 0) then
<LI>        write(6,*)subname, 'allocation big error '; call endrun()
<LI>     end if
<LI>@@ -383,7 +389,8 @@
<LI>           call getfil(fveg, locfn, 0)
<LI>           call check_ret(nf_open(locfn, 0, ncid), subname)
<LI> 
<LI>-          call check_ret(nf_inq_dimid (ncid, 'lsmlon', dimid), subname)
<LI>+!   abt       call check_ret(nf_inq_dimid (ncid, 'lsmlon', dimid), subname)
<LI>+          call check_ret(nf_inq_dimid (ncid, 'lon', dimid), subname)
<LI>           call check_ret(nf_inq_dimlen(ncid, dimid, nlon_i), subname)
<LI>           if (.not.single_column) then
<LI>              if (nlon_i /= lsmlon) then
<LI>@@ -391,7 +398,8 @@
<LI>                 call endrun()
<LI>              end if
<LI>           endif
<LI>-          call check_ret(nf_inq_dimid(ncid, 'lsmlat', dimid), subname)
<LI>+!   abt       call check_ret(nf_inq_dimid(ncid, 'lsmlat', dimid), subname)
<LI>+          call check_ret(nf_inq_dimid(ncid, 'lat', dimid), subname)
<LI>           call check_ret(nf_inq_dimlen(ncid, dimid, nlat_i), subname)
<LI> 
<LI>           if (.not.single_column ) then
<LI>@@ -400,7 +408,8 @@
<LI>                 call endrun()
<LI>              end if
<LI>           endif
<LI>-          call check_ret(nf_inq_dimid(ncid, 'lsmpft', dimid), subname)
<LI>+!    abt    call check_ret(nf_inq_dimid(ncid, 'lsmpft', dimid), subname)
<LI>+          call check_ret(nf_inq_dimid(ncid, 'level', dimid), subname)
<LI>           call check_ret(nf_inq_dimlen(ncid, dimid, npft_i), subname)
<LI> 
<LI>           if (.not. single_column ) then
<LI>@@ -521,10 +530,17 @@
<LI>              mhvb2t(p,k) = 0._r8
<LI>           end if
<LI> 
<LI>+
<LI>+!abt added new variable for use in VOCemissionMod
<LI>+#if (defined VOC)
<LI>+          clm3%g%l%c%p%pva%monlai(p,k) = mlai2t(p,k)
<LI>+#endif
<LI>+
<LI>        end do   ! end of loop over pfts
<LI> 
<LI>     end do   ! end of loop over months
<LI> 
<LI>+
<LI>     deallocate(mlai, msai, mhgtt, mhgtb)
<LI>   end subroutine readMonthlyVegetation
<LI> 
</OL>
</PRE>

<HR>

</BODY>
</HTML>
