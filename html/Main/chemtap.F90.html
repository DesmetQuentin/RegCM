<HTML>

<HEAD>
<TITLE>chemtap.F90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>chemtap.F90</H1>
<HR>
<H2 ALIGN=CENTER>chemtap.F90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=chemtap><H3>chemtap</H3></a></p> Click <a href="./callingtree/chemtap_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where chemtap is used.
<hr>
20:       subroutine chemtap
21: 
22: !cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
23: !                                                                     c
24: !     this subroutine writes the model chem                           c
25: !                                                                     c
26: !     iutl : is the output unit number for large-domain variables.    c
27: !                                                                     c
28: !cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
29: 
30:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
31:       use <a href="./mod_param2.F90.html#mod_param2" TARGET=CENT_PANEL>mod_param2</a>
32:       use <a href="./mod_iunits.f90.html#mod_iunits" TARGET=CENT_PANEL>mod_iunits</a>
33:       use <a href="./mod_date.F90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
34:       use <a href="./mod_main.F90.html#mod_main" TARGET=CENT_PANEL>mod_main</a>
35:       use <a href="./mod_mainchem.F90.html#mod_mainchem" TARGET=CENT_PANEL>mod_mainchem</a>
36:       use <a href="./mod_trachem.F90.html#mod_trachem" TARGET=CENT_PANEL>mod_trachem</a>
37: #ifdef MPP1
38:       use <a href="./mod_mppio.F90.html#mod_mppio" TARGET=CENT_PANEL>mod_mppio</a>
39: #endif
40:       implicit none
41: !
42: ! Local variables
43: !
44:       integer :: i , itr , j , k
45:       real(8) :: mpd
46: 
47:       if ( iotyp.eq.2 ) write (iutchem) idatex
48:  
49: !     3 d fields
50:  
51:       do itr = 1 , ntr
52:         do k = kz , 1 , -1
53:           do i = 1 , iym2
54:             do j = 1 , jxm2
55: #ifdef MPP1
56:               fchem(j,i) = chia_io(i+1,k,j+1,itr)/psa_io(i+1,j+1)
57: #else
58:               fchem(j,i) = chia(i+1,k,j+1,itr)/psa(i+1,j+1)
59: #endif
60:             end do
61:           end do
62:           if ( iotyp.eq.1 ) then
63:             nrcchem = nrcchem + 1
64:             write (iutchem,rec=nrcchem) fchem
65:           else if ( iotyp.eq.2 ) then
66:             write (iutchem) fchem
67:           else
68:           end if
69:         end do
70:       end do
71:  
72: !     optical properties of the tracer mixing (independant of ntr)
73:  
74:       do k = kz , 1 , -1
75:         do i = 1 , iym2
76:           do j = 1 , jxm2
77: #ifdef MPP1
78:             fchem(j,i) = aerext_io(i+1,k,j+1)
79: #else
80:             fchem(j,i) = aerext(i+1,k,j+1)
81: #endif
82:           end do
83:         end do
84:         if ( iotyp.eq.1 ) then
85:           nrcchem = nrcchem + 1
86:           write (iutchem,rec=nrcchem) fchem
87:         else if ( iotyp.eq.2 ) then
88:           write (iutchem) fchem
89:         else
90:         end if
91:       end do
92:  
93:       do k = kz , 1 , -1
94:         do i = 1 , iym2
95:           do j = 1 , jxm2
96: #ifdef MPP1
97:             fchem(j,i) = aerssa_io(i+1,k,j+1)
98: #else
99:             fchem(j,i) = aerssa(i+1,k,j+1)
100: #endif
101:           end do
102:         end do
103:         if ( iotyp.eq.1 ) then
104:           nrcchem = nrcchem + 1
105:           write (iutchem,rec=nrcchem) fchem
106:         else if ( iotyp.eq.2 ) then
107:           write (iutchem) fchem
108:         else
109:         end if
110:       end do
111:  
112:       do k = kz , 1 , -1
113:         do i = 1 , iym2
114:           do j = 1 , jxm2
115: #ifdef MPP1
116:             fchem(j,i) = aerasp_io(i+1,k,j+1)
117: #else
118:             fchem(j,i) = aerasp(i+1,k,j+1)
119: #endif
120:           end do
121:         end do
122:         if ( iotyp.eq.1 ) then
123:           nrcchem = nrcchem + 1
124:           write (iutchem,rec=nrcchem) fchem
125:         else if ( iotyp.eq.2 ) then
126:           write (iutchem) fchem
127:         else
128:         end if
129:       end do
130:  
131: !     2d fields
132: !     instantaneous colum burden
133:       do itr = 1 , ntr
134: !       -------
135:         do i = 1 , iym2
136:           do j = 1 , jxm2
137: #ifdef MPP1
138:             fchem(j,i) = dtrace_io(i+1,j+1,itr)
139: #else
140:             fchem(j,i) = dtrace(i+1,j+1,itr)
141: #endif
142:           end do
143:         end do
144:         if ( iotyp.eq.1 ) then
145:           nrcchem = nrcchem + 1
146:           write (iutchem,rec=nrcchem) fchem
147:         else if ( iotyp.eq.2 ) then
148:           write (iutchem) fchem
149:         else
150:         end if
151: !       -------
152: !       averaged deposition rates
153:  
154: !       the variable are the cumul between two output time steps.
155: !       in mg.m-2 ( cf tarcbud). We want to get the correspnding average
156: !       rate between two time steps: so multiply by mpd to get a
157: !       deposition /emissiom rate in mg.m-2.day ( consistant with
158: !       rainfall output)
159:         mpd = 24./chemfrq
160: !       CARE here CUMUL
161: !       mpd = 1.
162:  
163:         do i = 1 , iym2
164:           do j = 1 , jxm2
165: #ifdef MPP1
166:             fchem(j,i) = wdlsc_io(i+1,j+1,itr)*mpd
167: #else
168:             fchem(j,i) = wdlsc(i+1,j+1,itr)*mpd
169: #endif
170:           end do
171:         end do
172:         if ( iotyp.eq.1 ) then
173:           nrcchem = nrcchem + 1
174:           write (iutchem,rec=nrcchem) fchem
175:         else if ( iotyp.eq.2 ) then
176:           write (iutchem) fchem
177:         else
178:         end if
179: !       --------
180:         do i = 1 , iym2
181:           do j = 1 , jxm2
182: #ifdef MPP1
183:             fchem(j,i) = wdcvc_io(i+1,j+1,itr)*mpd
184: #else
185:             fchem(j,i) = wdcvc(i+1,j+1,itr)*mpd
186: #endif
187:           end do
188:         end do
189:         if ( iotyp.eq.1 ) then
190:           nrcchem = nrcchem + 1
191:           write (iutchem,rec=nrcchem) fchem
192:         else if ( iotyp.eq.2 ) then
193:           write (iutchem) fchem
194:         else
195:         end if
196: !       -------------
197:         do i = 1 , iym2
198:           do j = 1 , jxm2
199: #ifdef MPP1
200:             fchem(j,i) = ddsfc_io(i+1,j+1,itr)*mpd
201: #else
202:             fchem(j,i) = ddsfc(i+1,j+1,itr)*mpd
203: #endif
204:           end do
205:         end do
206:         if ( iotyp.eq.1 ) then
207:           nrcchem = nrcchem + 1
208:           write (iutchem,rec=nrcchem) fchem
209:         else if ( iotyp.eq.2 ) then
210:           write (iutchem) fchem
211:         else
212:         end if
213: !----------------------
214:         do i = 1 , iym2
215:           do j = 1 , jxm2
216: #ifdef MPP1
217:             fchem(j,i) = wxsg_io(i+1,j+1,itr)*mpd
218: #else
219:             fchem(j,i) = wxsg(i+1,j+1,itr)*mpd
220: #endif
221:           end do
222:         end do
223:         if ( iotyp.eq.1 ) then
224:           nrcchem = nrcchem + 1
225:           write (iutchem,rec=nrcchem) fchem
226:         else if ( iotyp.eq.2 ) then
227:           write (iutchem) fchem
228:         else
229:         end if
230: !----------------------
231:         do i = 1 , iym2
232:           do j = 1 , jxm2
233: #ifdef MPP1
234:             fchem(j,i) = wxaq_io(i+1,j+1,itr)*mpd
235: #else
236:             fchem(j,i) = wxaq(i+1,j+1,itr)*mpd
237: #endif
238:           end do
239:         end do
240:         if ( iotyp.eq.1 ) then
241:           nrcchem = nrcchem + 1
242:           write (iutchem,rec=nrcchem) fchem
243:         else if ( iotyp.eq.2 ) then
244:           write (iutchem) fchem
245:         else
246:         end if
247: !----------------------
248:         do i = 1 , iym2
249:           do j = 1 , jxm2
250: #ifdef MPP1
251:             fchem(j,i) = cemtrac_io(i+1,j+1,itr)*mpd
252: #else
253:             fchem(j,i) = cemtrac(i+1,j+1,itr)*mpd
254: #endif
255:           end do
256:         end do
257:         if ( iotyp.eq.1 ) then
258:           nrcchem = nrcchem + 1
259:           write (iutchem,rec=nrcchem) fchem
260:         else if ( iotyp.eq.2 ) then
261:           write (iutchem) fchem
262:         else
263:         end if
264:  
265: !       IF YOU WANT THE INSTANTANEOUS EMISSION IN THE SOURCE
266:  
267: !       do i=1,iym2
268: !       do j=1,jxm2
269: !       fchem(j,i) = chemsrc(i+1,j+1,lmonth,itr) * 1.e9
270: !       unit = microg/m2.s
271: !       end do
272: !       end do
273: !       if (iotyp.eq.1) then
274: !       nrcchem=nrcchem+1
275: !       write(iutchem,rec=nrcchem) fchem
276: !       else if (iotyp.eq.2) then
277: !       write(iutchem) fchem
278: !       end if
279: !       ------------------
280: ! end tracer loop
281:         end do
282: 
283: !       reinitialisation for avraged dposition rates ( a modifier)
284: #ifdef MPP1
285:         remlsc_io  = 0.0
286:         remcvc_io  = 0.0
287:         rxsg_io    = 0.0
288:         rxsaq1_io  = 0.0
289:         rxsaq2_io  = 0.0
290:         cemtr_io   = 0.0
291:         remdrd_io  = 0.0
292:         wdlsc_io   = 0.0
293:         wdcvc_io   = 0.0
294:         ddsfc_io   = 0.0
295:         wxsg_io    = 0.0
296:         wxaq_io    = 0.0
297:         cemtrac_io = 0.0
298: #else
299:         remlsc  = 0.0
300:         remcvc  = 0.0
301:         rxsg    = 0.0
302:         rxsaq1  = 0.0
303:         rxsaq2  = 0.0
304:         cemtr   = 0.0
305:         remdrd  = 0.0
306:         wdlsc   = 0.0
307:         wdcvc   = 0.0
308:         ddsfc   = 0.0
309:         wxsg    = 0.0
310:         wxaq    = 0.0
311:         cemtrac = 0.0
312: #endif
313:  
314: !----total aerosol TOA radiative forcing ( independant of the number of tracer)
315:  
316:       do i = 1 , iym2
317:         do j = 1 , jxm2
318: #ifdef MPP1
319:           fchem(j,i) = aertarf_io(i+1,j+1)
320: #else
321:           fchem(j,i) = aertarf(i+1,j+1)
322: #endif
323:         end do
324:       end do
325:       if ( iotyp.eq.1 ) then
326:         nrcchem = nrcchem + 1
327:         write (iutchem,rec=nrcchem) fchem
328:       else if ( iotyp.eq.2 ) then
329:         write (iutchem) fchem
330:       else
331:       end if
332:  
333:  
334:       do i = 1 , iym2
335:         do j = 1 , jxm2
336: #ifdef MPP1
337:           fchem(j,i) = aersrrf_io(i+1,j+1)
338: #else
339:           fchem(j,i) = aersrrf(i+1,j+1)
340: #endif
341:         end do
342:       end do
343:       if ( iotyp.eq.1 ) then
344:         nrcchem = nrcchem + 1
345:         write (iutchem,rec=nrcchem) fchem
346:       else if ( iotyp.eq.2 ) then
347:         write (iutchem) fchem
348:       else
349:       end if
350: 
351:       do i = 1 , iym2
352:         do j = 1 , jxm2
353: #ifdef MPP1
354:           fchem(j,i) = aertalwrf_io(i+1,j+1)
355: #else
356:           fchem(j,i) = aertalwrf(i+1,j+1)
357: #endif
358:         end do
359:       end do
360:       if ( iotyp.eq.1 ) then
361:         nrcchem = nrcchem + 1
362:         write (iutchem,rec=nrcchem) fchem
363:       else if ( iotyp.eq.2 ) then
364:         write (iutchem) fchem
365:       else
366:       end if
367: 
368:       do i = 1 , iym2
369:         do j = 1 , jxm2
370: #ifdef MPP1
371:           fchem(j,i) = aersrlwrf_io(i+1,j+1)
372: #else
373:           fchem(j,i) = aersrlwrf(i+1,j+1)
374: #endif
375:         end do
376:       end do
377:       if ( iotyp.eq.1 ) then
378:         nrcchem = nrcchem + 1
379:         write (iutchem,rec=nrcchem) fchem
380:       else if ( iotyp.eq.2 ) then
381:         write (iutchem) fchem
382:       else
383:       end if
384: 
385:       do i = 1 , iym2
386:         do j = 1 , jxm2
387: #ifdef MPP1
388:           fchem(j,i) = psa_io(i+1,j+1)
389: #else
390:           fchem(j,i) = psa(i+1,j+1)
391: #endif
392:         end do
393:       end do
394:       if ( iotyp.eq.1 ) then
395:         nrcchem = nrcchem + 1
396:         write (iutchem,rec=nrcchem) fchem
397:       else if ( iotyp.eq.2 ) then
398:         write (iutchem) fchem
399:       else
400:       end if
401:  
402: !     reset rad diag to 0 ( averaged between output time stepsin aerout)
403: #ifdef MPP1
404:       aertarf_io = 0.0
405:       aersrrf_io = 0.0
406:       aersrlwrf_io=0.0
407:       aertalwrf_io=0.0
408: #else
409:       aertarf = 0.0
410:       aersrrf = 0.0
411:       aersrlwrf =0.0 
412:       aertalwrf=0.0
413: #endif
414: 
415:       print * , 'Chem variables written ' , idatex
416:  
417:       end subroutine chemtap
</PRE>

<HR>

</BODY>
</HTML>
