<HTML>

<HEAD>
<TITLE>slice3D.F90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>slice3D.F90</H1>
<HR>
<H2 ALIGN=CENTER>slice3D.F90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=slice3d><H3>slice3d</H3></a></p> Click <a href="./callingtree/slice3d_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where slice3d is used.
<hr>
20:       subroutine slice3d
21:  
22:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
23:       use <a href="./mod_param2.F90.html#mod_param2" TARGET=CENT_PANEL>mod_param2</a>
24:       use <a href="./mod_param3.f90.html#mod_param3" TARGET=CENT_PANEL>mod_param3</a> , only : r8pt , sigma , a
25:       use <a href="./mod_main.F90.html#mod_main" TARGET=CENT_PANEL>mod_main</a>
26:       use <a href="./mod_mainchem.F90.html#mod_mainchem" TARGET=CENT_PANEL>mod_mainchem</a>
27:       use <a href="./mod_pbldim.F90.html#mod_pbldim" TARGET=CENT_PANEL>mod_pbldim</a>
28:       use <a href="./mod_pmoist.F90.html#mod_pmoist" TARGET=CENT_PANEL>mod_pmoist</a>
29:       use <a href="./mod_slice.F90.html#mod_slice" TARGET=CENT_PANEL>mod_slice</a>
30:       use <a href="./mod_constants.F90.html#mod_constants" TARGET=CENT_PANEL>mod_constants</a> , only : rgas , rovcp , rovg , ep2 , svp1 ,     &
31:                                & svp2 , svp3 , svp4, svp5 , svp6 , tzero
32:       implicit none
33: !
34: ! Local variables
35: !
36:       real(8) :: cell , pl , pres , psrf , rh , satvp , thcon , tv
37:       integer :: i , idx , idxp1 , j , jdx , jdxp1 , k , kk , n
38:  
39: #ifdef MPP1
40:       do j = 1 , jendx
41: #else
42:       do j = 1 , jxm1
43: #endif
44:         do k = 1 , kz
45:           do i = 1 , iym1
46:             tb3d(i,k,j) = tb(i,k,j)/psb(i,j)
47:             qvb3d(i,k,j) = qvb(i,k,j)/psb(i,j)
48:             qcb3d(i,k,j) = qcb(i,k,j)/psb(i,j)
49:             if ( ichem.eq.1 ) then
50:               do n = 1 , ntr
51:                 chib3d(i,k,j,n) = chib(i,k,j,n)/psb(i,j)
52:               end do
53:             end if
54:           end do
55:         end do
56:       end do
57:  
58: #ifdef MPP1
59:       do j = jbegin , jendx
60:         jdx = j
61:         if ( myid.eq.0 ) jdx = max0(j,2)
62:         jdxp1 = j + 1
63:         if ( myid.eq.nproc-1 ) jdxp1 = min0(j+1,jendx)
64: #else
65:       do j = 2 , jxm1
66:         jdx = max0(j,2)
67:         jdxp1 = min0(j+1,jxm1)
68: #endif
69:         do k = 1 , kz
70:           do i = 1 , iym1
71:             idx = max0(i,2)
72:             idxp1 = min0(i+1,iym1)
73:             ubx3d(i,k,j) = 0.25*(ub(idx,k,jdx)+ub(idxp1,k,jdx)+ub(idx,k,&
74:                          & jdxp1)+ub(idxp1,k,jdxp1))/psb(i,j)
75:             vbx3d(i,k,j) = 0.25*(vb(idx,k,jdx)+vb(idxp1,k,jdx)+vb(idx,k,&
76:                          & jdxp1)+vb(idxp1,k,jdxp1))/psb(i,j)
77:           end do
78:         end do
79:       end do
80:  
81: #ifdef MPP1
82:       do j = 1 , jendl
83: #else
84:       do j = 1 , jx
85: #endif
86:         do k = 1 , kz
87:           do i = 1 , iy
88:             ubd3d(i,k,j) = ub(i,k,j)/pdotb(i,j)
89:             vbd3d(i,k,j) = vb(i,k,j)/pdotb(i,j)
90:           end do
91:         end do
92:       end do
93:  
94: #ifdef MPP1
95:       do j = jbegin , jendx
96: #else
97:       do j = 2 , jxm1
98: #endif
99:         do k = 1 , kz
100:           do i = 2 , iym1
101:             pl = a(k)*psb(i,j) + r8pt
102:             thcon = ((psb(i,j)+r8pt)/pl)**rovcp
103:             pb3d(i,k,j) = pl
104:             thx3d(i,k,j) = tb3d(i,k,j)*thcon
105:           end do
106:         end do
107:       end do
108:  
109: !-----compute the height at full (za) and half (zq) sigma levels:
110: #ifdef MPP1
111:       do j = jbegin , jendx
112: #else
113:       do j = 2 , jxm1
114: #endif
115:         do i = 2 , iym1
116:           zq(i,kzp1) = 0.
117:         end do
118:         do kk = 1 , kz
119:           k = kzp1 - kk
120:           do i = 2 , iym1
121:             cell = r8pt/psb(i,j)
122:             zq(i,k) = rovg*tb3d(i,k,j)                                  &
123:                     & *dlog((sigma(k+1)+cell)/(sigma(k)+cell))          &
124:                     & + zq(i,k+1)
125:           end do
126:         end do
127: !
128:         do k = 1 , kz
129:           do i = 2 , iym1
130:             za(i,k,j) = 0.5*(zq(i,k)+zq(i,k+1))
131:             dzq(i,k,j) = zq(i,k) - zq(i,k+1)
132:           end do
133:         end do
134:  
135: !-----Calculate the relative humidity and air density
136:         do i = 2 , iym1
137:           psrf = (psb(i,j)+r8pt)*1000.
138:           tv = tb3d(i,kz,j)
139:           rhox2d(i,j) = psrf/(rgas*tv)
140:         end do
141:         do k = 1 , kz
142:           do i = 2 , iym2
143:             pres = (a(k)*psb(i,j)+r8pt)*1000.
144:             rhob3d(i,k,j) = pres/(rgas*tb3d(i,k,j)) !air density
145:             if ( tb3d(i,k,j).gt.tzero ) then
146:               satvp = svp1*1.E3*dexp(svp2*(tb3d(i,k,j)-tzero)           &
147:                     & /(tb3d(i,k,j)-svp3))
148:             else
149:               satvp = svp4*1.E3*dexp(svp5-svp6/tb3d(i,k,j))
150:             end if
151:             qsb3d(i,k,j) = ep2*satvp/(pres-satvp)
152:             rh = 0.
153:             if ( qsb3d(i,k,j).gt.0. ) rh = qvb3d(i,k,j)/qsb3d(i,k,j)
154:             rhb3d(i,k,j) = rh
155:           end do
156:         end do
157:       end do
158:  
159:       end subroutine slice3d
</PRE>

<HR>

</BODY>
</HTML>
