<HTML>

<HEAD>
<TITLE>radtap.F90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>radtap.F90</H1>
<HR>
<H2 ALIGN=CENTER>radtap.F90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=radtap><H3>radtap</H3></a></p> Click <a href="./callingtree/radtap_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where radtap is used.
<hr>
20:       subroutine radtap
21: !
22:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
23:       use <a href="./mod_param1.f90.html#mod_param1" TARGET=CENT_PANEL>mod_param1</a>
24:       use <a href="./mod_param2.F90.html#mod_param2" TARGET=CENT_PANEL>mod_param2</a>
25:       use <a href="./mod_param3.f90.html#mod_param3" TARGET=CENT_PANEL>mod_param3</a> , only : r8pt
26:       use <a href="./mod_date.F90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
27:       use <a href="./mod_iunits.f90.html#mod_iunits" TARGET=CENT_PANEL>mod_iunits</a>
28:       use <a href="./mod_outrad.F90.html#mod_outrad" TARGET=CENT_PANEL>mod_outrad</a>
29:       use <a href="./mod_radbuf.F90.html#mod_radbuf" TARGET=CENT_PANEL>mod_radbuf</a>
30: #ifdef MPP1
31:       use <a href="./mod_mppio.F90.html#mod_mppio" TARGET=CENT_PANEL>mod_mppio</a>
32: #else
33:       use <a href="./mod_main.F90.html#mod_main" TARGET=CENT_PANEL>mod_main</a> , only : psa
34: #endif
35:       implicit none
36: !
37: ! Local variables
38: !
39:       integer :: i , j , k , n
40:       real(4) , dimension(jxm2,iym2) :: radpsa
41: !
42: !
43: !     Radiation resolution and I/O parameters
44: !
45: !     compute total radiative heating flux for the surface,
46: !     converting units from cgs to mks
47: !
48:       print * , 'Writing rad fields at ktau = ' , ktau , idatex
49:       do i = 1 , iym2
50:         do j = 1 , jxm2
51: #ifdef MPP1
52:           radpsa(j,i) = (psa_io(i+1,j+1)+r8pt)*10.
53: #else
54:           radpsa(j,i) = (psa(i+1,j+1)+r8pt)*10.
55: #endif
56:         end do
57:       end do
58: 
59: 
60:       if ( iotyp.eq.1 ) then
61:         do n = 1 , nrad3d
62:           if ( n.ne.1 ) then
63:             do k = kz , 1 , -1
64:               nrcrad = nrcrad + 1
65: #ifdef MPP1
66:               write (iutrad,rec=nrcrad) ((frad3d_io(j,i,k,n),j=1,jxm2), &
67:                                       & i=1,iym2)
68: #else
69:               write (iutrad,rec=nrcrad) ((frad3d(j,i,k,n),j=1,jxm2),i=1,&
70:                                       & iym2)
71: #endif
72:             end do
73:           end if
74:         end do
75:         do n = 1 , nrad2d
76:           if ( n.lt.10 .or. n .eq. 22 ) then
77:                             ! skip everything from alb (10 to 21)
78:             nrcrad = nrcrad + 1
79: #ifdef MPP1
80:             write (iutrad,rec=nrcrad) ((frad2d_io(j,i,n),j=1,jxm2),i=1, &
81:                                     & iym2)
82: #else
83:             write (iutrad,rec=nrcrad) ((frad2d(j,i,n),j=1,jxm2),i=1,iym2&
84:                                     & )
85: #endif
86:           end if
87:         end do
88:         nrcrad = nrcrad + 1
89:         write (iutrad,rec=nrcrad) ((radpsa(j,i),j=1,jxm2),i=1,iym2)
90:       else if ( iotyp.eq.2 ) then
91:         write (iutrad) idatex
92:         do n = 1 , nrad3d
93:           if ( n.ne.1 ) then
94:             do k = kz , 1 , -1
95: #ifdef MPP1
96:               write (iutrad) ((frad3d_io(j,i,k,n),j=1,jxm2),i=1,iym2)
97: #else
98:               write (iutrad) ((frad3d(j,i,k,n),j=1,jxm2),i=1,iym2)
99: #endif
100:             end do
101:           end if
102:         end do
103:         do n = 1 , nrad2d
104: #ifdef MPP1
105:           if ( n.lt.10 )                                                &
106:             write (iutrad) ((frad2d_io(j,i,n),j=1,jxm2),i=1,iym2)
107: #else
108:           if ( n.lt.10 )                                                &
109:             write (iutrad) ((frad2d(j,i,n),j=1,jxm2),i=1,iym2)
110: #endif
111:                             ! skip everything from alb (10 to 21)
112:         end do
113:         write (iutrad) ((radpsa(j,i),j=1,jxm2),i=1,iym2)
114:       else
115:       end if
116:  
117:       end subroutine radtap
</PRE>

<HR>

</BODY>
</HTML>
