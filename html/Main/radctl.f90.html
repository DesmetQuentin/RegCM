<HTML>

<HEAD>
<TITLE>radctl.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>radctl.f90</H1>
<HR>
<H2 ALIGN=CENTER>radctl.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=radctl><H3>radctl</H3></a></p> Click <a href="./callingtree/radctl_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where radctl is used.
<hr>
20:       subroutine radctl(jslc,alat,coslat,ts,pmid,pint,pmln,piln,t,      &
21:                       & h2ommr,cld,effcld,clwp,albs,albsd,albl,albld,   &
22:                       & fsns,qrs,qrl,flwds,rel,rei,fice,sols,soll,solsd,&
23:                       & solld,emiss1d,fsnt,fsntc,fsnsc,flnt,flns,flntc, &
24:                       & flnsc,solin,alb,albc,fsds,fsnirt,fsnrtc,        &
25:                       & fsnirtsq,eccf,o3vmr)
26: !
27: !-----------------------------------------------------------------------
28: !
29: ! Driver for radiation computation.
30: !
31: ! Radiation uses cgs units, so conversions must be done from
32: ! model fields to radiation fields.
33: !
34: ! Calling sequence:
35: !
36: !     radinp      Converts units of model fields and computes ozone
37: !                 mixing ratio for solar scheme
38: !
39: !     radcsw      Performs solar computation
40: !       radalb    Computes surface albedos
41: !       radded    Computes delta-Eddington solution
42: !       radclr    Computes diagnostic clear sky fluxes
43: !
44: !     radclw      Performs longwave computation
45: !
46: !       radtpl    Computes path quantities
47: !       radems    Computes emissivity
48: !       radabs    Computes absorptivity
49: !
50: !---------------------------Code history--------------------------------
51: !
52: ! Original version:  CCM1
53: ! Standardized:      J. Rosinski, June 1992
54: ! Reviewed:          J. Kiehl, B. Briegleb, August 1992
55: !
56: ! Modified:          B. Briegleb, March 1995 to add aerosol
57: !                    to shortwave code
58: !
59: !-----------------------------------------------------------------------
60: !
61:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
62:       use <a href="./mod_date.F90.html#mod_date" TARGET=CENT_PANEL>mod_date</a>
63:       use <a href="./mod_aerosol.F90.html#mod_aerosol" TARGET=CENT_PANEL>mod_aerosol</a> , only : aermix , aeroppt , aerout
64:       implicit none
65: !
66: !     Input arguments
67: !
68: ! ts      - Surface (skin) temperature
69: ! pmid    - Model level pressures
70: ! pint    - Model interface pressures
71: ! pmln    - Natural log of pmid
72: ! rel     - liquid cloud particle effective radius
73: ! rei     - ice effective drop size (microns)
74: ! fice    - fractional ice content within cloud
75: ! piln    - Natural log of pint
76: ! t       - Model level temperatures
77: ! h2ommr  - Model level specific humidity
78: ! cld     - Fractional cloud cover
79: ! effcld  - Effective fractional cloud cover
80: ! clwp    - Cloud liquid water path
81: ! alat    - current latitude(radians)
82: ! coslat  - cosine latitude
83: !
84: !     Output solar arguments
85: !
86: ! fsns    - Surface absorbed solar flux
87: ! sols    - Downward solar rad onto surface (sw direct)
88: ! soll    - Downward solar rad onto surface (lw direct)
89: ! solsd   - Downward solar rad onto surface (sw diffuse)
90: ! solld   - Downward solar rad onto surface (lw diffuse)
91: ! qrs     - Solar heating rate
92: !
93: !     Output longwave arguments
94: !
95: ! qrl     - Longwave cooling rate
96: ! flwds   - Surface down longwave flux
97: !
98: !
99: ! Dummy arguments
100: !
101:       real(8) :: eccf
102:       integer :: jslc
103:       real(8) , dimension(iym1) :: alb , albc , albl , albld , albs ,  &
104:                                   & albsd , alat , coslat , emiss1d ,   &
105:                                   & flns , flnsc , flnt , flntc ,       &
106:                                   & flwds , fsds , fsnirt , fsnirtsq ,  &
107:                                   & fsnrtc , fsns , fsnsc , fsnt ,      &
108:                                   & fsntc , solin , soll , solld ,      &
109:                                   & sols , solsd , ts
110:       real(8) , dimension(iym1,kzp1) :: cld , effcld , piln , pint
111:       real(8) , dimension(iym1,kz) :: clwp , fice , h2ommr , pmid ,  &
112:            & pmln , qrl , qrs , rei , rel , t
113:       real(8) , dimension(iym1,kz) :: o3vmr
114:       intent (out) alb , albc
115:       intent (inout) flns , flnsc , flnt , flntc , flwds , fsds ,       &
116:                    & fsnirt , fsnirtsq , fsnrtc , fsns , fsnsc , fsnt , &
117:                    & fsntc , solin
118: !
119: !---------------------------Local variables-----------------------------
120: !
121: ! i        - index
122: ! solin    - Solar incident flux
123: ! fsnt     - Net column abs solar flux at model top
124: ! fsntc    - Clear sky total column abs solar flux
125: ! fsnsc    - Clear sky surface abs solar flux
126: ! fsnirt   - Near-IR flux absorbed at toa
127: ! fsnrtc   - Clear sky near-IR flux absorbed at toa
128: ! fsnirtsq - Near-IR flux absorbed at toa >= 0.7 microns
129: ! fsds     - Flux Shortwave Downwelling Surface
130: ! flnt     - Net outgoing lw flux at model top
131: ! flns     - Srf longwave cooling (up-down) flux
132: ! flntc    - Clear sky lw flux at model top
133: ! flnsc    - Clear sky lw flux at srf (up-down)
134: ! pbr      - Model mid-level pressures (dynes/cm2)
135: ! pnm      - Model interface pressures (dynes/cm2)
136: ! o3vmr    - Ozone volume mixing ratio
137: ! o3mmr    - Ozone mass mixing ratio
138: ! plco2    - Prs weighted CO2 path
139: ! plh2o    - Prs weighted H2O path
140: ! tclrsf   - Total clear sky fraction, level to space
141: ! eccf     - Earth/sun distance factor
142: ! n2o      - nitrous oxide mass mixing ratio
143: ! ch4      - methane mass mixing ratio
144: ! cfc11    - cfc11 mass mixing ratio
145: ! cfc12    - cfc12 mass mixing ratio
146: ! rh       - level relative humidity (fraction)
147: !
148: ! Local variables
149: !
150:       real(8) , dimension(iym1) :: aeradfo , aeradfos
151:       real(8),  dimension(iym1)::  aerlwfo , aerlwfos
152:       real(8) , dimension(iym1,kz) :: cfc11 , cfc12 , ch4 , n2o
153:       integer :: i
154:       real(8) , dimension(iym1,kz) :: o3mmr , pbr , rh
155:       real(8) , dimension(iym1,kzp1) :: plco2 , plh2o , pnm , tclrsf
156: !
157: !     Instead of interpolating the o3vmr from the time-interpolated
158: !     values, we pass compute o3vmr in getdat() and pass it directly
159: !     into radctl(). o3mmr will be computed in radinp().
160: !
161: !     Set latitude dependent radiation input
162: !
163:       call <a href="./radinp.F90.html#radinp" TARGET=CENT_PANEL>radinp</a>(pmid,pint,h2ommr,cld,o3vmr,pbr,pnm,plco2,plh2o,tclrsf,&
164:                 & eccf,o3mmr)
165: !
166: !     Solar radiation computation
167: !
168:       if ( dosw ) then
169: !
170: !       Specify aerosol mass mixing ratio
171: !
172:         call <a href="./mod_aerosol.F90.html#aermix" TARGET=CENT_PANEL>aermix</a>(pnm,rh,jslc,1,iym1,iym1,kz,ntr)
173:  
174:         call <a href="./mod_aerosol.F90.html#aeroppt" TARGET=CENT_PANEL>aeroppt</a>(rh,pint)
175: !
176:         call <a href="./radcsw.f90.html#radcsw" TARGET=CENT_PANEL>radcsw</a>(pnm,h2ommr,o3mmr,cld,clwp,rel,rei,fice,eccf,albs,   &
177:                   & albsd,albl,albld,solin,qrs,fsns,fsnt,fsds,fsnsc,    &
178:                   & fsntc,sols,soll,solsd,solld,fsnirt,fsnrtc,fsnirtsq, &
179:                   & aeradfo,aeradfos)
180: !
181: !       call aerout(jslc,aeradfo,aeradfos)
182: !
183: !       Convert units of shortwave fields needed by rest of model from
184: !       CGS to MKS
185:         do i = 1 , iym1
186:           solin(i) = solin(i)*1.E-3
187:           fsnt(i) = fsnt(i)*1.E-3
188:           fsns(i) = fsns(i)*1.E-3
189:           fsntc(i) = fsntc(i)*1.E-3
190:           fsnsc(i) = fsnsc(i)*1.E-3
191:  
192:           fsds(i) = fsds(i)*1.E-3
193:           fsnirt(i) = fsnirt(i)*1.E-3
194:           fsnrtc(i) = fsnrtc(i)*1.E-3
195:           fsnirtsq(i) = fsnirtsq(i)*1.E-3
196:         end do
197: !
198: !       Calculate/outfld albedo and clear sky albedo
199: !
200:         do i = 1 , iym1
201:           if ( solin(i).gt.0. ) then
202:             alb(i) = (solin(i)-fsnt(i))/solin(i)
203:           else
204:             alb(i) = 0.
205:           end if
206:         end do
207: !
208:         do i = 1 , iym1
209:           if ( solin(i).gt.0. ) then
210:             albc(i) = (solin(i)-fsntc(i))/solin(i)
211:           else
212:             albc(i) = 0.
213:           end if
214:         end do
215:       end if
216: !
217: !     Longwave radiation computation
218: !
219:       if ( dolw ) then
220: !
221: !       Specify trace gas mixing ratios
222: !
223:         call <a href="./trcmix.f90.html#trcmix" TARGET=CENT_PANEL>trcmix</a>(pmid,alat,coslat,n2o,ch4,cfc11,cfc12)
224: !
225:         call <a href="./radclw.f90.html#radclw" TARGET=CENT_PANEL>radclw</a>(jslc,ts,t,h2ommr,o3vmr,pbr,pnm,pmln,piln,plco2,     &
226:                   & plh2o,n2o,ch4,cfc11,cfc12,effcld,tclrsf,qrl,flns,   &
227:                   & flnt,flnsc,flntc,flwds,emiss1d,aerlwfo,aerlwfos)
228: !
229: !       Convert units of longwave fields needed by rest of model from
230: !       CGS to MKS
231:         do i = 1 , iym1
232:           flnt(i) = flnt(i)*1.E-3
233:           flns(i) = flns(i)*1.E-3
234:           flntc(i) = flntc(i)*1.E-3
235:           flnsc(i) = flnsc(i)*1.E-3
236:           flwds(i) = flwds(i)*1.E-3
237:         end do
238:       end if
239: 
240: !     aersols diagnostics
241: 
242:       call <a href="./mod_aerosol.F90.html#aerout" TARGET=CENT_PANEL>aerout</a>(jslc,aeradfo,aeradfos,aerlwfo,aerlwfos)
243:         
244:       end subroutine radctl
</PRE>

<HR>

</BODY>
</HTML>
