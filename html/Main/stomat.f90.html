<HTML>

<HEAD>
<TITLE>stomat.f90</TITLE>
</HEAD>

<BODY background="back_granite.gif">
<FONT COLOR="#000000" FACE="Times">
<H1 ALIGN=CENTER>stomat.f90</H1>
<HR>
<H2 ALIGN=CENTER>stomat.f90</H2>
<HR>
</FONT>

<HR>

<PRE>
1: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
2: !
3: !    This file is part of ICTP RegCM.
4: !
5: !    ICTP RegCM is free software: you can redistribute it and/or modify
6: !    it under the terms of the GNU General Public License as published by
7: !    the Free Software Foundation, either version 3 of the License, or
8: !    (at your option) any later version.
9: !
10: !    ICTP RegCM is distributed in the hope that it will be useful,
11: !    but WITHOUT ANY WARRANTY; without even the implied warranty of
12: !    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
13: !    GNU General Public License for more details.
14: !
15: !    You should have received a copy of the GNU General Public License
16: !    along with ICTP RegCM.  If not, see <http://www.gnu.org/licenses/>.
17: !
18: !::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
19:  
<p><a name=stomat><H3>stomat</H3></a></p> Click <a href="./callingtree/stomat_rite.html" TARGET=RITE_PANEL>HERE</a> to see the where stomat is used.
<hr>
20:       subroutine stomat
21: 
22: !:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
23: !
24: !     gives leaf stomatal resistance from environmental parameters
25: !             under conditions of no moisture stress
26: !
27: !     standard lai from xla=max & xlai0=min lai (set in bconst)
28: !     seasb = fseas(tgb1d(n,i) (set in bndry) is a seasonal
29: !             factor for reduced winter lai and root water uptake
30: !        fc = light sensitivity for crops and grasses and has inverse
31: !             radiation units (m**2/watt)
32: !      rlai = sum of leaf and stem area indices
33: !     rmax0 = 5000. s/m (maximum resistance)
34: !     radu & radl = visible light intensity in upper & lower canopy
35: !     ft & fb = the fractional intercepted photo-active radiation
36: !             per unit (leaf & stem) area in the top (upper) and
37: !             bottom (lower) canopies, respectively
38: !     radfi = average of upper and lower canopy light factors
39: !        rs = stomatal resistance = min.res. * rad.factor * leaf factor
40: !      trup = transmission of the upper canopy, assumed to be the same
41: !             for the lower canopy,i.e., trup=dexp(-0.5*g*rlai/czen),
42: !             where g = attenuation factor
43: !
44: !     documented in ncar tech note, dickinson et al., 1986
45: !     improved stomatal shading, dickinson, nov 88.
46: !
47:       use <a href="./mod_dynparam.F90.html#mod_dynparam" TARGET=CENT_PANEL>mod_dynparam</a>
48:       use <a href="./mod_bats.F90.html#mod_bats" TARGET=CENT_PANEL>mod_bats</a>
49:       use <a href="./mod_ictp01.F90.html#mod_ictp01" TARGET=CENT_PANEL>mod_ictp01</a>
50:       use <a href="./mod_constants.F90.html#mod_constants" TARGET=CENT_PANEL>mod_constants</a> , only : rmax0
51:       implicit none
52: !
53: ! Local variables
54: !
55:       real(8) :: difzen , g , radfi , seas , vpdf , x
56:       real(8) :: fseas
57:       real(8) , dimension(nnsg,iym1) :: fsol0 , fsold , radf , rmini ,  &
58:            & trup , trupd
59:       integer :: il , ilmax , n , i
60:       real(8) , dimension(10) :: rad , radd
61: !
62: !     ***** seasonal temperature factor
63: !
64:       fseas(x) = dmax1(0.0D0,1.-0.0016*dmax1(298.-x,0.D0)**2)
65:  
66: !     ***** g is average leaf crosssection per unit lai
67: !     ***** difzen is ave of inverse of cos of angle of diffuse vis
68: !     light ***** ilmax is number of canopy layers
69: !     ***** czen is cosine solar zenith angle for incident light
70: !     *****   (to spec from input data need a good treatment of diffuse
71: !     rad) ***** trup is transmission of direct beam light in one
72: !     canopy layer ***** trupd is transmission of diffuse light in one
73: !     canopy layer
74:       g = 0.5
75:       difzen = 2.0
76:       ilmax = 4
77: !*    delete fracd here to put in diffuse mod_radiation from ccm
78: !cc   fracd = difrat         !  from shuttleworth mods #2
79:  
80:       do i = 2 , iym1
81:         do n = 1 , nnsg
82:           if ( ldoc1d(n,i).gt.0.5 ) then
83:             if ( sigf(n,i).gt.0.001 ) then
84: !             **********            zenith angle set in zenitm
85:               if ( czen(i).gt.0.001 ) then
86:                 trup(n,i) = dexp(-g*rlai(n,i)/(ilmax*czen(i)))
87:                 trupd(n,i) = dexp(-difzen*g*rlai(n,i)/(ilmax))
88:                 if ( trup(n,i) .lt. 1E-30 ) trup(n,i) = 0.0
89:                 if ( trupd(n,i) .lt. 1E-30 ) trupd(n,i) = 0.0
90:                 fsold(n,i) = fracd(i)*solis(i)*fc(lveg(n,i))
91:                 fsol0(n,i) = (1.-fracd(i))*solis(i)*fc(lveg(n,i))
92:                 rmini(n,i) = rsmin(lveg(n,i))/rmax0
93:               end if
94:             end if
95:           end if
96:         end do
97:       end do
98:  
99:       do i = 2 , iym1
100:         do n = 1 , nnsg
101:           if ( ldoc1d(n,i).gt.0.5 ) then
102:             if ( sigf(n,i).gt.0.001 ) then
103:               if ( czen(i).gt.0.001 ) then
104:                 rad(1) = (1.-trup(n,i))*fsol0(n,i)*ilmax/rlai(n,i)
105:                 radd(1) = (1.-trupd(n,i))*fsold(n,i)*ilmax/rlai(n,i)
106:                 do il = 2 , ilmax
107:                   rad(il) = trup(n,i)*rad(il-1)
108:                   radd(il) = trupd(n,i)*radd(il-1)
109:                 end do
110:                 radfi = 0.
111:                 do il = 1 , ilmax
112:                   radfi = radfi + (rad(il)+radd(il)+rmini(n,i))         &
113:                         & /(1.+rad(il)+radd(il))
114:                 end do
115:                 radf(n,i) = ilmax/radfi
116:               end if
117:             end if
118:           end if
119:         end do
120:       end do
121:  
122:       do i = 2 , iym1
123:         do n = 1 , nnsg
124:           if ( ldoc1d(n,i).gt.0.5 ) then
125:             if ( sigf(n,i).gt.0.001 ) then
126:               if ( czen(i).gt.0.001 ) then
127:                 vpdf = 1./dmax1(0.3D0,1.D0-vpdc(n,i)*0.025)
128:                 seas = 1./(rmini(n,i)+fseas(tlef1d(n,i)))
129:                 rs(n,i) = rsmin(lveg(n,i))*radf(n,i)*seas*vpdf
130:                 rs(n,i) = dmin1(rs(n,i),rmax0)
131:               else
132:                 rs(n,i) = rmax0
133:               end if
134:             end if
135:           end if
136:         end do
137:       end do
138:       end subroutine stomat
</PRE>

<HR>

</BODY>
</HTML>
